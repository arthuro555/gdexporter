!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(lp){"use strict";try{(function(){lp=lp&&Object.prototype.hasOwnProperty.call(lp,"default")?lp.default:lp;var t,l,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function i(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=l=l||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";l.DEBUG,l.VERBOSE,l.INFO,l.WARN,l.ERROR,l.SILENT;function o(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var u=l.INFO,a=((t={})[l.DEBUG]="log",t[l.VERBOSE]="log",t[l.INFO]="info",t[l.WARN]="warn",t[l.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.DEBUG],t)),this._logHandler.apply(this,s([this,l.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.VERBOSE],t)),this._logHandler.apply(this,s([this,l.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.INFO],t)),this._logHandler.apply(this,s([this,l.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.WARN],t)),this._logHandler.apply(this,s([this,l.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,l.ERROR],t)),this._logHandler.apply(this,s([this,l.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=o,this._userLogHandler=null}function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,d=(n(m,f=Error),m);function m(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(b,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new d(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var b=/\{\$([^}]+)}/g,E=(T.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},T.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},T.prototype.setServiceProps=function(t){return this.serviceProps=t,this},T);function T(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var N,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},S=_||self;function D(){}function k(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),V=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function L(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:L).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var j=Date.now||function(){return+new Date};function U(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function q(){this.j=this.j,this.i=this.i}q.prototype.j=!1,q.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))t=this,Object.prototype.hasOwnProperty.call(t,R)&&t[R]||(t[R]=++V);var t},q.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t){return/^[\s\xa0]*$/.test(t)}var Q,H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function K(t,e){return-1!=t.indexOf(e)}function Y(t,e){return t<e?-1:e<t?1:0}t:{var X=S.navigator;if(X){var $=X.userAgent;if($){Q=$;break t}}Q=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<tt.length;o++)n=tt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){return nt[" "](t),t}nt[" "]=D;var rt,it,ot=K(Q,"Opera"),st=K(Q,"Trident")||K(Q,"MSIE"),ut=K(Q,"Edge"),at=ut||st,ht=K(Q,"Gecko")&&!(K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge"))&&!(K(Q,"Trident")||K(Q,"MSIE"))&&!K(Q,"Edge"),ct=K(Q.toLowerCase(),"webkit")&&!K(Q,"Edge");function ft(){var t=S.document;return t?t.documentMode:void 0}t:{var lt="",pt=(it=Q,ht?/rv:([^\);]+)(\)|;)/.exec(it):ut?/Edge\/([\d\.]+)/.exec(it):st?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(it):ct?/WebKit\/(\S+)/.exec(it):ot?/(?:Version)[ \/]?(\S+)/.exec(it):void 0);if(pt&&(lt=pt?pt[1]:""),st){var dt=ft();if(null!=dt&&dt>parseFloat(lt)){rt=String(dt);break t}}rt=lt}var yt,vt={};function mt(u){return t=u,e=function(){for(var t=0,e=H(String(rt)).split("."),n=H(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Y(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Y(0==o[2].length,0==s[2].length)||Y(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=vt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}if(S.document&&st){var gt=ft();yt=gt||(parseInt(rt,10)||void 0)}else yt=void 0;var wt=yt,bt=!st||9<=Number(wt),Et=st&&!mt("9"),Tt=function(){if(!S.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{S.addEventListener("test",D,e),S.removeEventListener("test",D,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{nt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.defaultPrevented=!0},U(Nt,It);var _t={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++St,this.V=this.X=!1}function kt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function Ot(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=F(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(kt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Rt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Rt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new Dt(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Vt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Lt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[At]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Lt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[At]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,h=Ft(t);if(h||(t[Vt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(jt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Mt(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[At])Ot(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(jt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Ot(n,t),0==n.b&&(n.src=null,e[Vt]=null)):kt(t)}}}function jt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ut(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Mt(t),n.call(r,e)}function qt(t,e){if(t.V)return!0;if(bt)return Ut(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=S,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ut(t,e=new Nt(e,this))}function Ft(t){return(t=t[Vt])instanceof xt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==k(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function zt(){q.call(this),this.c=new xt(this),(this.J=this).A=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var u=s.listener,a=s.aa||s.src;s.X&&Ot(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}U(zt,q),zt.prototype[At]=!0,(N=zt.prototype).addEventListener=function(t,e,n,r){Lt(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Gt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Rt(s=e.a[n],r,i,o))&&(kt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Rt(n,r,i,o)),(r=-1<e?n[e]:null)&&Mt(r))}(this,t,e,n,r)},N.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var i=t;et(t=new It(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Wt(s,r,!0,t)&&i}if(i=Wt(s=t.a=n,r,!0,t)&&i,i=Wt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Wt(s=t.a=e[o],r,!1,t)&&i;return i},N.C=function(){if(zt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)kt(n[r]);delete e.a[t],e.b--}}this.A=null},N.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},N.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=S.JSON.stringify;function Ht(){this.b=this.a=null}var Kt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt(function(){return new $t},function(t){t.reset()},100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function $t(){this.next=this.b=this.a=null}function Jt(t){S.setTimeout(function(){throw t},0)}function Zt(t,e){var n;Kt||(n=S.Promise.resolve(void 0),Kt=function(){n.then(ne)}),te||(Kt(),te=!0),ee.add(t,e)}Ht.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Ht;function ne(){for(var t;r=n=void 0,r=null,(n=ee).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Jt(t)}var e=Yt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}var n,r;te=!1}function re(t,e){zt.call(this),this.b=t||1,this.a=e||S,this.f=C(this.Ua,this),this.g=j()}function ie(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function oe(t,e,n){if("function"==k(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:S.setTimeout(t,e||0)}function se(t,e,n){q.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function ue(t){t.T=oe(t.b,t.c),t.f.apply(null,t.a)}function ae(t){q.call(this),this.b=t,this.a={}}U(re,zt),(N=re.prototype).Z=!1,N.L=null,N.Ua=function(){if(this.Z){var t=j()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ie(this),this.start()))}},N.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=j())},N.C=function(){re.M.C.call(this),ie(this),delete this.a},U(se,q),(N=se.prototype).ba=!1,N.T=null,N.Ia=function(t){this.a=arguments,this.T?this.ba=!0:ue(this)},N.C=function(){se.M.C.call(this),this.T&&(S.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},N.Pa=function(){this.T=null,this.ba&&(this.ba=!1,ue(this))},U(ae,q);var he=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=Lt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Mt(t)},t),t.a={}}function le(){}ae.prototype.C=function(){ae.M.C.call(this),fe(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pe=null;function de(){return pe=pe||new zt}function ye(t){It.call(this,"serverreachability",t)}function ve(t){var e=de();e.dispatchEvent(new ye(e))}function me(t){It.call(this,"statevent",t)}function ge(t){var e=de();e.dispatchEvent(new me(e))}function we(t){It.call(this,"timingevent",t)}function be(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return S.setTimeout(function(){t()},e)}U(ye,It),U(me,It),U(we,It);var Ee={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Te={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ie(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Ie.prototype.a=null;var Ae,Se={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function De(){It.call(this,"d")}function ke(){It.call(this,"c")}function xe(){}function Oe(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ae(this),this.N=Re,t=at?125:void 0,this.O=new re(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}U(De,It),U(ke,It),U(xe,Ie),Ae=new xe;var Re=45e3,Ve={},Pe={};function Le(t,e,n){t.B=1,t.f=rn($e(e)),t.j=n,t.F=!0,Ce(t,null)}function Ce(t,e){t.s=j(),Ue(t),t.A=$e(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),mn(n.b,"t",r),t.w=0,t.a=ar(t.g,t.g.w?e:null),0<t.J&&(t.D=new se(C(t.ya,t,t.a),t.J)),ce(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ve(1)}function Me(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=je(t,n);if(i==Pe){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Ve){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(Ge(t),Be(t))}function je(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Ve:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.w=r+n,e))}function Ue(t){t.P=j()+t.N,qe(t,t.N)}function qe(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=be(C(t.Qa,t),e)}function Fe(t){t.h&&(S.clearTimeout(t.h),t.h=null)}function Be(t){0==t.g.u||t.l||rr(t.g,t)}function Ge(t){Fe(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ie(t.O),fe(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function ze(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||Nn(n.b,t)))if(n.A=t.H,!t.o&&Nn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;nr(n),n.a.cancel(),n.a=null}er(n),ge(18)}}else n.ia=i[1],0<n.ia-n.G&&i[2]<37500&&n.U&&0==n.m&&!n.l&&(n.l=be(C(n.Na,n),6e3));if(In(n.b)<=1&&n.O){try{n.O()}catch(t){}n.O=void 0}}else or(n,11)}else if(!t.o&&n.a!=t||nr(n),!W(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var u=n,a=t.a;if(a){var h=a.a?a.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var c=u.b;!c.a&&(K(h,"spdy")||K(h,"quic")||K(h,"h2"))&&(c.f=c.g,c.a=new Set,c.b&&(_n(c,c.b),c.b=null))}if(u.s){var f=a.a?a.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.ha=f,nn(u.v,u.s,f))}}n.u=3,n.c&&n.c.na();var l=t;if((u=n).ea=ur(u,u.w?u.R:null,u.P),l.o){An(u.b,l);var p=l,d=u.D;d&&p.setTimeout(d),p.h&&(Fe(p),Ue(p)),u.a=l}else tr(u);0<n.f.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||or(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?or(n,7):Hn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);ve(4)}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)B(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(N=Oe.prototype).setTimeout=function(t){this.N=t},N.Sa=function(t){t=t.target;var e=this.D;e&&3==Gn(t)?e.Ia():this.ya(t)},N.ya=function(t){try{if(t==this.a)t:{var e=Gn(this.a),n=this.a.qa(),r=this.a.S();if(!(e<3||3==e&&!at&&!this.a.Y())){this.l||4!=e||7==n||ve(8==n||r<=0?3:2),Fe(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),Ge(this),Be(this);break t}this.o=!0,ze(this,a)}this.F?(Me(this,e,o),at&&this.b&&3==e&&(ce(this.G,this.O,"tick",this.Ra),this.O.start())):ze(this,o),4==e&&Ge(this),this.b&&!this.l&&(4==e?rr(this.g,this):(this.b=!1,Ue(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),Ge(this),Be(this)}}}catch(t){}},N.Ra=function(){if(this.a){var t=Gn(this.a),e=this.a.Y();this.w<e.length&&(Fe(this),Me(this,t,e),this.b&&4!=t&&Ue(this))}},N.cancel=function(){this.l=!0,Ge(this)},N.Qa=function(){this.h=null;var t=j();0<=t-this.P?(2!=this.B&&(ve(3),ge(17)),Ge(this),this.c=2,Be(this)):qe(this,this.P-t)},(N=Qe.prototype).I=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},N.K=function(){return He(this),this.a.concat()},N.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},N.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},N.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Xe){this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,Ze(this,t.c),tn(this,t.h),this.g=t.g,e=t.b;var n=new pn;n.c=e.c,e.a&&(n.a=new Qe(e.a),n.b=e.b),en(this,n),this.i=t.i}else t&&(n=String(t).match(Ye))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.g=on(n[5]||"",!0),en(this,n[6]||"",!0),this.i=on(n[7]||"")):(this.a=!!e,this.b=new pn(null,this.a))}function $e(t){return new Xe(t)}function Je(t,e,n){t.f=n?on(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function en(t,e,n){var r,i;e instanceof pn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),mn(this,n,t))},r)),r.f=i):(n||(e=sn(e,fn)),t.b=new pn(e,t.a))}function nn(t,e,n){t.b.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^j()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(sn(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(sn(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?cn:hn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",sn(n,ln)),t.join("")};var an=/[#\/\?@]/g,hn=/[#\?:]/g,cn=/[#\?]/g,fn=/[#\?@]/g,ln=/#/g;function pn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(n){n.a||(n.a=new Qe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function yn(t,e){dn(t),e=gn(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function vn(t,e){return dn(t),e=gn(t,e),Ke(t.a.b,e)}function mn(t,e,n){yn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),z(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function wn(t,e){this.b=t,this.a=e}function bn(t){this.g=t||En,t=S.PerformanceNavigationTiming?0<(t=S.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(S.ca&&S.ca.ua&&S.ca.ua()&&S.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(N=pn.prototype).add=function(t,e){dn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},N.forEach=function(n,r){dn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},N.K=function(){dn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},N.I=function(t){dn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=G(e,this.a.get(gn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},N.set=function(t,e){return dn(this),this.c=null,vn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},N.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var En=10;function Tn(t){return t.b||t.a&&t.a.size>=t.f}function In(t){return t.b?1:t.a?t.a.size:0}function Nn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Sn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Dn(){}function kn(){this.a=new Dn}function xn(t,r,e){var i=e||"";try{We(t,function(t,e){var n=t;O(t)&&(n=Qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bn.prototype.cancel=function(){var e,t;if(this.c=Sn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Dn.prototype.stringify=function(t){return S.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return S.JSON.parse(t,void 0)};var Rn=S.JSON.parse;function Vn(t){zt.call(this),this.headers=new Qe,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Pn,this.B=this.F=!1}U(Vn,zt);var Pn="",Ln=/^https?$/i,Cn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function jn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Un(t),Fn(t)}function Un(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function qn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=Gn(t)||2!=t.S()))if(t.l&&4==Gn(t))oe(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Gn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(Ye)[1]||null;if(!o&&S.self&&S.self.location){var s=S.self.location.protocol;o=s.substr(0,s.length-1)}i=!Ln.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Gn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Un(t)}}finally{Fn(t)}}}function Fn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Bn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(S.clearTimeout(t.m),t.m=null)}function Gn(t){return t.a?t.a.readyState:0}function zn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function Wn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Wn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Wn("baseRetryDelayMs",5e3,t),this.Ga=Wn("retryDelaySeedMs",1e4,t),this.Da=Wn("forwardChannelMaxRetries",2,t),this.ga=Wn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new bn(t&&t.concurrentRequestLimit),this.ja=new kn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Hn(t){if(Kn(t),3==t.u){var e=t.H++,n=$e(t.v);nn(n,"SID",t.B),nn(n,"RID",e),nn(n,"TYPE","terminate"),Jn(t,n),(e=new Oe(t,e,void 0)).B=2,e.f=rn($e(n)),n=!1,S.navigator&&S.navigator.sendBeacon&&(n=S.navigator.sendBeacon(e.f.toString(),"")),!n&&S.Image&&((new Image).src=e.f,n=!0),n||(e.a=ar(e.g,null),e.a.$(e.f)),e.s=j(),Ue(e)}sr(t)}function Kn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(S.clearTimeout(t.i),t.i=null),nr(t),t.b.cancel(),t.g&&("number"==typeof t.g&&S.clearTimeout(t.g),t.g=null)}function Yn(t,e){t.f.push(new wn(t.Fa++,e)),3==t.u&&Xn(t)}function Xn(t){Tn(t.b)||t.g||(t.g=!0,Zt(t.xa,t),t.o=0)}function $n(t,e){var n;n=e?e.W:t.H++;var r=$e(t.v);nn(r,"SID",t.B),nn(r,"RID",n),nn(r,"AID",t.G),Jn(t,r),t.h&&t.j&&zn(r,t.h,t.j),n=new Oe(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),_n(t.b,n),Le(n,r,e)}function Jn(t,n){t.c&&We({},function(t,e){nn(n,e,t)})}function Zn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{xn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function tr(t){t.a||t.i||(t.J=1,Zt(t.wa,t),t.m=0)}function er(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=be(C(t.wa,t),ir(t,t.m)),t.m++,1)}function nr(t){null!=t.l&&(S.clearTimeout(t.l),t.l=null)}function rr(t,e){var n=null;if(t.a==e){nr(t),t.a=null;var r=2}else{if(!Nn(t.b,e))return;n=e.i,An(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=j()-e.s;var i=t.o;(r=de()).dispatchEvent(new we(r)),Xn(t)}else tr(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){if(!(In(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=be(C(t.xa,t,e),ir(t,t.o)),t.o++,1}}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function or(t,e){if(2==e){var n=null;t.c&&(n=null);var r=C(t.Ta,t);n||(n=new Xe("//www.google.com/images/cleardot.gif"),S.location&&"http"==S.location.protocol||Je(n,"https"),rn(n)),function(t,e){var n=new le;if(S.Image){var r=new Image;r.onload=M(On,n,r,"TestLoadImage: loaded",!0,e),r.onerror=M(On,n,r,"TestLoadImage: error",!1,e),r.onabort=M(On,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=M(On,n,r,"TestLoadImage: timeout",!1,e),S.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.la(e),sr(t),Kn(t)}function sr(t){t.u=0,t.A=-1,t.c&&(0==Sn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function ur(t,e,n){var r,i,o,s,u,a,h=(r=n)instanceof Xe?$e(r):new Xe(r,void 0);if(""!=h.c)e&&Ze(h,e+"."+h.c),tn(h,h.h);else{var c=S.location;i=c.protocol,o=e?e+"."+c.hostname:c.hostname,s=+c.port,u=n,a=new Xe(null,void 0),i&&Je(a,i),o&&Ze(a,o),s&&tn(a,s),u&&(a.g=u),h=a}return t.N&&J(t.N,function(t,e){nn(h,e,t)}),e=t.s,n=t.ha,e&&n&&nn(h,e,n),nn(h,"VER",t.oa),Jn(t,h),h}function ar(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Vn(t.Ea)).F=t.w,e}function hr(){}function cr(){if(st&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function fr(t,e){zt.call(this),this.a=new Qn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!W(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!W(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new dr(this)}function lr(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){ke.call(this),this.status=1}function dr(t){this.a=t}(N=Vn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ne(this.G):Ne(Ae),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void jn(this,t)}t=n||"";var i,o=new Qe(this.headers);r&&We(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=S.FormData&&t instanceof S.FormData,0<=F(Cn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.B=(i=this.a,st&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=oe(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){jn(this,t)}},N.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},N.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Fn(this))},N.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fn(this,!0)),Vn.M.C.call(this)},N.va=function(){this.j||(this.w||this.l||this.g?qn(this):this.Oa())},N.Oa=function(){qn(this)},N.S=function(){try{return 2<Gn(this)?this.a.status:-1}catch(t){return-1}},N.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},N.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Rn(e)}},N.qa=function(){return this.h},N.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(N=Qn.prototype).oa=8,N.u=1,N.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new Oe(this,t,void 0),r=this.j;if(this.F&&(r?et(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),nn(i=$e(this.v),"RID",t),nn(i,"CVER",22),this.s&&nn(i,"X-HTTP-Session-Id",this.s),Jn(this,i),this.h&&r&&zn(i,this.h,r),_n(this.b,n),this.fa?(nn(i,"$req",e),nn(i,"SID","null"),n.R=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?$n(this,t):0==this.f.length||Tn(this.b)||$n(this))},N.wa=function(){this.i=null,this.a=new Oe(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=$e(this.ea);nn(t,"RID","rpc"),nn(t,"SID",this.B),nn(t,"CI",this.U?"0":"1"),nn(t,"AID",this.G),Jn(this,t),nn(t,"TYPE","xmlhttp"),this.h&&this.j&&zn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=rn($e(t)),e.j=null,e.F=!0,Ce(e,n)},N.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,er(this),ge(19))},N.Ta=function(t){ge(t?2:1)},(N=hr.prototype).na=function(){},N.ma=function(){},N.la=function(){},N.ka=function(){},N.Ha=function(){},cr.prototype.a=function(t,e){return new fr(t,e)},U(fr,zt),(N=fr.prototype).addEventListener=function(t,e,n,r){fr.M.addEventListener.call(this,t,e,n,r)},N.removeEventListener=function(t,e,n,r){fr.M.removeEventListener.call(this,t,e,n,r)},N.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(0),t.P=e,t.N=n||{},t.U=t.W,t.v=ur(t,null,t.P),Xn(t)},N.close=function(){Hn(this.a)},N.La=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.g?((e={}).__data__=Qt(t),Yn(this.a,e)):Yn(this.a,t)},N.C=function(){this.a.c=null,delete this.f,Hn(this.a),delete this.a,fr.M.C.call(this)},U(lr,De),U(pr,ke),U(dr,hr),dr.prototype.na=function(){this.a.dispatchEvent("a")},dr.prototype.ma=function(t){this.a.dispatchEvent(new lr(t))},dr.prototype.la=function(t){this.a.dispatchEvent(new pr)},dr.prototype.ka=function(){this.a.dispatchEvent("b")},cr.prototype.createWebChannel=cr.prototype.a,fr.prototype.send=fr.prototype.La,fr.prototype.open=fr.prototype.Ka,fr.prototype.close=fr.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(_e.EventType=Se).OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",zt.prototype.listen=zt.prototype.ra,Vn.prototype.listenOnce=Vn.prototype.sa,Vn.prototype.getLastError=Vn.prototype.Ma,Vn.prototype.getLastErrorCode=Vn.prototype.qa,Vn.prototype.getStatus=Vn.prototype.S,Vn.prototype.getResponseJson=Vn.prototype.Ja,Vn.prototype.getResponseText=Vn.prototype.Y,Vn.prototype.send=Vn.prototype.$;var yr={createWebChannelTransport:function(){return new cr},ErrorCode:Ee,EventType:Te,WebChannel:_e,XhrIo:Vn},vr=yr.createWebChannelTransport,mr=yr.ErrorCode,gr=yr.EventType,wr=yr.WebChannel,br=yr.XhrIo,Er=lp.SDK_VERSION,Tr=(Ir.prototype.t=function(){return null!=this.uid},Ir.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Ir.prototype.isEqual=function(t){return t.uid===this.uid},Ir);function Ir(t){this.uid=t}Tr.UNAUTHENTICATED=new Tr(null),Tr.i=new Tr("google-credentials-uid"),Tr.h=new Tr("first-party-uid");function Nr(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}var _r,Ar,Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=(n(Wr,Ar=Error),Wr),kr=(zr.prototype.getToken=function(){return Promise.resolve(null)},zr.prototype._=function(){},zr.prototype.l=function(t){(this.u=t)(Tr.UNAUTHENTICATED)},zr.prototype.T=function(){this.u=null},zr),xr=(Gr.prototype.getToken=function(){var e=this,n=this.m,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.m!==n)throw new Dr(Sr.ABORTED,"getToken aborted due to token change.");return t?(Zs("string"==typeof t.accessToken),new Nr(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Gr.prototype._=function(){this.forceRefresh=!0},Gr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},Gr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},Gr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Zs(null===t||"string"==typeof t),new Tr(t)},Gr),Or=(Object.defineProperty(Br.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Br),Rr=(Fr.prototype.getToken=function(){return Promise.resolve(new Or(this.P,this.V))},Fr.prototype.l=function(t){t(Tr.h)},Fr.prototype.T=function(){},Fr.prototype._=function(){},Fr),Vr=(qr.now=function(){return qr.fromMillis(Date.now())},qr.fromDate=function(t){return qr.fromMillis(t.getTime())},qr.fromMillis=function(t){var e=Math.floor(t/1e3);return new qr(e,1e6*(t-1e3*e))},qr.prototype.toDate=function(){return new Date(this.toMillis())},qr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},qr.prototype.p=function(t){return this.seconds===t.seconds?ru(this.nanoseconds,t.nanoseconds):ru(this.seconds,t.seconds)},qr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},qr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},qr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},qr),Pr=(Ur.v=function(t){return new Ur(t)},Ur.min=function(){return new Ur(new Vr(0,0))},Ur.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Ur.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Ur.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Ur.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Ur.prototype.C=function(){return this.timestamp},Ur),Lr=(Object.defineProperty(jr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),jr.prototype.isEqual=function(t){return 0===jr.N(this,t)},jr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof jr?t.forEach(function(t){e.push(t)}):e.push(t),this.$(e)},jr.prototype.limit=function(){return this.offset+this.length},jr.prototype.k=function(t){return t=void 0===t?1:t,this.$(this.segments,this.offset+t,this.length-t)},jr.prototype.M=function(){return this.$(this.segments,this.offset,this.length-1)},jr.prototype.L=function(){return this.segments[this.offset]},jr.prototype.O=function(){return this.get(this.length-1)},jr.prototype.get=function(t){return this.segments[this.offset+t]},jr.prototype.B=function(){return 0===this.length},jr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},jr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},jr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},jr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},jr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},jr),Cr=(n(Mr,_r=Lr),Mr.prototype.$=function(t,e,n){return new Mr(t,e,n)},Mr.prototype.j=function(){return this.W().join("/")},Mr.prototype.toString=function(){return this.j()},Mr.K=function(t){if(0<=t.indexOf("//"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Mr(t.split("/").filter(function(t){return 0<t.length}))},Mr);function Mr(){return null!==_r&&_r.apply(this,arguments)||this}function jr(t,e,n){void 0===e?e=0:e>t.length&&Js(),void 0===n?n=t.length-e:n>t.length-e&&Js(),this.segments=t,this.offset=e,this.F=n}function Ur(t){this.timestamp=t}function qr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Fr(t,e){this.P=t,this.V=e}function Br(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=Tr.h}function Gr(t){var e=this;this.I=null,this.currentUser=Tr.UNAUTHENTICATED,this.R=!1,this.m=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.m++,e.currentUser=e.A(),e.R=!0,e.u&&e.u(e.currentUser)},this.m=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function zr(){this.u=null}function Wr(t,e){var n=this;return(n=Ar.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Cr.G=new Cr([]);var Qr,Hr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kr=(n(Yr,Qr=Lr),Yr.prototype.$=function(t,e,n){return new Yr(t,e,n)},Yr.H=function(t){return Hr.test(t)},Yr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Yr.H(t)||(t="`"+t+"`"),t}).join(".")},Yr.prototype.toString=function(){return this.j()},Yr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Yr.J=function(){return new Yr(["__name__"])},Yr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Dr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Dr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Yr(e)},Yr);function Yr(){return null!==Qr&&Qr.apply(this,arguments)||this}Kr.G=new Kr([]);var Xr=($r.Z=function(t){return new $r(Cr.K(t).k(5))},$r.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},$r.prototype.isEqual=function(t){return null!==t&&0===Cr.N(this.path,t.path)},$r.prototype.toString=function(){return this.path.toString()},$r.N=function(t,e){return Cr.N(t.path,e.path)},$r.et=function(t){return t.length%2==0},$r.st=function(t){return new $r(new Cr(t.slice()))},$r);function $r(t){this.path=t}function Jr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Xr.EMPTY=new Xr(new Cr([]));var ei=(ni.fromBase64String=function(t){return new ni(zs.nt().atob(t))},ni.fromUint8Array=function(t){return new ni(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ni.prototype.toBase64=function(){return zs.nt().btoa(this.it)},ni.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},ni.prototype.rt=function(){return 2*this.it.length},ni.prototype.S=function(t){return ru(this.it,t.it)},ni.prototype.isEqual=function(t){return this.it===t.it},ni);function ni(t){this.it=t}function ri(t){return null==t}function ii(t){return-0===t&&1/t==-1/0}function oi(t){return"number"==typeof t&&Number.isInteger(t)&&!ii(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ui(t){var e=yi(t.mapValue.fields.__local_write_time__.timestampValue);return new Vr(e.seconds,e.nanos)}ei.ht=new ei("");var ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?si(t)?4:10:Js()}function ci(i,t){var e,n,r,o=hi(i);if(o!==hi(t))return!1;switch(o){case 0:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return ui(i).isEqual(ui(t));case 3:return function(t){if("string"==typeof i.timestampValue&&"string"==typeof t.timestampValue&&i.timestampValue.length===t.timestampValue.length)return i.timestampValue===t.timestampValue;var e=yi(i.timestampValue),n=yi(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(t);case 5:return i.stringValue===t.stringValue;case 6:return r=t,mi(i.bytesValue).isEqual(mi(r.bytesValue));case 7:return i.referenceValue===t.referenceValue;case 8:return n=t,vi((e=i).geoPointValue.latitude)===vi(n.geoPointValue.latitude)&&vi(e.geoPointValue.longitude)===vi(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vi(t.integerValue)===vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=vi(t.doubleValue),r=vi(e.doubleValue);return n===r?ii(n)===ii(r):isNaN(n)&&isNaN(r)}return!1}(i,t);case 9:return iu(i.arrayValue.values||[],t.arrayValue.values||[],ci);case 10:return function(t){var e=i.mapValue.fields||{},n=t.mapValue.fields||{};if(Jr(e)!==Jr(n))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(void 0===n[r]||!ci(e[r],n[r])))return!1;return!0}(t);default:return Js()}}function fi(t,e){return void 0!==(t.values||[]).find(function(t){return ci(t,e)})}function li(t,e){var n,r,i,o,s,u,a,h,c,f,l=hi(t),p=hi(e);if(l!==p)return ru(l,p);switch(l){case 0:return 0;case 1:return ru(t.booleanValue,e.booleanValue);case 2:return h=e,c=vi(t.integerValue||t.doubleValue),f=vi(h.integerValue||h.doubleValue),c<f?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return pi(t.timestampValue,e.timestampValue);case 4:return pi(ui(t),ui(e));case 5:return ru(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=mi(o),a=mi(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ru(n[i],r[i]);if(0!==o)return o}return ru(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=ru(vi(n.latitude),vi(r.latitude)))?i:ru(vi(n.longitude),vi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=li(n[i],r[i]);if(o)return o}return ru(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=ru(r[s],o[s]);if(0!==u)return u;var a=li(n[r[s]],i[o[s]]);if(0!==a)return a}return ru(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Js()}}function pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ru(t,e);var n=yi(t),r=yi(e),i=ru(n.seconds,r.seconds);return 0!==i?i:ru(n.nanos,r.nanos)}function di(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=yi(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?mi(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Xr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Js();var t,e,n}(t)}function yi(t){if(Zs(!!t),"string"!=typeof t)return{seconds:vi(t.seconds),nanos:vi(t.nanos)};var e=0,n=ai.exec(t);if(Zs(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mi(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function gi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function wi(t){return t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ei(t){return t&&"nullValue"in t}function Ti(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return t&&"mapValue"in t}var Ni=(_i.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},_i.prototype.at=function(t,e){return e},_i.prototype.ut=function(t){return null},_i.prototype.isEqual=function(t){return t instanceof _i},_i);function _i(){}Ni.instance=new Ni;var Ai=(Oi.prototype.ot=function(t,e){return this.apply(t)},Oi.prototype.at=function(t,e){return this.apply(t)},Oi.prototype.apply=function(t){for(var n=Ri(t),e=function(e){n.some(function(t){return ci(t,e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},Oi.prototype.ut=function(t){return null},Oi.prototype.isEqual=function(t){return t instanceof Oi&&iu(this.elements,t.elements,ci)},Oi),Si=(xi.prototype.ot=function(t,e){return this.apply(t)},xi.prototype.at=function(t,e){return this.apply(t)},xi.prototype.apply=function(t){for(var n=Ri(t),e=function(e){n=n.filter(function(t){return!ci(t,e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return{arrayValue:{values:n}}},xi.prototype.ut=function(t){return null},xi.prototype.isEqual=function(t){return t instanceof xi&&iu(this.elements,t.elements,ci)},xi),Di=(ki.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return wi(n)&&wi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},ki.prototype.at=function(t,e){return e},ki.prototype.ut=function(t){return wi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},ki.prototype.isEqual=function(t){return t instanceof ki&&ci(this.ct,t.ct)},ki.prototype.asNumber=function(t){return vi(t.integerValue||t.doubleValue)},ki);function ki(t,e){this.serializer=t,this.ct=e}function xi(t){this.elements=t}function Oi(t){this.elements=t}function Ri(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Vi(t,e){this.version=t,this.transformResults=e}var Pi,Li,Ci,Mi,ji,Ui=(so.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},so.prototype.isEqual=function(t){return iu(this.fields,t.fields,function(t,e){return t.isEqual(e)})},so),qi=(oo.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},oo),Fi=(io.ft=function(){return new io},io.exists=function(t){return new io(void 0,t)},io.updateTime=function(t){return new io(t)},Object.defineProperty(io.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),io.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof To&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof To},io.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},io),Bi=(ro.prototype.It=function(t){},ro.wt=function(t){return t instanceof To?t.version:Pr.min()},ro),Gi=(n(no,ji=Bi),no.prototype.at=function(t,e){this.It(t);var n=e.version;return new To(this.key,n,this.value,{hasCommittedMutations:!0})},no.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Bi.wt(t);return new To(this.key,r,this.value,{At:!0})},no.prototype.Pt=function(t){return null},no.prototype.isEqual=function(t){return t instanceof no&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},no),zi=(n(eo,Mi=Bi),eo.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.gt(t);return new To(this.key,e.version,n,{hasCommittedMutations:!0})},eo.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Bi.wt(t),i=this.gt(t);return new To(this.key,r,i,{At:!0})},eo.prototype.Pt=function(t){return null},eo.prototype.isEqual=function(t){return t instanceof eo&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},eo.prototype.gt=function(t){var e;return e=t instanceof To?t.data():Ki.empty(),this.pt(e)},eo.prototype.pt=function(t){var n=this,r=new Yi(t);return this.Vt.fields.forEach(function(t){if(!t.B()){var e=n.data.field(t);null!==e?r.set(t,e):r.delete(t)}}),r.yt()},eo),Wi=(n(to,Ci=Bi),to.prototype.at=function(t,e){if(this.It(t),Zs(null!=e.transformResults),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new To(this.key,i,o,{hasCommittedMutations:!0})},to.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new To(this.key,r.version,o,{At:!0})},to.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof To?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Yi).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},to.prototype.isEqual=function(t){return t instanceof to&&this.key.isEqual(t.key)&&iu(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},to.prototype.bt=function(t){return t},to.prototype.vt=function(t,e){var n=[];Zs(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof To&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},to.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof To&&(a=e.field(s.field)),null===a&&n instanceof To&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},to.prototype.St=function(t,e){for(var n=new Yi(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},to),Qi=(n(Zi,Li=Bi),Zi.prototype.at=function(t,e){return this.It(t),new Io(this.key,e.version,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new Io(this.key,Pr.min()):t},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Zi),Hi=(n(Ji,Pi=Bi),Ji.prototype.at=function(t,e){Js()},Ji.prototype.ot=function(t,e,n){Js()},Ji.prototype.Pt=function(t){Js()},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Ji),Ki=($i.empty=function(){return new $i({mapValue:{}})},$i.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ii(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},$i.prototype.isEqual=function(t){return ci(this.proto,t.proto)},$i),Yi=(Xi.prototype.set=function(t,e){return this.Nt(t,e),this},Xi.prototype.delete=function(t){return this.Nt(t,null),this},Xi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===hi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Xi.prototype.yt=function(){var t=this.$t(Kr.G,this.Ft);return null!=t?new Ki(t):this.Ct},Xi.prototype.$t=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=Ii(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=i.$t(r.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Xi);function Xi(t){void 0===t&&(t=Ki.empty()),this.Ct=t,this.Ft=new Map}function $i(t){this.proto=t}function Ji(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Zi(t,e){var n=this;return(n=Li.call(this)||this).key=t,n.Rt=e,n.type=3,n}function to(t,e){var n=this;return(n=Ci.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=Fi.exists(!0),n}function eo(t,e,n,r){var i=this;return(i=Mi.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function no(t,e,n){var r=this;return(r=ji.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function ro(){}function io(t,e){this.updateTime=t,this.exists=e}function oo(t,e){this.field=t,this.transform=e}function so(t){(this.fields=t).sort(Kr.N)}function uo(t){var u=[];return Zr(t.fields||{},function(t,e){var n=new Kr([t]);if(Ii(e)){var r=uo(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ui(u)}function ao(t,e){this.key=t,this.version=e}function ho(t){this.count=t}var co,fo,lo,po,yo,vo,mo,go,wo,bo,Eo,To=(n(Yo,Eo=ao),Yo.prototype.field=function(t){return this.kt.field(t)},Yo.prototype.data=function(){return this.kt},Yo.prototype.Mt=function(){return this.kt.proto},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.kt.isEqual(t.kt)},Yo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.kt.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Yo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Yo),Io=(n(Ko,bo=ao),Ko.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ko.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ko.prototype.isEqual=function(t){return t instanceof Ko&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ko),No=(n(Ho,wo=ao),Ho.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ho.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ho.prototype.isEqual=function(t){return t instanceof Ho&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ho),_o=(Qo.prototype.canonicalId=function(){if(null===this.Lt){var t=this.path.j();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ri(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t}return this.Lt},Qo.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ri(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Qo.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Qo.prototype.Ot=function(){return Xr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Qo),Ao=(Wo.Wt=function(t){return new Wo(t)},Object.defineProperty(Wo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Po(t)),this.qt.push(new Po(Kr.J(),"asc"));else{for(var n=!1,r=0,i=this.xt;r<i.length;r++){var o=i[r];this.qt.push(o),o.field.Y()&&(n=!0)}if(!n){var s=0<this.xt.length?this.xt[this.xt.length-1].dir:"asc";this.qt.push(new Po(Kr.J(),s))}}}return this.qt},enumerable:!0,configurable:!0}),Wo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Wo(this.path,this.collectionGroup,this.xt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.zt=function(t){var e=this.xt.concat([t]);return new Wo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.Ht=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Wo.prototype.Yt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Wo.prototype.Jt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Wo.prototype.Xt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Wo.prototype.Zt=function(t){return new Wo(t,null,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.xt.length||1===this.xt.length&&this.xt[0].field.Y())},Wo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Wo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Wo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Wo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Wo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Wo.prototype.oe=function(){return!ri(this.limit)&&"F"===this.Bt},Wo.prototype.ae=function(){return!ri(this.limit)&&"L"===this.Bt},Wo.prototype.Kt=function(){return 0<this.xt.length?this.xt[0].field:null},Wo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof So&&n.ue())return n.field}return null},Wo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof So&&0<=t.indexOf(r.op))return r.op}return null},Wo.prototype.Ot=function(){return this.ee().Ot()},Wo.prototype._e=function(){return null!==this.collectionGroup},Wo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new _o(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Po(r.field,i))}var o=this.endAt?new Vo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Vo(this.startAt.position,!this.startAt.before):null;this.Ut=new _o(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Wo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Xr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Wo.prototype.ne=function(t){for(var e=0,n=this.xt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Wo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Wo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Wo.prototype.Qt=function(t){},Wo),So=(n(zo,go=function(){}),zo.create=function(t,e,n){if(t.Y())return"in"===e?new ko(t,n):new Do(t,e,n);if(Ei(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new zo(t,e,n)}if(Ti(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new zo(t,e,n)}return"array-contains"===e?new xo(t,n):"in"===e?new Oo(t,n):"array-contains-any"===e?new Ro(t,n):new zo(t,e,n)},zo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&hi(this.value)===hi(e)&&this.de(li(e,this.value))},zo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Js()}},zo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},zo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+di(this.value)},zo.prototype.isEqual=function(t){return t instanceof zo&&this.op===t.op&&this.field.isEqual(t.field)&&ci(this.value,t.value)},zo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+di(this.value)},zo),Do=(n(Go,mo=So),Go.prototype.matches=function(t){var e=Xr.N(t.key,this.key);return this.de(e)},Go),ko=(n(Bo,vo=So),Bo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Bo),xo=(n(Fo,yo=So),Fo.prototype.matches=function(t){var e=t.field(this.field);return bi(e)&&fi(e.arrayValue,this.value)},Fo),Oo=(n(qo,po=So),qo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&fi(this.value.arrayValue,e)},qo),Ro=(n(Uo,lo=So),Uo.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!bi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return fi(e.value.arrayValue,t)})},Uo),Vo=(jo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(function(t){return di(t)}).join(",")},jo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(n=i.field.Y()?Xr.N(Xr.Z(o.referenceValue),e.key):li(o,e.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},jo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ci(this.position[e],t.position[e]))return!1;return!0},jo),Po=(Mo.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Xr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?li(i,o):Js());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return Js()}},Mo.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Mo.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Mo.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Mo),Lo=(Co.prototype.Ie=function(t){return new Co(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Co.prototype.we=function(t,e){return new Co(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Co.prototype.Re=function(t){return new Co(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Co);function Co(t,e,n,r,i,o,s){void 0===i&&(i=Pr.min()),void 0===o&&(o=Pr.min()),void 0===s&&(s=ei.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Mo(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function jo(t,e){this.position=t,this.before=e}function Uo(t,e){return lo.call(this,t,"array-contains-any",e)||this}function qo(t,e){return po.call(this,t,"in",e)||this}function Fo(t,e){return yo.call(this,t,"array-contains",e)||this}function Bo(t,e){var n=this;return(n=vo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Xr.Z(t.referenceValue)}),n}function Go(t,e,n){var r=this;return(r=mo.call(this,t,e,n)||this).key=Xr.Z(n.referenceValue),r}function zo(t,e,n){var r=this;return(r=go.call(this)||this).field=t,r.op=e,r.value=n,r}function Wo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Qo(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function Ho(){return null!==wo&&wo.apply(this,arguments)||this}function Ko(t,e,n){var r=this;return(r=bo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Yo(t,e,n,r){var i=this;return(i=Eo.call(this,t,e)||this).kt=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Xo(t){switch(t){case Sr.OK:return Js();case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return 1;default:return Js()}}function $o(t){if(void 0===t)return Xs("GRPC error has no .code"),Sr.UNKNOWN;switch(t){case co.OK:return Sr.OK;case co.CANCELLED:return Sr.CANCELLED;case co.UNKNOWN:return Sr.UNKNOWN;case co.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case co.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case co.INTERNAL:return Sr.INTERNAL;case co.UNAVAILABLE:return Sr.UNAVAILABLE;case co.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case co.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case co.NOT_FOUND:return Sr.NOT_FOUND;case co.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case co.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case co.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case co.ABORTED:return Sr.ABORTED;case co.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case co.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case co.DATA_LOSS:return Sr.DATA_LOSS;default:return Js()}}(fo=co=co||{})[fo.OK=0]="OK",fo[fo.CANCELLED=1]="CANCELLED",fo[fo.UNKNOWN=2]="UNKNOWN",fo[fo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fo[fo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fo[fo.NOT_FOUND=5]="NOT_FOUND",fo[fo.ALREADY_EXISTS=6]="ALREADY_EXISTS",fo[fo.PERMISSION_DENIED=7]="PERMISSION_DENIED",fo[fo.UNAUTHENTICATED=16]="UNAUTHENTICATED",fo[fo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fo[fo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fo[fo.ABORTED=10]="ABORTED",fo[fo.OUT_OF_RANGE=11]="OUT_OF_RANGE",fo[fo.UNIMPLEMENTED=12]="UNIMPLEMENTED",fo[fo.INTERNAL=13]="INTERNAL",fo[fo.UNAVAILABLE=14]="UNAVAILABLE",fo[fo.DATA_LOSS=15]="DATA_LOSS";var Jo=(rs.prototype.me=function(t,e){return new rs(this.N,this.root.me(t,e,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.remove=function(t){return new rs(this.N,this.root.remove(t,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},rs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},rs.prototype.B=function(){return this.root.B()},Object.defineProperty(rs.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),rs.prototype.Ve=function(){return this.root.Ve()},rs.prototype.ge=function(){return this.root.ge()},rs.prototype.pe=function(t){return this.root.pe(t)},rs.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},rs.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},rs.prototype.ye=function(t){return this.root.ye(t)},rs.prototype.be=function(){return new Zo(this.root,null,this.N,!1)},rs.prototype.ve=function(t){return new Zo(this.root,t,this.N,!1)},rs.prototype.Se=function(){return new Zo(this.root,null,this.N,!0)},rs.prototype.De=function(t){return new Zo(this.root,t,this.N,!0)},rs),Zo=(ns.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},ns.prototype.$e=function(){return 0<this.Fe.length},ns.prototype.ke=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},ns),ts=(es.prototype.Ae=function(t,e,n,r,i){return new es(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},es.prototype.B=function(){return!1},es.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},es.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},es.prototype.min=function(){return this.left.B()?this:this.left.min()},es.prototype.Ve=function(){return this.min().key},es.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},es.prototype.me=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.Ae(null,null,null,r.left.me(t,e,n),null):0===i?r.Ae(null,e,null,null,null):r.Ae(null,null,null,null,r.right.me(t,e,n))).Me()},es.prototype.Le=function(){if(this.left.B())return es.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.xe()),(t=t.Ae(null,null,null,t.left.Le(),null)).Me()},es.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.xe()),r=r.Ae(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return es.EMPTY;n=r.right.min(),r=r.Ae(n.key,n.value,null,null,r.right.Le())}r=r.Ae(null,null,null,null,r.right.remove(t,e))}return r.Me()},es.prototype.Oe=function(){return this.color},es.prototype.Me=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},es.prototype.xe=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.Ae(null,null,null,null,t.right.Be())).Ue()).Qe()),t},es.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},es.prototype.Ue=function(){var t=this.Ae(null,null,es.RED,null,this.right.left);return this.right.Ae(null,null,this.color,t,null)},es.prototype.Be=function(){var t=this.Ae(null,null,es.RED,this.left.right,null);return this.left.Ae(null,null,this.color,null,t)},es.prototype.Qe=function(){var t=this.left.Ae(null,null,!this.left.color,null,null),e=this.right.Ae(null,null,!this.right.color,null,null);return this.Ae(null,null,!this.color,t,e)},es.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},es.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw Js();if(this.right.Oe())throw Js();var t=this.left.je();if(t!==this.right.je())throw Js();return t+(this.Oe()?0:1)},es);function es(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:es.RED,this.left=null!=r?r:es.EMPTY,this.right=null!=i?i:es.EMPTY,this.size=this.left.size+1+this.right.size}function ns(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function rs(t,e){this.N=t,this.root=e||ts.EMPTY}function is(){this.size=0}ts.EMPTY=null,ts.RED=!0,ts.Pe=!1,ts.EMPTY=(Object.defineProperty(is.prototype,"key",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"value",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"color",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"left",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"right",{get:function(){throw Js()},enumerable:!0,configurable:!0}),is.prototype.Ae=function(t,e,n,r,i){return this},is.prototype.me=function(t,e,n){return new ts(t,e)},is.prototype.remove=function(t,e){return this},is.prototype.B=function(){return!0},is.prototype.pe=function(t){return!1},is.prototype.ye=function(t){return!1},is.prototype.Ve=function(){return null},is.prototype.ge=function(){return null},is.prototype.Oe=function(){return!1},is.prototype.We=function(){return!0},is.prototype.je=function(){return 0},new is);var os=(hs.prototype.has=function(t){return null!==this.data.get(t)},hs.prototype.first=function(){return this.data.Ve()},hs.prototype.last=function(){return this.data.ge()},Object.defineProperty(hs.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),hs.prototype.indexOf=function(t){return this.data.indexOf(t)},hs.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},hs.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.$e();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},hs.prototype.Ge=function(t,e){var n;for(n=void 0!==e?this.data.ve(e):this.data.be();n.$e();)if(!t(n.Ne().key))return},hs.prototype.ze=function(t){var e=this.data.ve(t);return e.$e()?e.Ne().key:null},hs.prototype.be=function(){return new ss(this.data.be())},hs.prototype.ve=function(t){return new ss(this.data.ve(t))},hs.prototype.add=function(t){return this.Ae(this.data.remove(t).me(t,!0))},hs.prototype.delete=function(t){return this.has(t)?this.Ae(this.data.remove(t)):this},hs.prototype.B=function(){return this.data.B()},hs.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},hs.prototype.isEqual=function(t){if(!(t instanceof hs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},hs.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},hs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},hs.prototype.Ae=function(t){var e=new hs(this.N);return e.data=t,e},hs),ss=(as.prototype.Ne=function(){return this.Ye.Ne().key},as.prototype.$e=function(){return this.Ye.$e()},as),us=new Jo(Xr.N);function as(t){this.Ye=t}function hs(t){this.N=t,this.data=new Jo(this.N)}function cs(){return us}function fs(){return cs()}var ls=new Jo(Xr.N);function ps(){return ls}var ds=new Jo(Xr.N);function ys(){return ds}var vs=new os(Xr.N);function ms(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var gs=new os(ru);function ws(){return gs}function bs(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function Es(t,e){this.targetId=t,this.ms=e}function Ts(t,e,n,r){void 0===n&&(n=ei.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Is=(Cs.Ze=function(t){return new Cs(t.N)},Cs.prototype.has=function(t){return null!=this.Je.get(t)},Cs.prototype.get=function(t){return this.Je.get(t)},Cs.prototype.first=function(){return this.Xe.Ve()},Cs.prototype.last=function(){return this.Xe.ge()},Cs.prototype.B=function(){return this.Xe.B()},Cs.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(Cs.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),Cs.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},Cs.prototype.add=function(t){var e=this.delete(t.key);return e.Ae(e.Je.me(t.key,t),e.Xe.me(t,null))},Cs.prototype.delete=function(t){var e=this.get(t);return e?this.Ae(this.Je.remove(t),this.Xe.remove(e)):this},Cs.prototype.isEqual=function(t){if(!(t instanceof Cs))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},Cs.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Cs.prototype.Ae=function(t,e){var n=new Cs;return n.N=this.N,n.Je=t,n.Xe=e,n},Cs),Ns=(Ls.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.me(e,t):3===t.type&&1!==n.type?this.ts=this.ts.me(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.me(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.me(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):Js()},Ls.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},Ls),_s=(Ps.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Ps(t,e,Is.Ze(e),i,n,r,!0,!1)},Object.defineProperty(Ps.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),Ps.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Ps),As=(Vs.ls=function(t,e){var n=new Map;return n.set(t,Ss.ds(t,e)),new Vs(Pr.min(),n,ws(),cs(),ms())},Vs),Ss=(Rs.ds=function(t,e){return new Rs(ei.ht,e,ms(),ms(),ms())},Rs),Ds=(Object.defineProperty(Os.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"ys",{get:function(){return 0!==this.As},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Os.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Os.prototype.Ss=function(){var n=ms(),r=ms(),i=ms();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Js()}}),new Ss(this.Vs,this.gs,n,r,i)},Os.prototype.Ds=function(){this.ps=!1,this.Ps=js()},Os.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.me(t,e)},Os.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Os.prototype.Ns=function(){this.As+=1},Os.prototype.$s=function(){--this.As},Os.prototype.ks=function(){this.ps=!0,this.gs=!0},Os),ks=(xs.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof To?this.Us(r,t.Rs):t.Rs instanceof Io&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},xs.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.$s(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.$s(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.ks(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:Js()}})},xs.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ls.forEach(function(t,e){r.Gs(e)&&n(e)})},xs.prototype.Hs=function(t){var e=t.targetId,n=t.ms.count,r=this.Ys(e);if(r){var i=r.target;if(i.Ot())if(0===n){var o=new Xr(i.path);this.Qs(e,o,new Io(o,Pr.min()))}else Zs(1===n);else this.Js(e)!==n&&(this.zs(e),this.Bs=this.Bs.add(e))}},xs.prototype.Xs=function(i){var o=this,s=new Map;this.Ls.forEach(function(t,e){var n=o.Ys(e);if(n){if(t.fs&&n.target.Ot()){var r=new Xr(n.target.path);null!==o.Os.get(r)||o.Zs(e,r)||o.Qs(e,r,new Io(r,i))}t.bs&&(s.set(e,t.Ss()),t.Ds())}});var r=ms();this.xs.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new As(i,s,this.Bs,this.Os,r);return this.Os=cs(),this.xs=Ms(),this.Bs=new os(ru),t},xs.prototype.Us=function(t,e){if(this.Gs(t)){var n=this.Zs(t,e.key)?2:0;this.Ks(t).Cs(e.key,n),this.Os=this.Os.me(e.key,e),this.xs=this.xs.me(e.key,this.ti(e.key).add(t))}},xs.prototype.Qs=function(t,e,n){if(this.Gs(t)){var r=this.Ks(t);this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.xs=this.xs.me(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.me(e,n))}},xs.prototype.removeTarget=function(t){this.Ls.delete(t)},xs.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},xs.prototype.Ns=function(t){this.Ks(t).Ns()},xs.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new Ds,this.Ls.set(t,e)),e},xs.prototype.ti=function(t){var e=this.xs.get(t);return e||(e=new os(ru),this.xs=this.xs.me(t,e)),e},xs.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Ys("WatchChangeAggregator","Detected inactive target",t),e},xs.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},xs.prototype.zs=function(e){var n=this;this.Ls.set(e,new Ds),this.Ms.ei(e).forEach(function(t){n.Qs(e,t,null)})},xs.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},xs);function xs(t){this.Ms=t,this.Ls=new Map,this.Os=cs(),this.xs=Ms(),this.Bs=new os(ru)}function Os(){this.As=0,this.Ps=js(),this.Vs=ei.ht,this.gs=!1,this.ps=!0}function Rs(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function Vs(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function Ps(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ls(){this.ts=new Jo(Xr.N)}function Cs(n){this.N=n?function(t,e){return n(t,e)||Xr.N(t.key,e.key)}:function(t,e){return Xr.N(t.key,e.key)},this.Je=ps(),this.Xe=new Jo(this.N)}function Ms(){return new Jo(Xr.N)}function js(){return new Jo(Xr.N)}var Us={asc:"ASCENDING",desc:"DESCENDING"},qs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Fs=(Bs.prototype.ni=function(t){var e=void 0===t.code?Sr.UNKNOWN:$o(t.code);return new Dr(e,t.message||"")},Bs.prototype.ri=function(t){return this.options.hi||ri(t)?t:{value:t}},Bs.prototype.oi=function(t){var e;return ri(e="object"==typeof t?t.value:t)?null:e},Bs.prototype._t=function(t){return{integerValue:""+t}},Bs.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(t)?"-0":t}},Bs.prototype.ai=function(t){return oi(t)?this._t(t):this.lt(t)},Bs.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Bs.prototype.v=function(t){var e=yi(t);return new Vr(e.seconds,e.nanos)},Bs.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Bs.prototype.ci=function(t){return this.options.hi?(Zs(void 0===t||"string"==typeof t),ei.fromBase64String(t||"")):(Zs(void 0===t||t instanceof Uint8Array),ei.fromUint8Array(t||new Uint8Array))},Bs.prototype.toVersion=function(t){return this.C(t.C())},Bs.prototype.fromVersion=function(t){return Zs(!!t),Pr.v(this.v(t))},Bs.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Bs.prototype.di=function(t){var e=Cr.K(t);return Zs(Gs(e)),e},Bs.prototype.fi=function(t){return this._i(t.path)},Bs.prototype.Z=function(t){var e=this.di(t);return Zs(e.get(1)===this.ii.projectId),Zs(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Xr(this.Ti(e))},Bs.prototype.Ei=function(t){return this._i(t)},Bs.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Cr.G:this.Ti(e)},Object.defineProperty(Bs.prototype,"wi",{get:function(){return new Cr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Bs.prototype.li=function(t){return new Cr(["projects",t.projectId,"databases",t.database])},Bs.prototype.Ti=function(t){return Zs(4<t.length&&"documents"===t.get(4)),t.k(5)},Bs.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Bs.prototype.mi=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Bs.prototype.Ai=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Ki({mapValue:{fields:t.fields}});return new To(n,r,i,{hasCommittedMutations:!!e})},Bs.prototype.Pi=function(t){Zs(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Ki({mapValue:{fields:t.found.fields}});return new To(e,n,r,{})},Bs.prototype.Vi=function(t){Zs(!!t.missing),Zs(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new Io(e,n)},Bs.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):Js()},Bs.prototype.pi=function(t){var e;if("targetChange"in t){t.targetChange;var n=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=this.ci(t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&this.ni(o);e=new Ts(n,r,i,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var a=this.Z(u.document.name),h=this.fromVersion(u.document.updateTime),c=new Ki({mapValue:{fields:u.document.fields}}),f=new To(a,h,c,{}),l=u.targetIds||[],p=u.removedTargetIds||[];e=new bs(l,p,f.key,f)}else if("documentDelete"in t){t.documentDelete;var d=t.documentDelete;d.document;var y=this.Z(d.document),v=d.readTime?this.fromVersion(d.readTime):Pr.min(),m=new Io(y,v),g=d.removedTargetIds||[];e=new bs([],g,m.key,m)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=this.Z(w.document),E=w.removedTargetIds||[];e=new bs([],E,b,null)}else{if(!("filter"in t))return Js();t.filter;var T=t.filter;T.targetId;var I=T.count||0,N=new ho(I),_=T.targetId;e=new Es(_,N)}return e},Bs.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Js()},Bs.prototype.bi=function(t){if(!("targetChange"in t))return Pr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Pr.min():this.fromVersion(e.readTime)},Bs.prototype.vi=function(t){var e,n=this;if(t instanceof Gi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Qi)e={delete:this.fi(t.key)};else if(t instanceof zi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Wi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof Hi))return Js();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Bs.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):Fi.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Ki({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.$i(t.updateMask);return new zi(r,i,o,n)}return new Gi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Qi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.ki(t)});return Zs(!0===n.exists),new Wi(u,a)}if(t.verify){var h=this.Z(t.verify);return new Hi(h,n)}return Js()},Bs.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Js()},Bs.prototype.Ni=function(t){return void 0!==t.updateTime?Fi.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Fi.exists(t.exists):Fi.ft()},Bs.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Pr.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Vi(n,r)},Bs.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Zs(void 0!==e),t.map(function(t){return n.Mi(t,e)})):[]},Bs.prototype.Di=function(t){var e=t.transform;if(e instanceof Ni)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ai)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Si)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof Di)return{fieldPath:t.field.j(),increment:e.ct};throw Js()},Bs.prototype.ki=function(t){var e=null;if("setToServerValue"in t)Zs("REQUEST_TIME"===t.setToServerValue),e=Ni.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new Ai(n)}else if("removeAllFromArray"in t){var r=t.removeAllFromArray.values||[];e=new Si(r)}else"increment"in t?e=new Di(this,t.increment):Js();var i=Kr.X(t.fieldPath);return new qi(i,e)},Bs.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Bs.prototype.xi=function(t){Zs(1===t.documents.length);var e=t.documents[0];return Ao.Wt(this.Ii(e)).ee()},Bs.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Bs.prototype.Wi=function(t){var e=this.Ii(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Zs(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.ji(n.where));var u=[];n.orderBy&&(u=this.Ki(n.orderBy));var a=null;n.limit&&(a=this.oi(n.limit));var h=null;n.startAt&&(h=this.Gi(n.startAt));var c=null;return n.endAt&&(c=this.Gi(n.endAt)),new Ao(e,i,u,s,a,"F",h,c).ee()},Bs.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Bs.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Js()}},Bs.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Bs.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof So?e.Yi(t):Js()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Bs.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):Js():[]},Bs.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Bs.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Bs.prototype.Qi=function(t){return{before:t.before,values:t.position}},Bs.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new Vo(n,e)},Bs.prototype.en=function(t){return Us[t]},Bs.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Bs.prototype.nn=function(t){return qs[t]},Bs.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Js()}},Bs.prototype.hn=function(t){return{fieldPath:t.j()}},Bs.prototype.on=function(t){return Kr.X(t.fieldPath)},Bs.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Bs.prototype.tn=function(t){return new Po(this.on(t.field),this.sn(t.direction))},Bs.prototype.Xi=function(t){return So.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Bs.prototype.Yi=function(t){if("=="===t.op){if(Ti(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(Ei(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Bs.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Js()}},Bs.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Bs.prototype.$i=function(t){var e=t.fieldPaths||[];return new Ui(e.map(function(t){return Kr.X(t)}))},Bs);function Bs(t,e){this.ii=t,this.options=e}function Gs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var zs=(Qs.an=function(t){Qs.platform&&Js(),Qs.platform=t},Qs.nt=function(){return Qs.platform||Js(),Qs.platform},Qs),Ws=new h("@firebase/firestore");function Qs(){}function Hs(){return Ws.logLevel}function Ks(t){Ws.logLevel=t}function Ys(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ws.logLevel<=l.DEBUG){var r=e.map($s);Ws.debug.apply(Ws,i(["Firestore ("+Er+"): "+t],r))}}function Xs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ws.logLevel<=l.ERROR){var r=e.map($s);Ws.error.apply(Ws,i(["Firestore ("+Er+"): "+t],r))}}function $s(t){if("string"==typeof t)return t;var e=zs.nt();try{return e.un(t)}catch(e){return t}}function Js(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Er+") INTERNAL ASSERTION FAILED: "+t;throw Xs(e),new Error(e)}function Zs(t){t||Js()}function tu(t){return t}var eu=(nu.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=zs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},nu);function nu(){}function ru(t,e){return t<e?-1:e<t?1:0}function iu(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function ou(t){return t+"\0"}function su(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var uu=(Object.defineProperty(Su.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Su.prototype.isEqual=function(t){return t instanceof Su&&t.projectId===this.projectId&&t.database===this.database},Su.prototype.S=function(t){return ru(this.projectId,t.projectId)||ru(this.database,t.database)},Su),au=(Au.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},Au.prototype.has=function(t){return void 0!==this.get(t)},Au.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},Au.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},Au.prototype.forEach=function(u){Zr(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},Au.prototype.B=function(){return ti(this.fn)},Au),hu=(_u.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.at(e,s)}}return e},_u.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},_u.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.me(t.key,e))}),i},_u.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ms())},_u.prototype.isEqual=function(t){return this.batchId===t.batchId&&iu(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&iu(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},_u),cu=(Nu.from=function(t,e,n,r){Zs(t.mutations.length===n.length);for(var i=ys(),o=t.mutations,s=0;s<o.length;s++)i=i.me(o[s].key,n[s].version);return new Nu(t,e,n,r,i)},Nu),fu=(Iu.prototype.catch=function(t){return this.next(void 0,t)},Iu.prototype.next=function(r,i){var o=this;return this.Vn&&Js(),this.Vn=!0,this.Pn?this.error?this.gn(i,this.error):this.pn(r,this.result):new Iu(function(e,n){o.mn=function(t){o.pn(r,t).next(e,n)},o.An=function(t){o.gn(i,t).next(e,n)}})},Iu.prototype.yn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Iu.prototype.bn=function(t){try{var e=t();return e instanceof Iu?e:Iu.resolve(e)}catch(t){return Iu.reject(t)}},Iu.prototype.pn=function(t,e){return t?this.bn(function(){return t(e)}):Iu.resolve(e)},Iu.prototype.gn=function(t,e){return t?this.bn(function(){return t(e)}):Iu.reject(e)},Iu.resolve=function(n){return new Iu(function(t,e){t(n)})},Iu.reject=function(n){return new Iu(function(t,e){e(n)})},Iu.vn=function(t){return new Iu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Iu.Sn=function(t){for(var n=Iu.resolve(!1),e=function(e){n=n.next(function(t){return t?Iu.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Iu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.vn(i)},Iu),lu=(Object.defineProperty(Tu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),Tu.prototype.Nn=function(t,e){this.$n(),this.readTime=e,this.Dn.set(t.key,t)},Tu.prototype.kn=function(t,e){this.$n(),e&&(this.readTime=e),this.Dn.set(t,null)},Tu.prototype.Mn=function(t,e){this.$n();var n=this.Dn.get(e);return void 0!==n?fu.resolve(n):this.Ln(t,e)},Tu.prototype.getEntries=function(t,e){return this.On(t,e)},Tu.prototype.apply=function(t){return this.$n(),this.Cn=!0,this.xn(t)},Tu.prototype.$n=function(){},Tu),pu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",du=(Eu.prototype.qn=function(t){this.Bn.push(t)},Eu.prototype.Un=function(){this.Bn.forEach(function(t){return t()})},Eu),yu=(bu.prototype.Kn=function(e,n){var r=this;return this.Wn.Gn(e,n).next(function(t){return r.zn(e,n,t)})},bu.prototype.zn=function(t,r,i){return this.Qn.Mn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},bu.prototype.Hn=function(t,e,i){var o=fs();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.me(t,e)}),o},bu.prototype.Yn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Jn(e,t)})},bu.prototype.Jn=function(r,i){var o=this;return this.Wn.Xn(r,i).next(function(t){var e=o.Hn(r,i,t),n=cs();return e.forEach(function(t,e){e=e||new Io(t,Pr.min()),n=n.me(t,e)}),n})},bu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},bu.prototype.tr=function(t,e){return this.Kn(t,new Xr(e)).next(function(t){var e=ps();return t instanceof To&&(e=e.me(t.key,t)),e})},bu.prototype.er=function(n,r,i){var o=this,s=r.collectionGroup,u=ps();return this.jn.ir(n,s).next(function(t){return fu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.sr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.me(t,e)})})}).next(function(){return u})})},bu.prototype.sr=function(e,n,t){var c,f,r=this;return this.Qn.Zn(e,n,t).next(function(t){return c=t,r.Wn.nr(e,n)}).next(function(t){return f=t,r.rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof To?c.me(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},bu.prototype.rr=function(t,e,n){for(var r=ms(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof zi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof To&&(h=h.me(t,e))}),h})},bu),vu=(wu.ar=function(t,e){for(var n=ms(),r=ms(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new wu(t,e.fromCache,n,r)},wu),mu=(gu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},gu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},gu);function gu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function wu(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function bu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function Eu(){this.Bn=[]}function Tu(){this.Dn=new au(function(t){return t.toString()}),this.Cn=!1}function Iu(t){var e=this;this.mn=null,this.An=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t(function(t){e.Pn=!0,e.result=t,e.mn&&e.mn(t)},function(t){e.Pn=!0,e.error=t,e.An&&e.An(t)})}function Nu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function _u(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function Au(t){this.dn=t,this.fn={}}function Su(t,e){this.projectId=t,this.database=e||"(default)"}mu.dr=-1;function Du(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var ku=(xu.prototype.reset=function(){this.mr=0},xu.prototype.Vr=function(){this.mr=this.Rr},xu.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.mr+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Ys("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.mr+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ar=this.Tr.yr(this.Er,i,function(){return e.Pr=Date.now(),t()}),this.mr*=this.wr,this.mr<this.Ir&&(this.mr=this.Ir),this.mr>this.Rr&&(this.mr=this.Rr)},xu.prototype.cancel=function(){null!==this.Ar&&(this.Ar.cancel(),this.Ar=null)},xu.prototype.pr=function(){return(Math.random()-.5)*this.mr},xu);function xu(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.mr=0,this.Ar=null,this.Pr=Date.now(),this.reset()}function Ou(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Vu(e)),e=Ru(t.get(n),e);return Vu(e)}function Ru(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Vu(t){return t+""}function Pu(t){var e=t.length;if(Zs(2<=e),2===e)return Zs(""===t.charAt(0)&&""===t.charAt(1)),Cr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Js(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Js()}o=s+2}return new Cr(r)}var Lu=(qu.prototype.vr=function(t,e){return this.br.add(e),fu.resolve()},qu.prototype.ir=function(t,e){return fu.resolve(this.br.getEntries(e))},qu),Cu=(Uu.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new os(Cr.N),i=!r.has(n);return this.index[e]=r.add(n),i},Uu.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},Uu.prototype.getEntries=function(t){return(this.index[t]||new os(Cr.N)).W()},Uu),Mu=(ju.prototype.vr=function(t,e){var n=this;if(this.Sr.has(e))return fu.resolve();var r=e.O(),i=e.M();t.qn(function(){n.Sr.add(e)});var o={collectionId:r,parent:Ou(i)};return Fu(t).put(o)},ju.prototype.ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[ou(i),""],!1,!0);return Fu(t).Dr(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Pu(r.parent))}return o})},ju);function ju(){this.Sr=new Cu}function Uu(){this.index={}}function qu(){this.br=new Cu}function Fu(t){return aa.Cr(t,qa.store)}var Bu,Gu=(zu.prototype.Nn=function(t,e,n){return Qu(t).put(Hu(e),n)},zu.prototype.kn=function(t,e){var n=Qu(t),r=Hu(e);return n.delete(r)},zu.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Fr(e,t)})},zu.prototype.Mn=function(t,e){var n=this;return Qu(t).get(Hu(e)).next(function(t){return n.Nr(t)})},zu.prototype.$r=function(t,e){var n=this;return Qu(t).get(Hu(e)).next(function(t){var e=n.Nr(t);return e?{kr:e,size:Ku(t)}:null})},zu.prototype.getEntries=function(t,e){var r=this,i=fs();return this.Mr(t,e,function(t,e){var n=r.Nr(e);i=i.me(t,n)}).next(function(){return i})},zu.prototype.Lr=function(t,e){var r=this,i=fs(),o=new Jo(Xr.N);return this.Mr(t,e,function(t,e){var n=r.Nr(e);o=n?(i=i.me(t,n),o.me(t,Ku(e))):(i=i.me(t,null),o.me(t,0))}).next(function(){return{Or:i,xr:o}})},zu.prototype.Mr=function(t,e,i){if(e.B())return fu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Qu(t).Br({range:n},function(t,e,n){for(var r=Xr.st(t);s&&Xr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.$e()?o.Ne():null),s?n.qr(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.$e()?o.Ne():null})},zu.prototype.Zn=function(t,i,e){var o=this,s=ps(),u=i.path.length+1,n={};if(e.isEqual(Pr.min())){var r=i.path.W();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.W(),h=this.serializer.Ur(e);n.range=IDBKeyRange.lowerBound([a,h],!0),n.index=La.collectionReadTimeIndex}return Qu(t).Br(n,function(t,e,n){if(t.length===u){var r=o.serializer.Qr(e);i.path.q(r.key.path)?r instanceof To&&i.matches(r)&&(s=s.me(r.key,r)):n.done()}}).next(function(){return s})},zu.prototype.Wr=function(t,e){var r=this,i=cs(),o=this.serializer.Ur(e),n=Qu(t),s=IDBKeyRange.lowerBound(o,!0);return n.Br({index:La.readTimeIndex,range:s},function(t,e){var n=r.serializer.Qr(e);i=i.me(n.key,n),o=e.readTime}).next(function(){return{jr:i,readTime:r.serializer.Kr(o)}})},zu.prototype.Gr=function(t){var r=this,e=Qu(t),i=Pr.min();return e.Br({index:La.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.Kr(e.readTime)),n.done()}).next(function(){return i})},zu.prototype.zr=function(t){return new zu.Hr(this,!!t&&t.Yr)},zu.prototype.Jr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},zu.prototype.getMetadata=function(t){return Wu(t).get(Ca.key).next(function(t){return Zs(!!t),t})},zu.prototype.Fr=function(t,e){return Wu(t).put(Ca.key,e)},zu.prototype.Nr=function(t){if(t){var e=this.serializer.Qr(t);return e instanceof Io&&e.version.isEqual(Pr.min())?null:e}return null},zu);function zu(t,e){this.serializer=t,this.jn=e}function Wu(t){return aa.Cr(t,Ca.store)}function Qu(t){return aa.Cr(t,La.store)}function Hu(t){return t.path.W()}function Ku(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Js();e=t.noDocument}return JSON.stringify(e).length}function Yu(t,e){var n=this;return(n=Bu.call(this)||this).Xr=t,n.Yr=e,n.Zr=new au(function(t){return t.toString()}),n}Gu.Hr=(n(Yu,Bu=lu),Yu.prototype.xn=function(s){var u=this,a=[],h=0,c=new os(function(t,e){return ru(t.j(),e.j())});return this.Dn.forEach(function(t,e){var n=u.Zr.get(t);if(e){var r=u.Xr.serializer.th(e,u.readTime);c=c.add(t.path.M());var i=Ku(r);h+=i-n,a.push(u.Xr.Nn(s,t,r))}else if(h-=n,u.Yr){var o=u.Xr.serializer.th(new Io(t,Pr.min()),u.readTime);a.push(u.Xr.Nn(s,t,o))}else a.push(u.Xr.kn(s,t))}),c.forEach(function(t){a.push(u.Xr.jn.vr(s,t))}),a.push(this.Xr.updateMetadata(s,h)),fu.vn(a)},Yu.prototype.Ln=function(t,e){var n=this;return this.Xr.$r(t,e).next(function(t){return null===t?(n.Zr.set(e,0),null):(n.Zr.set(e,t.size),t.kr)})},Yu.prototype.On=function(t,e){var n=this;return this.Xr.Lr(t,e).next(function(t){var e=t.Or;return t.xr.forEach(function(t,e){n.Zr.set(t,e)}),e})},Yu);var Xu=(Zu.prototype.next=function(){return this.eh+=2,this.eh},Zu.sh=function(){return new Zu(0)},Zu.ih=function(){return new Zu(-1)},Zu),$u=(Ju.prototype.rh=function(n){var r=this;return this.hh(n).next(function(t){var e=new Xu(t.highestTargetId);return t.highestTargetId=e.next(),r.oh(n,t).next(function(){return t.highestTargetId})})},Ju.prototype.ah=function(t){return this.hh(t).next(function(t){return Pr.v(new Vr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ju.prototype.uh=function(t){return na(t._h)},Ju.prototype.lh=function(e,n,r){var i=this;return this.hh(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.oh(e,t)})},Ju.prototype.dh=function(e,n){var r=this;return this.fh(e,n).next(function(){return r.hh(e).next(function(t){return t.targetCount+=1,r.Th(n,t),r.oh(e,t)})})},Ju.prototype.Eh=function(t,e){return this.fh(t,e)},Ju.prototype.Ih=function(e,t){var n=this;return this.wh(e,t.targetId).next(function(){return ta(e).delete(t.targetId)}).next(function(){return n.hh(e)}).next(function(t){return Zs(0<t.targetCount),--t.targetCount,n.oh(e,t)})},Ju.prototype.Rh=function(r,i,o){var s=this,u=0,a=[];return ta(r).Br(function(t,e){var n=s.serializer.mh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.Ih(r,n)))}).next(function(){return fu.vn(a)}).next(function(){return u})},Ju.prototype.js=function(t,r){var i=this;return ta(t).Br(function(t,e){var n=i.serializer.mh(e);r(n)})},Ju.prototype.hh=function(t){return ea(t._h)},Ju.prototype.oh=function(t,e){return aa.Cr(t,Ua.store).put(Ua.key,e)},Ju.prototype.fh=function(t,e){return ta(t).put(this.serializer.Ah(e))},Ju.prototype.Th=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ju.prototype.Ph=function(t){return this.hh(t).next(function(t){return t.targetCount})},Ju.prototype.Vh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return ta(t).Br({range:n,index:Ma.queryTargetsIndexName},function(t,e,n){var r=o.serializer.mh(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Ju.prototype.gh=function(n,t,r){var i=this,o=[],s=ra(n);return t.forEach(function(t){var e=Ou(t.path);o.push(s.put(new ja(r,e))),o.push(i.nh.ph(n,r,t))}),fu.vn(o)},Ju.prototype.yh=function(n,t,r){var i=this,o=ra(n);return fu.forEach(t,function(t){var e=Ou(t.path);return fu.vn([o.delete([r,e]),i.nh.bh(n,r,t)])})},Ju.prototype.wh=function(t,e){var n=ra(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Ju.prototype.vh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ra(t),o=ms();return r.Br({range:n,Sh:!0},function(t,e,n){var r=Pu(t[1]),i=new Xr(r);o=o.add(i)}).next(function(){return o})},Ju.prototype.Dh=function(t,e){var n=Ou(e.path),r=IDBKeyRange.bound([n],[ou(n)],!1,!0),i=0;return ra(t).Br({index:ja.documentTargetsIndex,Sh:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ju.prototype.si=function(t,e){var n=this;return ta(t).get(e).next(function(t){return t?n.serializer.mh(t):null})},Ju);function Ju(t,e){this.nh=t,this.serializer=e}function Zu(t){this.eh=t}function ta(t){return aa.Cr(t,Ma.store)}function ea(t){return Wa.Cr(t,Ua.store).get(Ua.key).next(function(t){return Zs(null!==t),t})}function na(t){return ea(t).next(function(t){return t.highestListenSequenceNumber})}function ra(t){return aa.Cr(t,ja.store)}var ia,oa=(fa.prototype.Qr=function(t){if(t.document)return this.Ch.Ai(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Xr.st(t.noDocument.path),n=this.Fh(t.noDocument.readTime);return new Io(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Xr.st(t.unknownDocument.path),i=this.Fh(t.unknownDocument.version);return new No(r,i)}return Js()},fa.prototype.th=function(t,e){var n=this.Ur(e),r=t.key.path.M().W();if(t instanceof To){var i=this.Ch.mi(t),o=t.hasCommittedMutations;return new La(null,null,i,o,n,r)}if(t instanceof Io){var s=t.key.path.W(),u=this.Nh(t.version),a=t.hasCommittedMutations;return new La(null,new Va(s,u),null,a,n,r)}if(t instanceof No){var h=t.key.path.W(),c=this.Nh(t.version);return new La(new Pa(h,c),null,null,!0,n,r)}return Js()},fa.prototype.Ur=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},fa.prototype.Kr=function(t){var e=new Vr(t[0],t[1]);return Pr.v(e)},fa.prototype.Nh=function(t){var e=t.C();return new Aa(e.seconds,e.nanoseconds)},fa.prototype.Fh=function(t){var e=new Vr(t.seconds,t.nanoseconds);return Pr.v(e)},fa.prototype.$h=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Ch.vi(t)}),i=e.mutations.map(function(t){return n.Ch.vi(t)});return new xa(t,e.batchId,e.Tn.toMillis(),r,i)},fa.prototype.kh=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Ch.Fi(t)}),r=t.mutations.map(function(t){return e.Ch.Fi(t)}),i=Vr.fromMillis(t.localWriteTimeMs);return new hu(t.batchId,i,n,r)},fa.prototype.mh=function(t){var e,n=this.Fh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Fh(t.lastLimboFreeSnapshotVersion):Pr.min();return e=void 0!==t.query.documents?this.Ch.xi(t.query):this.Ch.Wi(t.query),new Lo(e,t.targetId,0,t.lastListenSequenceNumber,n,r,ei.fromBase64String(t.resumeToken))},fa.prototype.Ah=function(t){var e,n=this.Nh(t.Ee),r=this.Nh(t.lastLimboFreeSnapshotVersion);e=t.target.Ot()?this.Ch.Oi(t.target):this.Ch.Bi(t.target);var i=t.resumeToken.toBase64();return new Ma(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},fa),sa="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",ua=(n(ca,ia=du),ca),aa=(ha.Cr=function(t,e){if(t instanceof ua)return Wa.Cr(t._h,e);throw Js()},ha.prototype.start=function(){var e=this;return Wa.Yh(this.Kh,Na,new _a(this.serializer)).then(function(t){return e.Jh=t,e.Xh()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,sa);return e.Zh(),e.to(),e.eo(),e.Jh.runTransaction("readonly",[Ua.store],function(t){return na(t)})}).then(function(t){e.Oh=new mu(t,e.Lh)}).then(function(){e.xh=!0}).catch(function(t){return e.Jh&&e.Jh.close(),Promise.reject(t)})},ha.prototype.so=function(n){var t=this;return this.Wh=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.io?[2,n(e)]:[2]})})},n(this.isPrimary)},ha.prototype.no=function(n){var t=this;this.Jh.ro(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},ha.prototype.ho=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.oo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.io?[4,this.Xh()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},ha.prototype.Xh=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return pa(e).put(new Ba(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ao(e).next(function(t){t||(n.isPrimary=!1,n.Tr.oo(function(){return n.Wh(!1)}))})}).next(function(){return n.uo(e)}).next(function(t){return n.isPrimary&&!t?n.co(e).next(function(){return!1}):!!t&&n._o(e).next(function(){return!0})})}).catch(function(t){if(n.allowTabSynchronization)return Ys("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1;if($a(t))return Ys("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;throw t}).then(function(t){n.isPrimary!==t&&n.Tr.oo(function(){return n.Wh(t)}),n.isPrimary=t})},ha.prototype.ao=function(t){var e=this;return la(t).get(Sa.key).next(function(t){return fu.resolve(e.lo(t))})},ha.prototype.do=function(t){return pa(t).delete(this.clientId)},ha.prototype.fo=function(){return y(this,void 0,void 0,function(){var i=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.To(this.Qh,18e5)?[3,2]:(this.Qh=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=ha.Cr(t,Ba.store);return r.Dr().next(function(t){var e=i.Eo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return fu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.Io(t.clientId))}),t.label=2;case 2:return[2]}})})},ha.prototype.eo=function(){var t=this;this.Uh=this.Tr.yr("client_metadata_refresh",4e3,function(){return t.Xh().then(function(){return t.fo()}).then(function(){return t.eo()})})},ha.prototype.lo=function(t){return!!t&&t.ownerId===this.clientId},ha.prototype.uo=function(e){var i=this;return la(e).get(Sa.key).next(function(t){if(null!==t&&i.To(t.leaseTimestampMs,5e3)&&!i.wo(t.ownerId)){if(i.lo(t)&&i.networkEnabled)return!0;if(!i.lo(t)){if(!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,sa);return!1}}return!(!i.networkEnabled||!i.inForeground)||pa(e).Dr().next(function(t){return void 0===i.Eo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ys("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},ha.prototype.Ro=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.xh=!1,this.mo(),this.Uh&&(this.Uh.cancel(),this.Uh=null),this.Ao(),this.Po(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.co(t).next(function(){return e.do(t)})}).catch(function(t){Ys("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.Jh.close(),this.Vo(),[2]}})})},ha.prototype.Eo=function(t,e){var n=this;return t.filter(function(t){return n.To(t.updateTimeMs,e)&&!n.wo(t.clientId)})},ha.prototype.po=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return pa(t).Dr().next(function(t){return e.Eo(t,18e5).map(function(t){return t.clientId})})})},ha.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return ha.jh()?(e=n+ha.Gh,[4,Wa.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(ha.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),ha.prototype.yo=function(t){return ma.bo(t,this.serializer,this.jn,this.nh)},ha.prototype.vo=function(){return this.zh},ha.prototype.So=function(){return this.Qn},ha.prototype.Do=function(){return this.jn},ha.prototype.runTransaction=function(e,n,r){var i=this;Ys("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Jh.runTransaction(t,za,function(t){return o=new ua(t,i.Oh?i.Oh.next():mu.dr),"readwrite-primary"===n?i.ao(o).next(function(t){return!!t||i.uo(o)}).next(function(t){if(!t)throw Xs("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Tr.oo(function(){return i.Wh(!1)}),new Dr(Sr.FAILED_PRECONDITION,pu);return r(o)}).next(function(t){return i._o(o).next(function(){return t})}):i.Co(o).next(function(){return r(o)})}).then(function(t){return o.Un(),t})},ha.prototype.Co=function(t){var e=this;return la(t).get(Sa.key).next(function(t){if(null!==t&&e.To(t.leaseTimestampMs,5e3)&&!e.wo(t.ownerId)&&!e.lo(t)&&(!e.allowTabSynchronization||!t.allowTabSynchronization))throw new Dr(Sr.FAILED_PRECONDITION,sa)})},ha.prototype._o=function(t){var e=new Sa(this.clientId,this.allowTabSynchronization,Date.now());return la(t).put(Sa.key,e)},ha.jh=function(){return Wa.jh()},ha.Fo=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},ha.prototype.co=function(t){var e=this,n=la(t);return n.get(Sa.key).next(function(t){return e.lo(t)?(Ys("IndexedDbPersistence","Releasing primary lease."),n.delete(Sa.key)):fu.resolve()})},ha.prototype.To=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Xs("Detected an update time that is in the future: "+t+" > "+n),1))},ha.prototype.Zh=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qh=function(){t.Tr.oo(function(){return t.inForeground="visible"===t.document.visibilityState,t.Xh()})},this.document.addEventListener("visibilitychange",this.qh),this.inForeground="visible"===this.document.visibilityState)},ha.prototype.Ao=function(){this.qh&&(this.document.removeEventListener("visibilitychange",this.qh),this.qh=null)},ha.prototype.to=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Bh=function(){t.mo(),t.Tr.oo(function(){return t.Ro()})},this.window.addEventListener("unload",this.Bh))},ha.prototype.Po=function(){this.Bh&&(this.window.removeEventListener("unload",this.Bh),this.Bh=null)},ha.prototype.wo=function(t){try{var e=null!==this.Hh.getItem(this.Io(t));return Ys("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Xs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},ha.prototype.mo=function(){try{this.Hh.setItem(this.Io(this.clientId),String(Date.now()))}catch(t){Xs("Failed to set zombie client id.",t)}},ha.prototype.Vo=function(){try{this.Hh.removeItem(this.Io(this.clientId))}catch(t){}},ha.prototype.Io=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},ha);function ha(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.Lh=u,this.Oh=null,this.xh=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bh=null,this.inForeground=!1,this.qh=null,this.Uh=null,this.Qh=Number.NEGATIVE_INFINITY,this.Wh=function(t){return Promise.resolve()},!ha.jh())throw new Dr(Sr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.nh=new da(this,i),this.Kh=e+ha.Gh,this.serializer=new oa(s),this.document=r.document,this.zh=new $u(this.nh,this.serializer),this.jn=new Mu,this.Qn=new Gu(this.serializer,this.jn),!r.window||!r.window.localStorage)throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Hh=this.window.localStorage}function ca(t,e){var n=this;return(n=ia.call(this)||this)._h=t,n.Mh=e,n}function fa(t){this.Ch=t}function la(t){return aa.Cr(t,Sa.store)}function pa(t){return aa.Cr(t,Ba.store)}aa.Gh="main";var da=(ya.prototype.$o=function(t){var n=this.ko(t);return this.db.vo().Ph(t).next(function(e){return n.next(function(t){return e+t})})},ya.prototype.ko=function(t){var e=0;return this.Mo(t,function(t){e++}).next(function(){return e})},ya.prototype.js=function(t,e){return this.db.vo().js(t,e)},ya.prototype.Mo=function(t,n){return this.Lo(t,function(t,e){return n(e)})},ya.prototype.ph=function(t,e,n){return va(t,n)},ya.prototype.bh=function(t,e,n){return va(t,n)},ya.prototype.Rh=function(t,e,n){return this.db.vo().Rh(t,e,n)},ya.prototype.Oo=function(t,e){return va(t,e)},ya.prototype.xo=function(t,e){return r=e,i=!1,Ia(n=t).Bo(function(t){return wa(n,t,r).next(function(t){return t&&(i=!0),fu.resolve(!t)})}).next(function(){return i});var n,r,i},ya.prototype.qo=function(r,i){var o=this,s=this.db.So().zr(),u=[],a=0;return this.Lo(r,function(e,t){if(t<=i){var n=o.xo(r,e).next(function(t){if(!t)return a++,s.Mn(r,e).next(function(){return s.kn(e),ra(r).delete([0,Ou(e.path)])})});u.push(n)}}).next(function(){return fu.vn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},ya.prototype.removeTarget=function(t,e){var n=e.Ie(t.Mh);return this.db.vo().Eh(t,n)},ya.prototype.Uo=function(t,e){return va(t,e)},ya.prototype.Lo=function(t,o){var s,e=ra(t),u=mu.dr;return e.Br({index:ja.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==mu.dr&&o(new Xr(Pu(s)),u),u=i,s=r):u=mu.dr}).next(function(){u!==mu.dr&&o(new Xr(Pu(s)),u)})},ya.prototype.Qo=function(t){return this.db.So().Jr(t)},ya);function ya(t,e){this.db=t,this.No=new mh(this,e)}function va(t,e){return ra(t).put((n=e,r=t.Mh,new ja(0,Ou(n.path),r)));var n,r}var ma=(ga.bo=function(t,e,n,r){return Zs(""!==t.uid),new ga(t.t()?t.uid:"",e,n,r)},ga.prototype.jo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ea(t).Br({index:xa.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},ga.prototype.Ko=function(e,t,n){return this.Go(e).next(function(t){return t.lastStreamToken=n.toBase64(),Ia(e).put(t)})},ga.prototype.zo=function(t){return this.Go(t).next(function(t){return ei.fromBase64String(t.lastStreamToken)})},ga.prototype.Ho=function(e,n){return this.Go(e).next(function(t){return t.lastStreamToken=n.toBase64(),Ia(e).put(t)})},ga.prototype.Yo=function(h,c,f,l){var p=this,d=Ta(h),y=Ea(h);return y.add({}).next(function(t){Zs("number"==typeof t);for(var e=new hu(t,c,f,l),n=p.serializer.$h(p.userId,e),r=[],i=new os(function(t,e){return ru(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Oa.key(p.userId,u.key.path,t);i=i.add(u.key.path.M()),r.push(y.put(n)),r.push(d.put(a,Oa.PLACEHOLDER))}return i.forEach(function(t){r.push(p.jn.vr(h,t))}),h.qn(function(){p.Wo[t]=e.keys()}),fu.vn(r).next(function(){return e})})},ga.prototype.Jo=function(t,e){var n=this;return Ea(t).get(e).next(function(t){return t?(Zs(t.userId===n.userId),n.serializer.kh(t)):null})},ga.prototype.Xo=function(t,n){var r=this;return this.Wo[n]?fu.resolve(this.Wo[n]):this.Jo(t,n).next(function(t){if(t){var e=t.keys();return r.Wo[n]=e}return null})},ga.prototype.Zo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Ea(t).Br({index:xa.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Zs(e.batchId>=i),o=r.serializer.kh(e)),n.done()}).next(function(){return o})},ga.prototype.ta=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ea(t).Br({index:xa.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},ga.prototype.ea=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ea(t).Dr(xa.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.kh(t)})})},ga.prototype.Gn=function(u,a){var h=this,t=Oa.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return Ta(u).Br({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Pu(i);if(r===h.userId&&a.path.isEqual(s))return Ea(u).get(o).next(function(t){if(!t)throw Js();Zs(t.userId===h.userId),c.push(h.serializer.kh(t))});n.done()}).next(function(){return c})},ga.prototype.Xn=function(r,t){var a=this,h=new os(ru),i=[];return t.forEach(function(u){var t=Oa.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Ta(r).Br({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Pu(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),fu.vn(i).next(function(){return a.sa(r,h)})},ga.prototype.nr=function(t,e){var u=this,a=e.path,h=a.length+1,n=Oa.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new os(ru);return Ta(t).Br({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Pu(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.sa(t,c)})},ga.prototype.sa=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Ea(e).get(t).next(function(t){if(null===t)throw Js();Zs(t.userId===n.userId),r.push(n.serializer.kh(t))}))}),fu.vn(i).next(function(){return r})},ga.prototype.ia=function(e,n){var r=this;return ba(e._h,this.userId,n).next(function(t){return e.qn(function(){r.na(n.batchId)}),fu.forEach(t,function(t){return r.nh.Oo(e,t)})})},ga.prototype.na=function(t){delete this.Wo[t]},ga.prototype.ra=function(n){var o=this;return this.jo(n).next(function(t){if(!t)return fu.resolve();var e=IDBKeyRange.lowerBound(Oa.prefixForUser(o.userId)),i=[];return Ta(n).Br({range:e},function(t,e,n){if(t[0]===o.userId){var r=Pu(t[1]);i.push(r)}else n.done()}).next(function(){Zs(0===i.length)})})},ga.prototype.Dh=function(t,e){return wa(t,this.userId,e)},ga.prototype.Go=function(t){var e=this;return Ia(t).get(this.userId).next(function(t){return t||new ka(e.userId,-1,"")})},ga);function ga(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.nh=r,this.Wo={}}function wa(t,o,e){var n=Oa.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Ta(t).Br({range:r,Sh:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ba(t,e,n){var r=t.store(xa.store),i=t.store(Oa.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Br({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Zs(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=Oa.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return fu.vn(o).next(function(){return h})}function Ea(t){return aa.Cr(t,xa.store)}function Ta(t){return aa.Cr(t,Oa.store)}function Ia(t){return aa.Cr(t,ka.store)}var Na=10,_a=(Da.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Zs(t<e&&0<=t&&e<=Na);var o,s=new Ja(r);t<1&&1<=e&&(n.createObjectStore(Sa.store),(o=n).createObjectStore(ka.store,{keyPath:ka.keyPath}),o.createObjectStore(xa.store,{keyPath:xa.keyPath,autoIncrement:!0}).createIndex(xa.userMutationsIndex,xa.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Oa.store),Fa(n),n.createObjectStore(La.store));var u,a=fu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(ja.store),u.deleteObjectStore(Ma.store),u.deleteObjectStore(Ua.store),Fa(n)),a=a.next(function(){return t=s.store(Ua.store),e=new Ua(0,0,Pr.min().C(),0),t.put(Ua.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(xa.store).Dr().next(function(t){r.deleteObjectStore(xa.store),r.createObjectStore(xa.store,{keyPath:xa.keyPath,autoIncrement:!0}).createIndex(xa.userMutationsIndex,xa.userMutationsKeyPath,{unique:!0});var e=i.store(xa.store),n=t.map(function(t){return e.put(t)});return fu.vn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Ba.store,{keyPath:Ba.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Ca.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(La.store)).createIndex(La.readTimeIndex,La.readTimeIndexPath,{unique:!1}),t.createIndex(La.collectionReadTimeIndex,La.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Da.prototype.addDocumentGlobal=function(e){var n=0;return e.store(La.store).Br(function(t,e){n+=Ku(e)}).next(function(){var t=new Ca(n);return e.store(Ca.store).put(Ca.key,t)})},Da.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(ka.store),e=r.store(xa.store);return t.Dr().next(function(t){return fu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Dr(xa.userMutationsIndex,t).next(function(t){return fu.forEach(t,function(t){Zs(t.userId===n.userId);var e=i.serializer.kh(t);return ba(r,n.userId,e).next(function(){})})})})})},Da.prototype.ensureSequenceNumbers=function(t){var s=t.store(ja.store),e=t.store(La.store);return na(t).next(function(i){var o=[];return e.Br(function(t,e){var n=new Cr(t),r=[0,Ou(n)];o.push(s.get(r).next(function(t){return t?fu.resolve():(e=n,s.put(new ja(0,Ou(e),i)));var e}))}).next(function(){return fu.vn(o)})})},Da.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.O(),n=t.M();return r.put({collectionId:e,parent:Ou(n)})}}t.createObjectStore(qa.store,{keyPath:qa.keyPath});var r=e.store(qa.store),o=new Cu;return e.store(La.store).Br({Sh:!0},function(t,e){var n=new Cr(t);return i(n.M())}).next(function(){return e.store(Oa.store).Br({Sh:!0},function(t,e){t[0];var n=t[1],r=(t[2],Pu(n));return i(r.M())})})},Da.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Ma.store);return o.Br(function(t,e){var n=i.serializer.mh(e),r=i.serializer.Ah(n);return o.put(r)})},Da),Aa=function(t,e){this.seconds=t,this.nanoseconds=e},Sa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Da(t){this.serializer=t}Sa.store="owner",Sa.key="owner";var ka=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ka.store="mutationQueues",ka.keyPath="userId";var xa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};xa.store="mutations",xa.keyPath="batchId",xa.userMutationsIndex="userMutationsIndex",xa.userMutationsKeyPath=["userId","batchId"];var Oa=(Ra.prefixForUser=function(t){return[t]},Ra.prefixForPath=function(t,e){return[t,Ou(e)]},Ra.key=function(t,e,n){return[t,Ou(e),n]},Ra);function Ra(){}Oa.store="documentMutations",Oa.PLACEHOLDER=new Oa;var Va=function(t,e){this.path=t,this.readTime=e},Pa=function(t,e){this.path=t,this.version=e},La=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};La.store="remoteDocuments",La.readTimeIndex="readTimeIndex",La.readTimeIndexPath="readTime",La.collectionReadTimeIndex="collectionReadTimeIndex",La.collectionReadTimeIndexPath=["parentPath","readTime"];var Ca=function(t){this.byteSize=t};Ca.store="remoteDocumentGlobal",Ca.key="remoteDocumentGlobalKey";var Ma=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ma.store="targets",Ma.keyPath="targetId",Ma.queryTargetsIndexName="queryTargetsIndex",Ma.queryTargetsKeyPath=["canonicalId","targetId"];var ja=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};ja.store="targetDocuments",ja.keyPath=["targetId","path"],ja.documentTargetsIndex="documentTargetsIndex",ja.documentTargetsKeyPath=["path","targetId"];var Ua=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ua.key="targetGlobalKey",Ua.store="targetGlobal";var qa=function(t,e){this.collectionId=t,this.parent=e};function Fa(t){t.createObjectStore(ja.store,{keyPath:ja.keyPath}).createIndex(ja.documentTargetsIndex,ja.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ma.store,{keyPath:Ma.keyPath}).createIndex(Ma.queryTargetsIndexName,Ma.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ua.store)}qa.store="collectionParents",qa.keyPath=["collectionId","parent"];var Ba=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ba.store="clientMetadata",Ba.keyPath="clientId";var Ga,za=i(i(i([ka.store,xa.store,Oa.store,La.store,Ma.store,Sa.store,Ua.store,ja.store],[Ba.store]),[Ca.store]),[qa.store]),Wa=(Xa.Yh=function(o,t,s){return Ys("SimpleDb","Opening database:",o),new fu(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Xa(e))},i.onblocked=function(){r(new Dr(Sr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Dr(Sr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ys("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Na).next(function(){Ys("SimpleDb","Database upgrade to version "+Na+" complete")})}}).yn()},Xa.delete=function(t){return Ys("SimpleDb","Removing database:",t),nh(window.indexedDB.deleteDatabase(t)).yn()},Xa.jh=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Xa.oa())return!0;if(void 0===window.navigator)return!1;var t=p(),e=Xa.ha(t),n=0<e&&e<10,r=Xa.aa(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Xa.oa=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.ua)},Xa.Cr=function(t,e){return t.store(e)},Xa.ha=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Xa.aa=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Xa.prototype.ro=function(e){this.db.onversionchange=function(t){return e(t)}},Xa.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Ja.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),fu.reject(t)}).yn(),r={},n.catch(function(){}),[4,e.ca];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ys("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Xa.prototype.close=function(){this.db.close()},Xa),Qa=(Object.defineProperty(Ya.prototype,"Pn",{get:function(){return this.la},enumerable:!0,configurable:!0}),Object.defineProperty(Ya.prototype,"fa",{get:function(){return this.da},enumerable:!0,configurable:!0}),Object.defineProperty(Ya.prototype,"cursor",{set:function(t){this._a=t},enumerable:!0,configurable:!0}),Ya.prototype.done=function(){this.la=!0},Ya.prototype.qr=function(t){this.da=t},Ya.prototype.delete=function(){return nh(this._a.delete())},Ya),Ha=(n(Ka,Ga=Dr),Ka);function Ka(t){var e=this;return(e=Ga.call(this,Sr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ya(t){this._a=t,this.la=!1,this.da=null}function Xa(t){this.db=t,12.2===Xa.ha(p())&&Xs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function $a(t){return"IndexedDbTransactionError"===t.name}var Ja=(eh.open=function(t,e,n){return new eh(t.transaction(n,e))},Object.defineProperty(eh.prototype,"ca",{get:function(){return this.Ta.promise},enumerable:!0,configurable:!0}),eh.prototype.abort=function(t){t&&this.Ta.reject(t),this.aborted||(Ys("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},eh.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Za(e)},eh),Za=(th.prototype.put=function(t,e){return nh(void 0!==e?(Ys("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ys("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},th.prototype.add=function(t){return Ys("SimpleDb","ADD",this.store.name,t,t),nh(this.store.add(t))},th.prototype.get=function(e){var n=this;return nh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ys("SimpleDb","GET",n.store.name,e,t),t})},th.prototype.delete=function(t){return Ys("SimpleDb","DELETE",this.store.name,t),nh(this.store.delete(t))},th.prototype.count=function(){return Ys("SimpleDb","COUNT",this.store.name),nh(this.store.count())},th.prototype.Dr=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ea(n,function(t,e){r.push(e)}).next(function(){return r})},th.prototype.Ia=function(t,e){Ys("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Sh=!1;var r=this.cursor(n);return this.Ea(r,function(t,e,n){return n.delete()})},th.prototype.Br=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ea(r,e)},th.prototype.Bo=function(i){var t=this.cursor({});return new fu(function(n,r){t.onerror=function(t){var e=ih(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},th.prototype.Ea=function(t,s){var u=[];return new fu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Qa(e),r=s(e.primaryKey,e.value,n);if(r instanceof fu){var i=r.catch(function(t){return n.done(),fu.reject(t)});u.push(i)}n.Pn?o():null===n.fa?e.continue():e.continue(n.fa)}else o()}}).next(function(){return fu.vn(u)})},th.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},th.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Sh?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},th);function th(t){this.store=t}function eh(t){var n=this;this.transaction=t,this.aborted=!1,this.Ta=new Du,this.transaction.oncomplete=function(){n.Ta.resolve()},this.transaction.onabort=function(){t.error?n.Ta.reject(new Ha(t.error)):n.Ta.resolve()},this.transaction.onerror=function(t){var e=ih(t.target.error);n.Ta.reject(new Ha(e))}}function nh(t){return new fu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=ih(t.target.error);r(e)}})}var rh=!1;function ih(t){var e=Wa.ha(p());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return rh||(rh=!0,setTimeout(function(){throw r},0)),r}}return t}var oh=(ah.Pa=function(t,e,n,r,i){var o=new ah(t,e,Date.now()+n,r,i);return o.start(n),o},ah.prototype.start=function(t){var e=this;this.Va=setTimeout(function(){return e.ga()},t)},ah.prototype.pa=function(){return this.ga()},ah.prototype.cancel=function(t){null!==this.Va&&(this.clearTimeout(),this.Aa.reject(new Dr(Sr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},ah.prototype.ga=function(){var e=this;this.wa.oo(function(){return null!==e.Va?(e.clearTimeout(),e.op().then(function(t){return e.Aa.resolve(t)})):Promise.resolve()})},ah.prototype.clearTimeout=function(){null!==this.Va&&(this.ma(this),clearTimeout(this.Va),this.Va=null)},ah),sh=(Object.defineProperty(uh.prototype,"Ma",{get:function(){return this.va},enumerable:!0,configurable:!0}),uh.prototype.oo=function(t){this.enqueue(t)},uh.prototype.La=function(t){this.Oa(),this.xa(t)},uh.prototype.Ba=function(t){return this.Oa(),this.xa(t)},uh.prototype.qa=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Oa(),this.va?[3,2]:(this.va=!0,(e=zs.nt().window)&&e.removeEventListener("visibilitychange",this.$a),[4,this.Ba(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},uh.prototype.enqueue=function(t){return this.Oa(),this.va?new Promise(function(t){}):this.xa(t)},uh.prototype.Ua=function(i){var t=this;this.Oa(),this.va||(this.ba=this.ba.then(function(){var n=new Du,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.Na.reset(),[3,3];case 2:if(!$a(e=t.sent()))throw n.resolve(),e;return Ys("AsyncQueue","Operation failed with retryable error: "+e),this.Na.gr(r),[3,3];case 3:return[2]}})})};return t.oo(r),n.promise}))},uh.prototype.xa=function(t){var e=this,n=this.ya.then(function(){return e.Ca=!0,t().catch(function(t){throw e.Da=t,e.Ca=!1,Xs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t}).then(function(t){return e.Ca=!1,t})});return this.ya=n},uh.prototype.yr=function(t,e,n){var r=this;this.Oa(),-1<this.Fa.indexOf(t)&&(e=0);var i=oh.Pa(this,t,e,n,function(t){return r.Qa(t)});return this.Sa.push(i),i},uh.prototype.Oa=function(){this.Da&&Js()},uh.prototype.Wa=function(){},uh.prototype.ja=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.ya];case 1:t.sent(),t.label=2;case 2:if(e!==this.ya)return[3,0];t.label=3;case 3:return[2]}})})},uh.prototype.Ka=function(t){for(var e=0,n=this.Sa;e<n.length;e++)if(n[e].Er===t)return!0;return!1},uh.prototype.ka=function(r){var i=this;return this.ja().then(function(){i.Sa.sort(function(t,e){return t.Ra-e.Ra});for(var t=0,e=i.Sa;t<e.length;t++){var n=e[t];if(n.pa(),"all"!==r&&n.Er===r)break}return i.ja()})},uh.prototype.Ga=function(t){this.Fa.push(t)},uh.prototype.Qa=function(t){var e=this.Sa.indexOf(t);this.Sa.splice(e,1)},uh);function uh(){var t=this;this.ya=Promise.resolve(),this.ba=Promise.resolve(),this.va=!1,this.Sa=[],this.Da=null,this.Ca=!1,this.Fa=[],this.Na=new ku(this,"async_queue_retry"),this.$a=function(){t.ka("async_queue_retry")};var e=zs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.$a)}function ah(t,e,n,r,i){this.wa=t,this.Er=e,this.Ra=n,this.op=r,this.ma=i,this.Aa=new Du,this.then=this.Aa.promise.then.bind(this.Aa.promise),this.catch=this.Aa.promise.catch.bind(this.Aa.promise),this.Aa.promise.catch(function(t){})}function hh(t,e){if(Xs("AsyncQueue",e+": "+t),$a(t))return new Dr(Sr.UNAVAILABLE,e+": "+t);throw t}function ch(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=ru(n,i);return 0===s?ru(r,o):s}var fh=(yh.prototype.Ya=function(){return++this.Ha},yh.prototype.Ja=function(t){var e=[t,this.Ya()];if(this.buffer.size<this.za)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ch(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(yh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),yh),lh={Xa:!1,Za:0,tu:0,eu:0},ph=(dh.ru=function(t){return new dh(t,dh.hu,dh.ou)},dh);function dh(t,e,n){this.su=t,this.iu=e,this.nu=n}function yh(t){this.za=t,this.buffer=new os(ch),this.Ha=0}ph.au=-1,ph.uu=1048576,ph.cu=41943040,ph.hu=10,ph.ou=1e3,ph._u=new ph(ph.cu,ph.hu,ph.ou),ph.DISABLED=new ph(ph.au,0,0);var vh=(Eh.prototype.start=function(t){this.No.fu.su!==ph.au&&this.Tu(t)},Eh.prototype.stop=function(){this.du&&(this.du.cancel(),this.du=null)},Object.defineProperty(Eh.prototype,"io",{get:function(){return null!==this.du},enumerable:!0,configurable:!0}),Eh.prototype.Tu=function(n){var t=this,e=this.lu?3e5:6e4;Ys("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.du=this.wa.yr("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.du=null,this.lu=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eu(this.No)];case 2:return t.sent(),[3,7];case 3:return $a(e=t.sent())?(Ys("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,_h(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Tu(n)];case 8:return t.sent(),[2]}})})})},Eh),mh=(bh.prototype.wu=function(t,e){return this.Iu.$o(t).next(function(t){return Math.floor(e/100*t)})},bh.prototype.Ru=function(t,e){var n=this;if(0===e)return fu.resolve(mu.dr);var r=new fh(e);return this.Iu.js(t,function(t){return r.Ja(t.sequenceNumber)}).next(function(){return n.Iu.Mo(t,function(t){return r.Ja(t)})}).next(function(){return r.maxValue})},bh.prototype.Rh=function(t,e,n){return this.Iu.Rh(t,e,n)},bh.prototype.qo=function(t,e){return this.Iu.qo(t,e)},bh.prototype.mu=function(e,n){var r=this;return this.fu.su===ph.au?(Ys("LruGarbageCollector","Garbage collection skipped; disabled"),fu.resolve(lh)):this.Qo(e).next(function(t){return t<r.fu.su?(Ys("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.fu.su),lh):r.Au(e,n)})},bh.prototype.Qo=function(t){return this.Iu.Qo(t)},bh.prototype.Au=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.wu(e,this.fu.iu).next(function(t){return i=t>c.fu.nu?(Ys("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.fu.nu+" from "+t),c.fu.nu):t,s=Date.now(),c.Ru(e,i)}).next(function(t){return r=t,u=Date.now(),c.Rh(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.qo(e,r)}).next(function(t){return h=Date.now(),Hs()<=l.DEBUG&&Ys("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),fu.resolve({Xa:!0,Za:i,tu:o,eu:t})})},bh),gh=(wh.prototype.start=function(){return Promise.resolve()},wh.prototype.Su=function(i){return y(this,void 0,void 0,function(){var e,g,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Wn,g=this.bu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var m;return r.Wn.ea(v).next(function(t){return m=t,e=r.persistence.yo(i),g=new yu(r.yu,e,r.persistence.Do()),e.ea(v)}).next(function(t){for(var e=[],n=[],r=ms(),i=0,o=m;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var h=a[u];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return g.Yn(v,r).next(function(t){return{Du:t,Cu:e,Fu:n}})})})];case 1:return n=t.sent(),[2,(this.Wn=e,this.bu=g,this.Pu.vu(this.bu),n)]}})})},wh.prototype.Nu=function(u){var a,h=this,c=Vr.now(),t=u.reduce(function(t,e){return t.add(e.key)},ms());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.bu.Yn(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new zi(i.key,o,uo(o.proto.mapValue),Fi.exists(!0)))}return h.Wn.Yo(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Dn:e}})},wh.prototype.Ko=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.yu.zr({Yr:!0});return i.Wn.Ko(t,r.batch,r.streamToken).next(function(){return i.$u(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.Wn.ra(t)}).next(function(){return i.bu.Yn(t,e)})})},wh.prototype.ku=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Wn.Jo(e,t).next(function(t){return Zs(null!==t),n=t.keys(),r.Wn.ia(e,t)}).next(function(){return r.Wn.ra(e)}).next(function(){return r.bu.Yn(e,n)})})},wh.prototype.ta=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Wn.ta(t)})},wh.prototype.zo=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.Wn.zo(t)})},wh.prototype.Ho=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.Wn.Ho(t,e)})},wh.prototype.ah=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.zh.ah(t)})},wh.prototype.Mu=function(a){var h=this,c=a.Ee,f=this.Vu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.yu.zr({Yr:!0});f=h.Vu;var s=[];a.as.forEach(function(t,e){var n=f.get(e);if(n){s.push(h.zh.yh(o,t.Is,e).next(function(){return h.zh.gh(o,t.Ts,e)}));var r=t.resumeToken;if(0<r.rt()){var i=n.we(r,c).Ie(o.Mh);f=f.me(e,i),wh.Lu(n,i,t)&&s.push(h.zh.Eh(o,i))}}});var u=cs(),n=ms();if(a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof Io&&e.version.isEqual(Pr.min())?(i.kn(t,c),u=u.me(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Nn(e,c),u=u.me(t,e)):Ys("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.nh.Uo(o,t))})})),!c.isEqual(Pr.min())){var t=h.zh.ah(o).next(function(t){return h.zh.lh(o,o.Mh,c)});s.push(t)}return fu.vn(s).next(function(){return i.apply(o)}).next(function(){return h.bu.Jn(o,u)})}).then(function(t){return h.Vu=f,t})},wh.Lu=function(t,e,n){return Zs(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ou||0<n.Ts.size+n.Es.size+n.Is.size},wh.prototype.xu=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return fu.forEach(c,function(e){return fu.forEach(e.hr,function(t){return h.persistence.nh.ph(n,e.targetId,t)}).next(function(){return fu.forEach(e.or,function(t){return h.persistence.nh.bh(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!$a(e=t.sent()))throw e;return Ys("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.Vu.get(o),u=s.Ee,a=s.Re(u),this.Vu=this.Vu.me(o,a));return[2]}})})},wh.prototype.Bu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Wn.Zo(t,e)})},wh.prototype.qu=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.bu.Kn(t,e)})},wh.prototype.Uu=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.zh.Vh(e,r).next(function(t){return t?(n=t,fu.resolve(n)):i.zh.rh(e).next(function(t){return n=new Lo(r,t,0,e.Mh),i.zh.dh(e,n).next(function(){return n})})})}).then(function(t){return null===i.Vu.get(t.targetId)&&(i.Vu=i.Vu.me(t.targetId,t),i.gu.set(r,t.targetId)),t})},wh.prototype.Vh=function(t,e){var n=this.gu.get(e);return void 0!==n?fu.resolve(this.Vu.get(n)):this.zh.Vh(t,e)},wh.prototype.Qu=function(t,e){var n=this,r=this.Vu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?fu.resolve():n.persistence.nh.removeTarget(t,r)}).then(function(){n.Vu=n.Vu.remove(t),n.gu.delete(r.target)})},wh.prototype.Wu=function(t,n){var r=this,i=Pr.min(),o=ms();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.Vh(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.zh.vh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.Pu.Zn(e,t,n?i:Pr.min(),n?o:ms())}).next(function(t){return{documents:t,ju:o}})})},wh.prototype.$u=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=fu.resolve();return n.forEach(function(r){u=u.next(function(){return o.Mn(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Zs(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Nn(e,i.wn)})}),u.next(function(){return e.Wn.ia(t,s)})},wh.prototype.Eu=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.mu(t,n.Vu)})},wh);function wh(t,e,n){this.persistence=t,this.Pu=e,this.Vu=new Jo(ru),this.gu=new au(function(t){return t.canonicalId()}),this.pu=Pr.min(),this.Wn=t.yo(n),this.yu=t.So(),this.zh=t.vo(),this.bu=new yu(this.yu,this.Wn,this.persistence.Do()),this.Pu.vu(this.bu)}function bh(t,e){this.Iu=t,this.fu=e}function Eh(t,e){this.No=t,this.wa=e,this.lu=!1,this.du=null}gh.Ou=3e8;var Th,Ih=(n(Nh,Th=gh),Nh.prototype.start=function(){return this.Ku()},Nh.prototype.Gu=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.Wn.Xo(e,t).next(function(t){return t?n.bu.Yn(e,t):fu.resolve(null)})})},Nh.prototype.zu=function(t){this.Wn.na(t)},Nh.prototype.ho=function(t){this.persistence.ho(t)},Nh.prototype.po=function(){return this.persistence.po()},Nh.prototype.Hu=function(e){var n=this,t=this.Vu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.zh.si(t,e).next(function(t){return t?t.target:null})})},Nh.prototype.Wr=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.yu.Wr(t,r.pu)}).then(function(t){var e=t.jr,n=t.readTime;return r.pu=n,e})},Nh.prototype.Ku=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.yu.Gr(t)})];case 1:return e.pu=t.sent(),[2]}})})},Nh);function Nh(t,e,n){var r=this;return(r=Th.call(this,t,e,n)||this).persistence=t,r.Wn=t.yo(n),r.yu=t.So(),r.zh=t.vo(),r}function _h(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Sr.FAILED_PRECONDITION||e.message!==pu)throw e;return Ys("LocalStore","Unexpectedly lost primary lease"),[2]})})}var Ah=(kh.prototype.B=function(){return this.Yu.B()},kh.prototype.ph=function(t,e){var n=new Sh(t,e);this.Yu=this.Yu.add(n),this.Xu=this.Xu.add(n)},kh.prototype.tc=function(t,e){var n=this;t.forEach(function(t){return n.ph(t,e)})},kh.prototype.bh=function(t,e){this.ec(new Sh(t,e))},kh.prototype.sc=function(t,e){var n=this;t.forEach(function(t){return n.bh(t,e)})},kh.prototype.ic=function(t){var e=this,n=Xr.EMPTY,r=new Sh(n,t),i=new Sh(n,t+1),o=[];return this.Xu.Ke([r,i],function(t){e.ec(t),o.push(t.key)}),o},kh.prototype.nc=function(){var e=this;this.Yu.forEach(function(t){return e.ec(t)})},kh.prototype.ec=function(t){this.Yu=this.Yu.delete(t),this.Xu=this.Xu.delete(t)},kh.prototype.rc=function(t){var e=Xr.EMPTY,n=new Sh(e,t),r=new Sh(e,t+1),i=ms();return this.Xu.Ke([n,r],function(t){i=i.add(t.key)}),i},kh.prototype.Dh=function(t){var e=new Sh(t,0),n=this.Yu.ze(e);return null!==n&&t.isEqual(n.key)},kh),Sh=(Dh.Ju=function(t,e){return Xr.N(t.key,e.key)||ru(t.hc,e.hc)},Dh.Zu=function(t,e){return ru(t.hc,e.hc)||Xr.N(t.key,e.key)},Dh);function Dh(t,e){this.key=t,this.hc=e}function kh(){this.Yu=new os(Sh.Ju),this.Xu=new os(Sh.Zu)}function xh(t,e){if(0!==e.length)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Hh(e.length,"argument")+".")}function Oh(t,e,n){if(e.length!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires "+Hh(n,"argument")+", but was called with "+Hh(e.length,"argument")+".")}function Rh(t,e,n){if(e.length<n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Hh(n,"argument")+", but was called with "+Hh(e.length,"argument")+".")}function Vh(t,e,n,r){if(e.length<n||e.length>r)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Hh(e.length,"argument")+".")}function Ph(t,e,n,r){Uh(t,e,Qh(n)+" argument",r)}function Lh(t,e,n,r){void 0!==r&&Ph(t,e,n,r)}function Ch(t,e,n,r){Uh(t,e,n+" option",r)}function Mh(t,e,n,r){void 0!==r&&Ch(t,e,n,r)}function jh(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Fh(s))}var u=Fh(n);throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Uh(t,e,n,r){if(!("object"===e?qh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Fh(r);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function qh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Fh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Js();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Bh(t,e,n){if(void 0===n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Qh(e)+" argument, but it was undefined.")}function Gh(n,t,r){Zr(t,function(t,e){if(r.indexOf(t)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function zh(t,e,n,r){var i=Fh(r);return new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Qh(n)+" argument to be a "+e+", but it was: "+i)}function Wh(t,e,n){if(n<=0)throw new Dr(Sr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Qh(e)+" argument to be a positive number, but it was: "+n+".")}function Qh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Hh(t,e){return t+" "+e+(1===t?"":"s")}function Kh(){if("undefined"==typeof Uint8Array)throw new Dr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Yh(){if(!zs.nt().oc)throw new Dr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Xh=(Zh.fromBase64String=function(t){Oh("Blob.fromBase64String",arguments,1),Ph("Blob.fromBase64String","string",1,t),Yh();try{return new Zh(ei.fromBase64String(t))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Zh.fromUint8Array=function(t){if(Oh("Blob.fromUint8Array",arguments,1),Kh(),!(t instanceof Uint8Array))throw zh("Blob.fromUint8Array","Uint8Array",1,t);return new Zh(ei.fromUint8Array(t))},Zh.prototype.toBase64=function(){return Oh("Blob.toBase64",arguments,0),Yh(),this.ac.toBase64()},Zh.prototype.toUint8Array=function(){return Oh("Blob.toUint8Array",arguments,0),Kh(),this.ac.toUint8Array()},Zh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Zh.prototype.isEqual=function(t){return this.ac.isEqual(t.ac)},Zh),$h=(Jh.documentId=function(){return Jh.cc},Jh.prototype.isEqual=function(t){if(!(t instanceof Jh))throw zh("isEqual","FieldPath",1,t);return this.uc.isEqual(t.uc)},Jh);function Jh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Dr(Sr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Ph("FieldPath","string",n,t[n]),0===t[n].length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.uc=new Kr(t)}function Zh(t){Yh(),this.ac=t}$h.cc=new $h(Kr.J().j());var tc,ec,nc,rc,ic,oc=new RegExp("[~\\*/\\[\\]]"),sc=function(t){this._c=t},uc=(n(Ic,ic=sc),Ic.prototype.Di=function(t){if(2!==t.lc)throw 1===t.lc?t.dc("FieldValue.delete() can only appear at the top level of your update data"):t.dc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},Ic.prototype.isEqual=function(t){return t instanceof Ic},Ic),ac=(n(Tc,rc=sc),Tc.prototype.Di=function(t){return new qi(t.path,Ni.instance)},Tc.prototype.isEqual=function(t){return t instanceof Tc},Tc),hc=(n(Ec,nc=sc),Ec.prototype.Di=function(t){var e=new _c({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return kc(t,e)}),r=new Ai(n);return new qi(t.path,r)},Ec.prototype.isEqual=function(t){return this===t},Ec),cc=(n(bc,ec=sc),bc.prototype.Di=function(t){var e=new _c({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map(function(t){return kc(t,e)}),r=new Si(n);return new qi(t.path,r)},bc.prototype.isEqual=function(t){return this===t},bc),fc=(n(wc,tc=sc),wc.prototype.Di=function(t){var e=new _c({lc:3,methodName:this._c},t.ii,t.serializer),n=kc(this.Ec,e),r=new Di(t.serializer,n);return new qi(t.path,r)},wc.prototype.isEqual=function(t){return this===t},wc),lc=(Object.defineProperty(gc.prototype,"latitude",{get:function(){return this.Ic},enumerable:!0,configurable:!0}),Object.defineProperty(gc.prototype,"longitude",{get:function(){return this.wc},enumerable:!0,configurable:!0}),gc.prototype.isEqual=function(t){return this.Ic===t.Ic&&this.wc===t.wc},gc.prototype.p=function(t){return ru(this.Ic,t.Ic)||ru(this.wc,t.wc)},gc),pc=/^__.*__$/,dc=(mc.prototype.Rc=function(t,e){var n=[];return null!==this.Vt?n.push(new zi(t,this.data,this.Vt,e)):n.push(new Gi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Wi(t,this.fieldTransforms)),n},mc),yc=(vc.prototype.Rc=function(t,e){var n=[new zi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Wi(t,this.fieldTransforms)),n},vc);function vc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function mc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function gc(t,e){if(Oh("GeoPoint",arguments,2),Ph("GeoPoint","number",1,t),Ph("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Dr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Dr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ic=t,this.wc=e}function wc(t){var e=this;return(e=tc.call(this,"FieldValue.increment")||this).Ec=t,e}function bc(t){var e=this;return(e=ec.call(this,"FieldValue.arrayRemove")||this).fc=t,e}function Ec(t){var e=this;return(e=nc.call(this,"FieldValue.arrayUnion")||this).fc=t,e}function Tc(){return rc.call(this,"FieldValue.serverTimestamp")||this}function Ic(){return ic.call(this,"FieldValue.delete")||this}function Nc(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Js()}}var _c=(Object.defineProperty(Dc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(Dc.prototype,"lc",{get:function(){return this.settings.lc},enumerable:!0,configurable:!0}),Dc.prototype.Ac=function(t){return new Dc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},Dc.prototype.Pc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.Vc(t),r},Dc.prototype.gc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.mc(),r},Dc.prototype.pc=function(t){return this.Ac({path:void 0,Tc:!0})},Dc.prototype.dc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new Dr(Sr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},Dc.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},Dc.prototype.mc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Vc(this.path.get(t))},Dc.prototype.Vc=function(t){if(0===t.length)throw this.dc("Document fields must not be empty");if(Nc(this.lc)&&pc.test(t))throw this.dc('Document fields cannot begin and end with "__"')},Dc),Ac=(Sc.prototype.bc=function(t,e){var n=this.vc(0,t);Rc("Data must be an object, but it was:",n,e);var r=xc(e,n);return new dc(new Ki(r),null,n.fieldTransforms)},Sc.prototype.Sc=function(t,e,n){var r=this.vc(2,t);Rc("Data must be an object, but it was:",r,e);var i,o,s=xc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof $h)f=c.uc;else{if("string"!=typeof c)throw Js();f=Pc(t,c)}if(!r.contains(f))throw new Dr(Sr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Lc(u,f)||u.push(f)}i=new Ui(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=new Ui(r.Vt),o=r.fieldTransforms;return new dc(new Ki(s),i,o)},Sc.prototype.Dc=function(o,t){var s=this.vc(1,o);Rc("Data must be an object, but it was:",s,t);var u=[],a=new Yi;Zr(t,function(t,e){var n=Pc(o,t),r=s.gc(n);if(e instanceof uc)u.push(n);else{var i=kc(e,r);null!=i&&(u.push(n),a.set(n,i))}});var e=new Ui(u);return new yc(a.yt(),e,s.fieldTransforms)},Sc.prototype.Cc=function(t,e,n,r){var i=this.vc(1,t),o=[Vc(t,e)],s=[n];if(r.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Vc(t,r[u])),s.push(r[u+1]);for(var a=[],h=new Yi,c=o.length-1;0<=c;--c)if(!Lc(a,o[c])){var f=o[c],l=s[c],p=i.gc(f);if(l instanceof uc)a.push(f);else{var d=kc(l,p);null!=d&&(a.push(f),h.set(f,d))}}var y=new Ui(a);return new yc(h.yt(),y,i.fieldTransforms)},Sc.prototype.vc=function(t,e){return new _c({lc:t,methodName:e,path:Kr.G,Tc:!1},this.ii,this.serializer)},Sc.prototype.Fc=function(t,e,n){return void 0===n&&(n=!1),kc(e,this.vc(n?4:3,t))},Sc);function Sc(t,e){this.ii=t,this.serializer=e||zs.nt().yc(t)}function Dc(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.mc(),this.fieldTransforms=r||[],this.Vt=i||[]}function kc(s,t){if(Oc(s))return Rc("Unsupported field value:",t,s),xc(s,t);if(s instanceof sc)return function(t,e){if(!Nc(e.lc))throw e.dc(t._c+"() can only be used with update() and set()");if(null===e.path)throw e.dc(t._c+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.Tc&&4!==t.lc)throw t.dc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=kc(i[r],t.pc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Vr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof Vr){var r=new Vr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof lc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Xh)return{bytesValue:e.serializer.ui(t)};if(t instanceof vl){var i=e.ii,o=t.firestore.Nc;if(!o.isEqual(i))throw e.dc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.$c.path,t.firestore.Nc)}}throw e.dc("Unsupported field value: "+Fh(t))}(s,t)}function xc(t,r){var i={};return ti(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Zr(t,function(t,e){var n=kc(e,r.Pc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Oc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vr||t instanceof lc||t instanceof Xh||t instanceof vl||t instanceof sc)}function Rc(t,e,n){if(!Oc(n)||!qh(n)){var r=Fh(n);throw"an object"===r?e.dc(t+" a custom object"):e.dc(t+" "+r)}}function Vc(t,e){if(e instanceof $h)return e.uc;if("string"==typeof e)return Pc(t,e);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Pc(t,e){try{return function(e){if(0<=e.search(oc))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new($h.bind.apply($h,i([void 0],e.split("."))))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).uc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Lc(t,e){return t.some(function(t){return t.isEqual(e)})}var Cc,Mc,jc,Uc=(Jc.prototype.Bc=function(){return 1===this.state||2===this.state||4===this.state},Jc.prototype.qc=function(){return 2===this.state},Jc.prototype.start=function(){3!==this.state?this.auth():this.Uc()},Jc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Bc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Jc.prototype.Qc=function(){this.state=0,this.Na.reset()},Jc.prototype.Wc=function(){var t=this;this.qc()&&null===this.xc&&(this.xc=this.Tr.yr(this.kc,6e4,function(){return t.jc()}))},Jc.prototype.Kc=function(t){this.Gc(),this.stream.send(t)},Jc.prototype.jc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.qc()?[2,this.close(0)]:[2]})})},Jc.prototype.Gc=function(){this.xc&&(this.xc.cancel(),this.xc=null)},Jc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Gc(),this.Na.cancel(),this.Oc++,3!==e?this.Na.reset():n&&n.code===Sr.RESOURCE_EXHAUSTED?(Xs(n.toString()),Xs("Using maximum backoff delay to prevent overloading the backend."),this.Na.Vr()):n&&n.code===Sr.UNAUTHENTICATED&&this.Lc._(),null!==this.stream&&(this.zc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Hc(n)];case 1:return t.sent(),[2]}})})},Jc.prototype.zc=function(){},Jc.prototype.auth=function(){var n=this;this.state=1;var t=this.Yc(this.Oc),e=this.Oc;this.Lc.getToken().then(function(t){n.Oc===e&&n.Jc(t)},function(e){t(function(){var t=new Dr(Sr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Xc(t)})})},Jc.prototype.Jc=function(t){var e=this,n=this.Yc(this.Oc);this.stream=this.Zc(t),this.stream.t_(function(){n(function(){return e.state=2,e.listener.t_()})}),this.stream.Hc(function(t){n(function(){return e.Xc(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Jc.prototype.Uc=function(){var t=this;this.state=4,this.Na.gr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Jc.prototype.Xc=function(t){return Ys("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Jc.prototype.Yc=function(e){var n=this;return function(t){n.Tr.oo(function(){return n.Oc===e?t():(Ys("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Jc),qc=(n($c,jc=Uc),$c.prototype.Zc=function(t){return this.Mc.e_("Listen",t)},$c.prototype.onMessage=function(t){this.Na.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.s_(e,n)},$c.prototype.i_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Kc(e)},$c.prototype.n_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Kc(e)},$c),Fc=(n(Xc,Mc=Uc),Object.defineProperty(Xc.prototype,"h_",{get:function(){return this.r_},enumerable:!0,configurable:!0}),Xc.prototype.start=function(){this.r_=!1,Mc.prototype.start.call(this)},Xc.prototype.zc=function(){this.r_&&this.o_([])},Xc.prototype.Zc=function(t){return this.Mc.e_("Write",t)},Xc.prototype.onMessage=function(t){if(Zs(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.r_){this.Na.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.a_(n,e)}return Zs(!t.writeResults||0===t.writeResults.length),this.r_=!0,this.listener.u_()},Xc.prototype.c_=function(){var t={};t.database=this.serializer.wi,this.Kc(t)},Xc.prototype.o_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.Kc(n)},Xc),Bc=(n(Yc,Cc=function(){this.__=void 0}),Yc.prototype.l_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.l_(e,n,t)}).catch(function(t){throw t.code===Sr.UNAUTHENTICATED&&r.credentials._(),t})},Yc.prototype.d_=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.Mc.d_(e,n,t)}).catch(function(t){throw t.code===Sr.UNAUTHENTICATED&&r.credentials._(),t})},Yc),Gc=(Kc.prototype.R_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),0<this.mutations.length)throw new Dr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return n=tu(s),e={database:n.serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.d_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Zs(!!e),o.push(e)}),o)]}})})}(this.f_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Io||t instanceof To?n.A_(t):Js()}),e)]}})})},Kc.prototype.set=function(t,e){this.write(e.Rc(t,this.Rt(t))),this.w_.add(t)},Kc.prototype.update=function(t,e){try{this.write(e.Rc(t,this.P_(t)))}catch(t){this.I_=t}this.w_.add(t)},Kc.prototype.delete=function(t){this.write([new Qi(t,this.Rt(t))]),this.w_.add(t)},Kc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.m_(),this.I_)throw this.I_;return e=this.T_,this.mutations.forEach(function(t){e=e.remove(t.key)}),e.forEach(function(t,e){n.mutations.push(new Hi(t,n.Rt(t)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return e=tu(i),n={database:e.serializer.wi,writes:o.map(function(t){return e.serializer.vi(t)})},[4,e.l_("Commit",n)];case 1:return r=t.sent(),[2,e.serializer.Li(r.writeResults,r.commitTime)]}})})}(this.f_,this.mutations)];case 1:return t.sent(),this.E_=!0,[2]}})})},Kc.prototype.A_=function(t){var e;if(t instanceof To)e=t.version;else{if(!(t instanceof Io))throw Js();e=Pr.min()}var n=this.T_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Dr(Sr.ABORTED,"Document version changed between two reads.")}else this.T_=this.T_.me(t.key,e)},Kc.prototype.Rt=function(t){var e=this.T_.get(t);return!this.w_.has(t)&&e?Fi.updateTime(e):Fi.ft()},Kc.prototype.P_=function(t){var e=this.T_.get(t);if(this.w_.has(t)||!e)return Fi.exists(!0);if(e.isEqual(Pr.min()))throw new Dr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Fi.updateTime(e)},Kc.prototype.write=function(t){this.m_(),this.mutations=this.mutations.concat(t)},Kc.prototype.m_=function(){},Kc),zc=(Hc.prototype.b_=function(){var t=this;0===this.g_&&(this.v_("Unknown"),this.p_=this.wa.yr("online_state_timeout",1e4,function(){return t.p_=null,t.S_("Backend didn't respond within 10 seconds."),t.v_("Offline"),Promise.resolve()}))},Hc.prototype.D_=function(t){"Online"===this.state?this.v_("Unknown"):(this.g_++,1<=this.g_&&(this.C_(),this.S_("Connection failed 1 times. Most recent error: "+t.toString()),this.v_("Offline")))},Hc.prototype.set=function(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.v_(t)},Hc.prototype.v_=function(t){t!==this.state&&(this.state=t,this.V_(t))},Hc.prototype.S_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.y_?(Xs(e),this.y_=!1):Ys("OnlineStateTracker",e)},Hc.prototype.C_=function(){null!==this.p_&&(this.p_.cancel(),this.p_=null)},Hc),Wc=(Qc.prototype.start=function(){return this.enableNetwork()},Qc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.J_()},Qc.prototype.J_=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.B_()?(e=this.G_,[4,this.F_.zo()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.X_()?this.Z_():this.U_.set("Unknown"),[4,this.tl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Qc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),[2]}})})},Qc.prototype.el=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.G_.stop()];case 1:return t.sent(),[4,this.Q_.stop()];case 2:return t.sent(),0<this.N_.length&&(Ys("RemoteStore","Stopping write stream with "+this.N_.length+" pending writes"),this.N_=[]),this.sl(),[2]}})})},Qc.prototype.Ro=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ys("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.O_.Ro(),this.U_.set("Unknown"),[2]}})})},Qc.prototype.listen=function(t){this.k_.has(t.targetId)||(this.k_.set(t.targetId,t),this.X_()?this.Z_():this.Q_.qc()&&this.il(t))},Qc.prototype.nl=function(t){this.k_.delete(t),this.Q_.qc()&&this.rl(t),0===this.k_.size&&(this.Q_.qc()?this.Q_.Wc():this.B_()&&this.U_.set("Unknown"))},Qc.prototype.si=function(t){return this.k_.get(t)||null},Qc.prototype.ei=function(t){return this.hl.ei(t)},Qc.prototype.il=function(t){this.M_.Ns(t.targetId),this.Q_.i_(t)},Qc.prototype.rl=function(t){this.M_.Ns(t),this.Q_.n_(t)},Qc.prototype.Z_=function(){this.M_=new ks(this),this.Q_.start(),this.U_.b_()},Qc.prototype.X_=function(){return this.B_()&&!this.Q_.Bc()&&0<this.k_.size},Qc.prototype.B_=function(){return!this.L_&&this.isPrimary&&this.networkEnabled},Qc.prototype.sl=function(){this.M_=null},Qc.prototype.W_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.k_.forEach(function(t,e){n.il(t)}),[2]})})},Qc.prototype.j_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.sl(),this.X_()?(this.U_.D_(e),this.Z_()):this.U_.set("Unknown"),[2]})})},Qc.prototype.K_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.U_.set("Online"),!(i instanceof Ts&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.ol(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Ys("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.al(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof bs?this.M_.qs(i):i instanceof Es?this.M_.Hs(i):this.M_.Ws(i),o.isEqual(Pr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.F_.ah()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.ul(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ys("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.al(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Qc.prototype.al=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!$a(n))throw n;return this.L_=!0,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),this.wa.Ua(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ys("RemoteStore","Retrying IndexedDB access"),[4,this.F_.ah()];case 1:return t.sent(),this.L_=!1,[4,this.J_()];case 2:return t.sent(),[2]}})})}),[2]}})})},Qc.prototype.ul=function(r){var i=this,t=this.M_.Xs(r);return t.as.forEach(function(t,e){if(0<t.resumeToken.rt()){var n=i.k_.get(e);n&&i.k_.set(e,n.we(t.resumeToken,r))}}),t.us.forEach(function(t){var e=i.k_.get(t);if(e){i.k_.set(t,e.we(ei.ht,e.Ee)),i.rl(t);var n=new Lo(e.target,t,1,e.sequenceNumber);i.il(n)}}),this.hl.Mu(t)},Qc.prototype.ol=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.k_.has(i)?[4,this.hl.cl(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.k_.delete(i),this.M_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Qc.prototype.tl=function(){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this._l()?(e=0<this.N_.length?this.N_[this.N_.length-1].batchId:-1,[4,this.F_.Bu(e)]):[3,5];case 1:return null!==(n=t.sent())?[3,2]:(0===this.N_.length&&this.G_.Wc(),[3,4]);case 2:return this.ll(n),[4,this.tl()];case 3:t.sent(),t.label=4;case 4:t.label=5;case 5:return this.dl()&&this.fl(),[2]}})})},Qc.prototype._l=function(){return this.B_()&&this.N_.length<10},Qc.prototype.Tl=function(){return this.N_.length},Qc.prototype.ll=function(t){this.N_.push(t),this.G_.qc()&&this.G_.h_&&this.G_.o_(t.mutations)},Qc.prototype.dl=function(){return this.B_()&&!this.G_.Bc()&&0<this.N_.length},Qc.prototype.fl=function(){this.G_.start()},Qc.prototype.z_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.G_.c_(),[2]})})},Qc.prototype.Y_=function(){var r=this;return this.F_.Ho(this.G_.lastStreamToken).then(function(){for(var t=0,e=r.N_;t<e.length;t++){var n=e[t];r.G_.o_(n.mutations)}}).catch(_h)},Qc.prototype.a_=function(t,e){var n=this,r=this.N_.shift(),i=cu.from(r,t,e,this.G_.lastStreamToken);return this.hl.El(i).then(function(){return n.tl()})},Qc.prototype.H_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&0<this.N_.length?this.G_.h_?[4,this.Il(e)]:[3,2]:[3,5];case 1:return t.sent(),[3,4];case 2:return[4,this.wl(e)];case 3:t.sent(),t.label=4;case 4:this.dl()&&this.fl(),t.label=5;case 5:return[2]}})})},Qc.prototype.wl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return Xo(e.code)?[2,(Ys("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.G_.lastStreamToken),this.G_.lastStreamToken=ei.ht,this.F_.Ho(ei.ht).catch(_h))]:[2]})})},Qc.prototype.Il=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return Xo(n=i.code)&&n!==Sr.ABORTED?(e=this.N_.shift(),[2,(this.G_.Qc(),this.hl.Rl(e.batchId,i).then(function(){return r.tl()}))]):[2]})})},Qc.prototype.ml=function(){return new Gc(this.f_)},Qc.prototype.q_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Qc.prototype.Al=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Ys("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Qc.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.el()];case 3:t.sent(),this.U_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Qc);function Qc(t,e,n,r,i){var o,s,u,a,h,c,f,l,p=this;this.F_=t,this.f_=e,this.wa=n,this.N_=[],this.k_=new Map,this.M_=null,this.networkEnabled=!1,this.isPrimary=!1,this.L_=!1,this.O_=i,this.O_.x_(function(t){n.oo(function(){return y(p,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.B_()?(Ys("RemoteStore","Restarting streams for network reachability change."),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.U_=new zc(n,r),this.Q_=(h=this.f_,c=n,f={t_:this.W_.bind(this),Hc:this.j_.bind(this),s_:this.K_.bind(this)},l=tu(h),new qc(c,l.Mc,l.credentials,l.serializer,f)),this.G_=(o=this.f_,s=n,u={t_:this.z_.bind(this),Hc:this.H_.bind(this),u_:this.Y_.bind(this),a_:this.a_.bind(this)},a=tu(o),new Fc(s,a.Mc,a.credentials,a.serializer,u))}function Hc(t,e){this.wa=t,this.V_=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}function Kc(t){this.f_=t,this.T_=ys(),this.mutations=[],this.E_=!1,this.I_=null,this.w_=new Set}function Yc(t,e,n){var r=this;return(r=Cc.call(this)||this).Mc=t,r.credentials=e,r.serializer=n,r}function Xc(t,e,n,r,i){var o=this;return(o=Mc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.r_=!1,o.lastStreamToken=ei.ht,o}function $c(t,e,n,r,i){var o=this;return(o=jc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Jc(t,e,n,r,i,o){this.Tr=t,this.kc=n,this.Mc=r,this.Lc=i,this.listener=o,this.state=0,this.Oc=0,this.xc=null,this.stream=null,this.Na=new ku(t,e)}function Zc(t,e){return"firestore_clients_"+t+"_"+e}function tf(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function ef(t,e){return"firestore_targets_"+t+"_"+e}function nf(t){this.key=t}function rf(t){this.key=t}function of(t,e,n){this.query=t,this.targetId=e,this.view=n}function sf(t){this.key=t,this.Bd=!1}function uf(){this.Vf=void 0,this.gf=[]}var af,hf,cf=(Ff.Vl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Dr(r.error.code,r.error.message)),i?new Ff(t,e,r.state,o):(Xs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Ff.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Ff),ff=(qf.Vl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Dr(n.error.code,n.error.message)),r?new qf(t,n.state,i):(Xs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},qf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},qf),lf=(Uf.Vl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ws(),o=0;r&&o<n.activeTargetIds.length;++o)r=oi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Uf(t,i):(Xs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Uf),pf=(jf.Vl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new jf(e.clientId,e.onlineState):(Xs("SharedClientState","Failed to parse online state: "+t),null)},jf),df=(Mf.prototype.pl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Mf.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Mf.prototype.gl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Mf),yf=(Cf.jh=function(t){return!(!t.window||null==t.window.localStorage)},Cf.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.hl.po()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.bl&&(o=this.getItem(Zc(this.persistenceKey,i)))&&(s=lf.Vl(i,o))&&(this.Dl=this.Dl.me(s.clientId,s));for(this.Ol(),(u=this.storage.getItem(this.Ll))&&(a=this.xl(u))&&this.Bl(a),h=0,c=this.Cl;h<c.length;h++)f=c[h],this.Sl(f);return this.Cl=[],this.platform.window.addEventListener("unload",function(){return l.Ro()}),this.io=!0,[2]}})})},Cf.prototype.lr=function(t){this.setItem(this.Nl,JSON.stringify(t))},Cf.prototype.ql=function(){return this.Ul(this.Dl)},Cf.prototype.Ql=function(n){var r=!1;return this.Dl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Cf.prototype.Wl=function(t){this.jl(t,"pending")},Cf.prototype.Kl=function(t,e,n){this.jl(t,e,n),this.Gl(t)},Cf.prototype.zl=function(t){var e="not-current";if(this.Ql(t)){var n=this.storage.getItem(ef(this.persistenceKey,t));if(n){var r=ff.Vl(t,n);r&&(e=r.state)}}return this.Hl.pl(t),this.Ol(),e},Cf.prototype.Yl=function(t){this.Hl.yl(t),this.Ol()},Cf.prototype.Jl=function(t){return this.Hl.activeTargetIds.has(t)},Cf.prototype.Xl=function(t){this.removeItem(ef(this.persistenceKey,t))},Cf.prototype.Zl=function(t,e,n){this.td(t,e,n)},Cf.prototype.Su=function(t,e,n){var r=this;e.forEach(function(t){r.Gl(t)}),this.currentUser=t,n.forEach(function(t){r.Wl(t)})},Cf.prototype.ed=function(t){this.sd(t)},Cf.prototype.Ro=function(){this.io&&(this.platform.window.removeEventListener("storage",this.vl),this.removeItem(this.Fl),this.io=!1)},Cf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ys("SharedClientState","READ",t,e),e},Cf.prototype.setItem=function(t,e){Ys("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Cf.prototype.removeItem=function(t){Ys("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Cf.prototype.Sl=function(u){var t=this;if(u.storageArea===this.storage){if(Ys("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Fl)return void Xs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.Ua(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.io){if(null!==u.key)if(this.$l.test(u.key)){if(null==u.newValue)return e=this.nd(u.key),[2,this.rd(e,null)];if(n=this.hd(u.key,u.newValue))return[2,this.rd(n.clientId,n)]}else if(this.kl.test(u.key)){if(null!==u.newValue&&(r=this.od(u.key,u.newValue)))return[2,this.ad(r)]}else if(this.Ml.test(u.key)){if(null!==u.newValue&&(i=this.ud(u.key,u.newValue)))return[2,this._d(i)]}else if(u.key===this.Ll){if(null!==u.newValue&&(o=this.xl(u.newValue)))return[2,this.Bl(o)]}else u.key===this.Nl&&(s=function(t){var e=mu.dr;if(null!=t)try{var n=JSON.parse(t);Zs("number"==typeof n),e=n}catch(t){Xs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==mu.dr&&this.ur(s)}else this.Cl.push(u);return[2]})})})}},Object.defineProperty(Cf.prototype,"Hl",{get:function(){return this.Dl.get(this.bl)},enumerable:!0,configurable:!0}),Cf.prototype.Ol=function(){this.setItem(this.Fl,this.Hl.gl())},Cf.prototype.jl=function(t,e,n){var r=new cf(this.currentUser,t,e,n),i=tf(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gl())},Cf.prototype.Gl=function(t){var e=tf(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Cf.prototype.sd=function(t){var e={clientId:this.bl,onlineState:t};this.storage.setItem(this.Ll,JSON.stringify(e))},Cf.prototype.td=function(t,e,n){var r=ef(this.persistenceKey,t),i=new ff(t,e,n);this.setItem(r,i.gl())},Cf.prototype.nd=function(t){var e=this.$l.exec(t);return e?e[1]:null},Cf.prototype.hd=function(t,e){var n=this.nd(t);return lf.Vl(n,e)},Cf.prototype.od=function(t,e){var n=this.kl.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cf.Vl(new Tr(i),r,e)},Cf.prototype.ud=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return ff.Vl(r,e)},Cf.prototype.xl=function(t){return pf.Vl(t)},Cf.prototype.ad=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.hl.ld(e.batchId,e.state,e.error)]:(Ys("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Cf.prototype._d=function(t){return this.hl.dd(t.targetId,t.state,t.error)},Cf.prototype.rd=function(t,e){var n=this,r=e?this.Dl.me(t,e):this.Dl.remove(t),i=this.Ul(this.Dl),o=this.Ul(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.hl.fd(s,u).then(function(){n.Dl=r})},Cf.prototype.Bl=function(t){this.Dl.get(t.clientId)&&this.V_(t.onlineState)},Cf.prototype.Ul=function(t){var n=ws();return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},Cf),vf=(Lf.prototype.Wl=function(t){},Lf.prototype.Kl=function(t,e,n){},Lf.prototype.zl=function(t){return this.Td.pl(t),this.Ed[t]||"not-current"},Lf.prototype.Zl=function(t,e,n){this.Ed[t]=e},Lf.prototype.Yl=function(t){this.Td.yl(t)},Lf.prototype.Jl=function(t){return this.Td.activeTargetIds.has(t)},Lf.prototype.Xl=function(t){delete this.Ed[t]},Lf.prototype.ql=function(){return this.Td.activeTargetIds},Lf.prototype.Ql=function(t){return this.Td.activeTargetIds.has(t)},Lf.prototype.start=function(){return this.Td=new df,Promise.resolve()},Lf.prototype.Su=function(t,e,n){},Lf.prototype.ed=function(t){},Lf.prototype.Ro=function(){},Lf.prototype.lr=function(t){},Lf),mf=(Object.defineProperty(Pf.prototype,"Ad",{get:function(){return this.Id},enumerable:!0,configurable:!0}),Pf.prototype.Pd=function(t,e){var u=this,a=e?e.Vd:new Ns,h=e?e.md:this.md,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=e instanceof To?e:null;r=r&&(u.query.matches(r)?r:null);var i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.gd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),a.track({type:1,doc:n})}return{md:f,Vd:a,pd:l,ns:c}},Pf.prototype.gd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Pf.prototype.xn=function(t,e,n){var o=this,r=this.md;this.md=t.md,this.ns=t.ns;var i=t.Vd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Js()}}var r,i}),this.yd(n);var s=e?this.bd():[],u=0===this.Rd.size&&this.fs?1:0,a=u!==this.wd;return this.wd=u,0!==i.length||a?{snapshot:new _s(this.query,t.md,r,i,t.ns,0==u,a,!1),vd:s}:{vd:s}},Pf.prototype.Sd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.xn({md:this.md,Vd:new Ns,ns:this.ns,pd:!1},!1)):{vd:[]}},Pf.prototype.Dd=function(t){return!this.Id.has(t)&&!!this.md.has(t)&&!this.md.get(t).At},Pf.prototype.yd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.Id=e.Id.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.Id=e.Id.delete(t)}),this.fs=t.fs)},Pf.prototype.bd=function(){var e=this;if(!this.fs)return[];var n=this.Rd;this.Rd=ms(),this.md.forEach(function(t){e.Dd(t.key)&&(e.Rd=e.Rd.add(t.key))});var r=[];return n.forEach(function(t){e.Rd.has(t)||r.push(new rf(t))}),this.Rd.forEach(function(t){n.has(t)||r.push(new nf(t))}),r},Pf.prototype.Cd=function(t){this.Id=t.ju,this.Rd=ms();var e=this.Pd(t.documents);return this.xn(e,!0)},Pf.prototype.Fd=function(){return _s.os(this.query,this.md,this.ns,0===this.wd)},Pf),gf=(Vf.prototype.kd=function(){this.Md()},Vf.prototype.Md=function(){var t=this;this.Na.gr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=this.Nd.ml(),(n=this.Ld(e))&&n.then(function(t){r.wa.oo(function(){return e.commit().then(function(){r.Aa.resolve(t)}).catch(function(t){r.Od(t)})})}).catch(function(t){r.Od(t)}),[2]})})})},Vf.prototype.Ld=function(t){try{var e=this.updateFunction(t);return!ri(e)&&e.catch&&e.then?e:(this.Aa.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Aa.reject(t),null}},Vf.prototype.Od=function(t){var e=this;0<this.$d&&this.xd(t)?(--this.$d,this.wa.oo(function(){return e.Md(),Promise.resolve()})):this.Aa.reject(t)},Vf.prototype.xd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Xo(e)},Vf),wf=(Object.defineProperty(Rf.prototype,"Zd",{get:function(){return!0},enumerable:!0,configurable:!0}),Rf.prototype.subscribe=function(t){this.Qd=t},Rf.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.tf("listen()"),(r=this.Wd.get(s))?(e=r.targetId,this.qd.zl(e),n=r.view.Fd(),[3,4]):[3,1];case 1:return[4,this.F_.Uu(s.ee())];case 2:return i=t.sent(),o=this.qd.zl(i.targetId),e=i.targetId,[4,this.ef(s,e,"current"===o)];case 3:n=t.sent(),this.Zd&&this.Nd.listen(i),t.label=4;case 4:return[2,n]}})})},Rf.prototype.ef=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(u,!0)];case 1:return e=t.sent(),n=new mf(u,e.ju),r=n.Pd(e.documents),i=Ss.ds(a,h&&"Offline"!==this.onlineState),o=n.xn(r,this.Zd,i),this.sf(a,o.vd),s=new of(u,a,n),[2,(this.Wd.set(u,s),this.jd.has(a)?this.jd.get(a).push(u):this.jd.set(a,[u]),o.snapshot)]}})})},Rf.prototype.nl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.tf("unlisten()"),e=this.Wd.get(i),1<(n=this.jd.get(e.targetId)).length?[2,(this.jd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.Wd.delete(i))]:this.Zd?(this.qd.Yl(e.targetId),this.qd.Ql(e.targetId)?[3,2]:[4,this.F_.Qu(e.targetId,!1).then(function(){r.qd.Xl(e.targetId),r.Nd.nl(e.targetId),r.if(e.targetId)}).catch(_h)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.if(e.targetId),[4,this.F_.Qu(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Rf.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.tf("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.F_.Nu(i)];case 2:return e=t.sent(),this.qd.Wl(e.batchId),this.nf(e.batchId,o),[4,this.rf(e.Dn)];case 3:return t.sent(),[4,this.Nd.tl()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=hh(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},Rf.prototype.runTransaction=function(t,e,n){new gf(t,this.Nd,e,n).kd()},Rf.prototype.Mu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.tf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.Mu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.zd.get(e);n&&(Zs(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Bd=!0:0<t.Es.size?Zs(n.Bd):0<t.Is.size&&(Zs(n.Bd),n.Bd=!1))}),[4,this.rf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,_h(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Rf.prototype.Sd=function(r,t){this.tf("applyOnlineStateChange()");var i=[];this.Wd.forEach(function(t,e){var n=e.view.Sd(r);n.snapshot&&i.push(n.snapshot)}),this.Qd.hf(r),this.Qd.s_(i),this.onlineState=r},Rf.prototype.cl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.tf("rejectListens()"),this.qd.Zl(u,"rejected",a),e=this.zd.get(u),(n=e&&e.key)?(r=(r=new Jo(Xr.N)).me(n,new Io(n,Pr.min())),i=ms().add(n),o=new As(Pr.min(),new Map,new os(ru),r,i),[4,this.Mu(o)]):[3,2];case 1:return t.sent(),this.Gd=this.Gd.remove(n),this.zd.delete(u),this.af(),[3,4];case 2:return[4,this.F_.Qu(u,!1).then(function(){return s.if(u,a)}).catch(_h)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Rf.prototype.El=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.tf("applySuccessfulWrite()"),e=r.batch.batchId,this.uf(e,null),this.cf(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.Ko(r)];case 2:return n=t.sent(),this.qd.Kl(e,"acknowledged"),[4,this.rf(n)];case 3:return t.sent(),[3,6];case 4:return[4,_h(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Rf.prototype.Rl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.tf("rejectFailedWrite()"),this.uf(n,r),this.cf(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.F_.ku(n)];case 2:return e=t.sent(),this.qd.Kl(n,"rejected",r),[4,this.rf(e)];case 3:return t.sent(),[3,6];case 4:return[4,_h(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Rf.prototype._f=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.Nd.B_()||Ys("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.F_.ta()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.Jd.get(e)||[]).push(o),this.Jd.set(e,n),[3,4]);case 3:return r=t.sent(),i=hh(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},Rf.prototype.cf=function(t){(this.Jd.get(t)||[]).forEach(function(t){t.resolve()}),this.Jd.delete(t)},Rf.prototype.lf=function(e){this.Jd.forEach(function(t){t.forEach(function(t){t.reject(new Dr(Sr.CANCELLED,e))})}),this.Jd.clear()},Rf.prototype.nf=function(t,e){var n=this.Yd[this.currentUser.s()];n=(n=n||new Jo(ru)).me(t,e),this.Yd[this.currentUser.s()]=n},Rf.prototype.uf=function(t,e){var n=this.Yd[this.currentUser.s()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.Yd[this.currentUser.s()]=n}},Rf.prototype.if=function(t,e){var n=this;void 0===e&&(e=null),this.qd.Yl(t);for(var r=0,i=this.jd.get(t);r<i.length;r++){var o=i[r];this.Wd.delete(o),e&&this.Qd.df(o,e)}this.jd.delete(t),this.Zd&&this.Hd.ic(t).forEach(function(t){n.Hd.Dh(t)||n.ff(t)})},Rf.prototype.ff=function(t){var e=this.Gd.get(t);null!==e&&(this.Nd.nl(e),this.Gd=this.Gd.remove(t),this.zd.delete(e),this.af())},Rf.prototype.sf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof nf?(this.Hd.ph(i.key,t),this.Tf(i)):i instanceof rf?(Ys("SyncEngine","Document no longer in limbo: "+i.key),this.Hd.bh(i.key,t),this.Hd.Dh(i.key)||this.ff(i.key)):Js()}},Rf.prototype.Tf=function(t){var e=t.key;this.Gd.get(e)||(Ys("SyncEngine","New document in limbo: "+e),this.Kd.push(e),this.af())},Rf.prototype.af=function(){for(;0<this.Kd.length&&this.Gd.size<this.Ud;){var t=this.Kd.shift(),e=this.Xd.next();this.zd.set(e,new sf(t)),this.Gd=this.Gd.me(t,e),this.Nd.listen(new Lo(Ao.Wt(t.path).ee(),e,2,mu.dr))}},Rf.prototype.Ef=function(){return this.Gd},Rf.prototype.If=function(){return this.Kd},Rf.prototype.rf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Wd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Pd(r);return n.pd?u.F_.Wu(i.query,!1).then(function(t){var e=t.documents;return i.view.Pd(e,n)}):n}).then(function(t){var e=a&&a.as.get(i.targetId),n=i.view.xn(t,u.Zd,e);if(u.sf(i.targetId,n.vd),n.snapshot){u.Zd&&u.qd.Zl(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=vu.ar(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Qd.s_(o),[4,this.F_.xu(s)];case 2:return t.sent(),[2]}})})},Rf.prototype.tf=function(t){},Rf.prototype.Al=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.lf("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.F_.Su(r)]):[3,3];case 1:return n=t.sent(),this.qd.Su(r,n.Cu,n.Fu),[4,this.rf(n.Du)];case 2:t.sent(),t.label=3;case 3:return[4,this.Nd.Al()];case 4:return t.sent(),[2]}})})},Rf.prototype.enableNetwork=function(){return this.Nd.enableNetwork()},Rf.prototype.disableNetwork=function(){return this.Nd.disableNetwork()},Rf.prototype.ei=function(t){var e=this.zd.get(t);if(e&&e.Bd)return ms().add(e.key);var n=ms(),r=this.jd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.Wd.get(s);n=n.He(u.view.Ad)}return n},Rf),bf=(n(Of,af=wf),Object.defineProperty(Of.prototype,"Zd",{get:function(){return!0===this.wf},enumerable:!0,configurable:!0}),Of.prototype.enableNetwork=function(){return this.F_.ho(!0),af.prototype.enableNetwork.call(this)},Of.prototype.disableNetwork=function(){return this.F_.ho(!1),af.prototype.disableNetwork.call(this)},Of.prototype.Rf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.F_.Wu(r.query,!0)];case 1:return e=t.sent(),n=r.view.Cd(e),[2,(this.wf&&this.sf(r.targetId,n.vd),n)]}})})},Of.prototype.Sd=function(t,e){this.Zd&&0===e&&(af.prototype.Sd.call(this,t,e),this.qd.ed(t)),this.Zd||1!==e||af.prototype.Sd.call(this,t,e)},Of.prototype.ld=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.tf("applyBatchState()"),[4,this.F_.Gu(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Nd.tl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.uf(n,i||null),this.F_.zu(n)):Js(),t.label=4;case 4:return[4,this.rf(e)];case 5:return t.sent(),[3,7];case 6:Ys("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},Of.prototype.Pl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.wf?[3,3]:(e=this.qd.ql(),[4,this.mf(e.W(),!0)]);case 1:return n=t.sent(),this.wf=!0,[4,this.Nd.Pl(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Nd.listen(o);return[3,7];case 3:return!1!==h||!1===this.wf?[3,7]:(s=[],u=Promise.resolve(),this.jd.forEach(function(t,e){a.qd.Jl(e)?s.push(e):u=u.then(function(){return a.if(e),a.F_.Qu(e,!0)}),a.Nd.nl(e)}),[4,u]);case 4:return t.sent(),[4,this.mf(s,!1)];case 5:return t.sent(),this.Af(),this.wf=!1,[4,this.Nd.Pl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Of.prototype.Af=function(){var n=this;this.zd.forEach(function(t,e){n.Nd.nl(e)}),this.Hd.nc(),this.zd=new Map,this.Gd=new Jo(Xr.N)},Of.prototype.mf=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.jd.get(o))&&0!==u.length?[4,this.F_.Qu(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.F_.Uu(u[0].ee())];case 3:s=t.sent(),a=0,h=u,t.label=4;case 4:return a<h.length?(c=h[a],f=this.Wd.get(c),[4,this.Rf(f)]):[3,7];case 5:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=6;case 6:return a++,[3,4];case 7:return[3,12];case 8:return[4,this.F_.Hu(o)];case 9:return p=t.sent(),[4,this.F_.Uu(p)];case 10:return s=t.sent(),[4,this.ef(this.Pf(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(s),t.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Qd.s_(n),e)]}})})},Of.prototype.Pf=function(t){return new Ao(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Of.prototype.po=function(){return this.F_.po()},Of.prototype.dd=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.wf?(Ys("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.jd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.F_.Wr()];case 3:return e=t.sent(),n=As.ls(r,"current"===i),[4,this.rf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.F_.Qu(r,!0)];case 6:return t.sent(),this.if(r,o),[3,8];case 7:Js(),t.label=8;case 8:return[2]}})})},Of.prototype.fd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.wf)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.jd.has(r)?(Ys("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.F_.Hu(r)]):[3,6];case 2:return i=t.sent(),[4,this.F_.Uu(i)];case 3:return o=t.sent(),[4,this.ef(this.Pf(i),o.targetId,!1)];case 4:t.sent(),this.Nd.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.jd.has(e)?[4,u.F_.Qu(e,!1).then(function(){f.Nd.nl(e),f.if(e)}).catch(_h)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Of),Ef=(xf.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.pf.get(e))||(n=!0,r=new uf),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.hl.listen(e)];case 2:return i.Vf=t.sent(),[3,4];case 3:return o=t.sent(),s=hh(o,"Initialization of query '"+u.query+"' failed"),[2,void u.onError(s)];case 4:return this.pf.set(e,r),r.gf.push(u),u.Sd(this.onlineState),r.Vf&&u.bf(r.Vf)&&this.vf(),[2]}})})},xf.prototype.nl=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.pf.get(e))&&0<=(i=r.gf.indexOf(o))&&(r.gf.splice(i,1),n=0===r.gf.length),n?[2,(this.pf.delete(e),this.hl.nl(e))]:[2]})})},xf.prototype.s_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.pf.get(o);if(s){for(var u=0,a=s.gf;u<a.length;u++)a[u].bf(i)&&(e=!0);s.Vf=i}}e&&this.vf()},xf.prototype.df=function(t,e){var n=this.pf.get(t);if(n)for(var r=0,i=n.gf;r<i.length;r++)i[r].onError(e);this.pf.delete(t)},xf.prototype.hf=function(i){this.onlineState=i;var o=!1;this.pf.forEach(function(t,e){for(var n=0,r=e.gf;n<r.length;n++)r[n].Sd(i)&&(o=!0)}),o&&this.vf()},xf.prototype.Sf=function(t){this.yf.add(t),t.next()},xf.prototype.Df=function(t){this.yf.delete(t)},xf.prototype.vf=function(){this.yf.forEach(function(t){t.next()})},xf),Tf=(kf.prototype.bf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _s(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Ff?this.$f(t)&&(this.Cf.next(t),o=!0):this.kf(t,this.onlineState)&&(this.Mf(t),o=!0),this.Nf=t,o},kf.prototype.onError=function(t){this.Cf.error(t)},kf.prototype.Sd=function(t){this.onlineState=t;var e=!1;return this.Nf&&!this.Ff&&this.kf(this.Nf,t)&&(this.Mf(this.Nf),e=!0),e},kf.prototype.kf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Lf&&n||t.docs.B()&&"Offline"!==e)},kf.prototype.$f=function(t){if(0<t.docChanges.length)return!0;var e=this.Nf&&this.Nf.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},kf.prototype.Mf=function(t){t=_s.os(t.query,t.docs,t.ns,t.fromCache),this.Ff=!0,this.Cf.next(t)},kf),If=(Df.prototype.vu=function(t){this.Of=t},Df.prototype.Zn=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Pr.min())?this.xf(e,r):this.Of.Yn(e,o).next(function(t){var n=s.Bf(r,t);return(r.oe()||r.ae())&&s.pd(r.Bt,n,o,i)?s.xf(e,r):(Hs()<=l.DEBUG&&Ys("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Of.Zn(e,r,i).next(function(e){return n.forEach(function(t){e=e.me(t.key,t)}),e}))})},Df.prototype.Bf=function(n,t){var r=new os(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof To&&n.matches(e)&&(r=r.add(e))}),r},Df.prototype.pd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},Df.prototype.xf=function(t,e){return Hs()<=l.DEBUG&&Ys("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Of.Zn(t,e,Pr.min())},Df),Nf=(Sf.prototype.jo=function(t){return fu.resolve(0===this.Wn.length)},Sf.prototype.Ko=function(t,e,n){var r=e.batchId,i=this.Qf(r,"acknowledged");return Zs(0===i),this.Wn[i],this.lastStreamToken=n,fu.resolve()},Sf.prototype.zo=function(t){return fu.resolve(this.lastStreamToken)},Sf.prototype.Ho=function(t,e){return this.lastStreamToken=e,fu.resolve()},Sf.prototype.Yo=function(t,e,n,r){var i=this.qf;this.qf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new hu(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Uf=this.Uf.add(new Sh(a.key,i)),this.jn.vr(t,a.key.path.M())}return fu.resolve(o)},Sf.prototype.Jo=function(t,e){return fu.resolve(this.Wf(e))},Sf.prototype.Zo=function(t,e){var n=e+1,r=this.jf(n),i=r<0?0:r;return fu.resolve(this.Wn.length>i?this.Wn[i]:null)},Sf.prototype.ta=function(){return fu.resolve(0===this.Wn.length?-1:this.qf-1)},Sf.prototype.ea=function(t){return fu.resolve(this.Wn.slice())},Sf.prototype.Gn=function(t,e){var n=this,r=new Sh(e,0),i=new Sh(e,Number.POSITIVE_INFINITY),o=[];return this.Uf.Ke([r,i],function(t){var e=n.Wf(t.hc);o.push(e)}),fu.resolve(o)},Sf.prototype.Xn=function(t,e){var r=this,i=new os(ru);return e.forEach(function(t){var e=new Sh(t,0),n=new Sh(t,Number.POSITIVE_INFINITY);r.Uf.Ke([e,n],function(t){i=i.add(t.hc)})}),fu.resolve(this.Kf(i))},Sf.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Xr.et(i)||(i=i.child(""));var o=new Sh(new Xr(i),0),s=new os(ru);return this.Uf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.hc)),!0)},o),fu.resolve(this.Kf(s))},Sf.prototype.Kf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Wf(t);null!==e&&r.push(e)}),r},Sf.prototype.ia=function(n,r){var i=this;Zs(0===this.Qf(r.batchId,"removed")),this.Wn.shift();var o=this.Uf;return fu.forEach(r.mutations,function(t){var e=new Sh(t.key,r.batchId);return o=o.delete(e),i.nh.Oo(n,t.key)}).next(function(){i.Uf=o})},Sf.prototype.na=function(t){},Sf.prototype.Dh=function(t,e){var n=new Sh(e,0),r=this.Uf.ze(n);return fu.resolve(e.isEqual(r&&r.key))},Sf.prototype.ra=function(t){return this.Wn.length,fu.resolve()},Sf.prototype.Qf=function(t,e){return this.jf(t)},Sf.prototype.jf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},Sf.prototype.Wf=function(t){var e=this.jf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},Sf),_f=(Af.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Gf(e);return this.docs=this.docs.me(r,{kr:e,size:s,readTime:n}),this.size+=s-o,this.jn.vr(t,r.path.M())},Af.prototype.kn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Af.prototype.Mn=function(t,e){var n=this.docs.get(e);return fu.resolve(n?n.kr:null)},Af.prototype.getEntries=function(t,e){var n=this,r=fs();return e.forEach(function(t){var e=n.docs.get(t);r=r.me(t,e?e.kr:null)}),fu.resolve(r)},Af.prototype.Zn=function(t,e,n){for(var r=ps(),i=new Xr(e.path.child("")),o=this.docs.ve(i);o.$e();){var s=o.Ne(),u=s.key,a=s.value,h=a.kr,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof To&&e.matches(h)&&(r=r.me(h.key,h))}return fu.resolve(r)},Af.prototype.zf=function(t,e){return fu.forEach(this.docs,function(t){return e(t)})},Af.prototype.zr=function(t){return new Af.Hr(this)},Af.prototype.Jr=function(t){return fu.resolve(this.size)},Af);function Af(t,e){this.jn=t,this.Gf=e,this.docs=new Jo(Xr.N),this.size=0}function Sf(t,e){this.jn=t,this.nh=e,this.Wn=[],this.qf=1,this.lastStreamToken=ei.ht,this.Uf=new os(Sh.Ju)}function Df(){}function kf(t,e,n){this.query=t,this.Cf=e,this.Ff=!1,this.Nf=null,this.onlineState="Unknown",this.options=n||{}}function xf(t){this.hl=t,this.pf=new au(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.yf=new Set,this.hl.subscribe(this)}function Of(t,e,n,r,i){var o=this;return(o=af.call(this,t,e,n,r,i)||this).F_=t,o.wf=void 0,o}function Rf(t,e,n,r,i){this.F_=t,this.Nd=e,this.qd=n,this.currentUser=r,this.Ud=i,this.Qd=null,this.Wd=new au(function(t){return t.canonicalId()}),this.jd=new Map,this.Kd=[],this.Gd=new Jo(Xr.N),this.zd=new Map,this.Hd=new Ah,this.Yd={},this.Jd=new Map,this.Xd=Xu.ih(),this.onlineState="Unknown"}function Vf(t,e,n,r){this.wa=t,this.Nd=e,this.updateFunction=n,this.Aa=r,this.$d=5,this.Na=new ku(this.wa,"transaction_retry")}function Pf(t,e){this.query=t,this.Id=e,this.wd=null,this.fs=!1,this.Rd=ms(),this.ns=ms(),this.md=new Is(t.se.bind(t))}function Lf(){this.Td=new df,this.Ed={},this.hl=null,this.V_=null,this.ur=null}function Cf(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.bl=r,this.hl=null,this.V_=null,this.ur=null,this.vl=this.Sl.bind(this),this.Dl=new Jo(ru),this.io=!1,this.Cl=[],!Cf.jh(this.platform))throw new Dr(Sr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Fl=Zc(this.persistenceKey,this.bl),this.Nl="firestore_sequence_number_"+this.persistenceKey,this.Dl=this.Dl.me(this.bl,new df),this.$l=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.kl=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ll="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.vl)}function Mf(){this.activeTargetIds=ws()}function jf(t,e){this.clientId=t,this.onlineState=e}function Uf(t,e){this.clientId=t,this.activeTargetIds=e}function qf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Ff(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Bf(t){var e=this;return(e=hf.call(this)||this).Xr=t,e}_f.Hr=(n(Bf,hf=lu),Bf.prototype.xn=function(n){var r=this,i=[];return this.Dn.forEach(function(t,e){e?i.push(r.Xr.Nn(n,e,r.readTime)):r.Xr.kn(t)}),fu.vn(i)},Bf.prototype.Ln=function(t,e){return this.Xr.Mn(t,e)},Bf.prototype.On=function(t,e){return this.Xr.getEntries(t,e)},Bf);var Gf,zf,Wf=(sl.prototype.js=function(t,n){return this.Hf.forEach(function(t,e){return n(e)}),fu.resolve()},sl.prototype.ah=function(t){return fu.resolve(this.lastRemoteSnapshotVersion)},sl.prototype.uh=function(t){return fu.resolve(this.Yf)},sl.prototype.rh=function(t){return this.highestTargetId=this.Xf.next(),fu.resolve(this.highestTargetId)},sl.prototype.lh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Yf&&(this.Yf=e),fu.resolve()},sl.prototype.fh=function(t){this.Hf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Xf=new Xu(e),this.highestTargetId=e),t.sequenceNumber>this.Yf&&(this.Yf=t.sequenceNumber)},sl.prototype.dh=function(t,e){return this.fh(e),this.targetCount+=1,fu.resolve()},sl.prototype.Eh=function(t,e){return this.fh(e),fu.resolve()},sl.prototype.Ih=function(t,e){return this.Hf.delete(e.target),this.Jf.ic(e.targetId),--this.targetCount,fu.resolve()},sl.prototype.Rh=function(n,r,i){var o=this,s=0,u=[];return this.Hf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Hf.delete(t),u.push(o.wh(n,e.targetId)),s++)}),fu.vn(u).next(function(){return s})},sl.prototype.Ph=function(t){return fu.resolve(this.targetCount)},sl.prototype.Vh=function(t,e){var n=this.Hf.get(e)||null;return fu.resolve(n)},sl.prototype.gh=function(t,e,n){return this.Jf.tc(e,n),fu.resolve()},sl.prototype.yh=function(e,t,n){this.Jf.sc(t,n);var r=this.persistence.nh,i=[];return r&&t.forEach(function(t){i.push(r.Oo(e,t))}),fu.vn(i)},sl.prototype.wh=function(t,e){return this.Jf.ic(e),fu.resolve()},sl.prototype.vh=function(t,e){var n=this.Jf.rc(e);return fu.resolve(n)},sl.prototype.Dh=function(t,e){return fu.resolve(this.Jf.Dh(e))},sl),Qf=(ol.prototype.start=function(){return Promise.resolve()},ol.prototype.Ro=function(){return this.xh=!1,Promise.resolve()},Object.defineProperty(ol.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),ol.prototype.no=function(){},ol.prototype.Do=function(){return this.jn},ol.prototype.yo=function(t){var e=this.Zf[t.s()];return e||(e=new Nf(this.jn,this.nh),this.Zf[t.s()]=e),e},ol.prototype.vo=function(){return this.zh},ol.prototype.So=function(){return this.Qn},ol.prototype.runTransaction=function(t,e,n){var r=this;Ys("MemoryPersistence","Starting transaction:",t);var i=new Hf(this.Oh.next());return this.nh.eT(),n(i).next(function(t){return r.nh.sT(i).next(function(){return t})}).yn().then(function(t){return i.Un(),t})},ol.prototype.iT=function(e,n){return fu.Sn(Object.values(this.Zf).map(function(t){return function(){return t.Dh(e,n)}}))},ol),Hf=(n(il,zf=du),il),Kf=(rl.hT=function(t){return new rl(t)},Object.defineProperty(rl.prototype,"oT",{get:function(){if(this.rT)return this.rT;throw Js()},enumerable:!0,configurable:!0}),rl.prototype.ph=function(t,e,n){return this.nT.ph(n,e),this.oT.delete(n),fu.resolve()},rl.prototype.bh=function(t,e,n){return this.nT.bh(n,e),this.oT.add(n),fu.resolve()},rl.prototype.Oo=function(t,e){return this.oT.add(e),fu.resolve()},rl.prototype.removeTarget=function(t,e){var n=this;this.nT.ic(e.targetId).forEach(function(t){return n.oT.add(t)});var r=this.persistence.vo();return r.vh(t,e.targetId).next(function(t){t.forEach(function(t){return n.oT.add(t)})}).next(function(){return r.Ih(t,e)})},rl.prototype.eT=function(){this.rT=new Set},rl.prototype.sT=function(t){var n=this,r=this.persistence.So().zr();return fu.forEach(this.oT,function(e){return n.aT(t,e).next(function(t){t||r.kn(e)})}).next(function(){return n.rT=null,r.apply(t)})},rl.prototype.Uo=function(t,e){var n=this;return this.aT(t,e).next(function(t){t?n.oT.delete(e):n.oT.add(e)})},rl.prototype.tT=function(t){return 0},rl.prototype.aT=function(t,e){var n=this;return fu.Sn([function(){return fu.resolve(n.nT.Dh(e))},function(){return n.persistence.vo().Dh(t,e)},function(){return n.persistence.iT(t,e)}])},rl),Yf=(nl.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.qd=this.uT(n),this.persistence=this.cT(n),[4,this.persistence.start()];case 1:return t.sent(),this._T=this.lT(n),this.F_=this.dT(n),this.Nd=this.fT(n),this.hl=this.TT(n),this.ET=this.IT(n),this.qd.V_=function(t){return e.hl.Sd(t,1)},this.Nd.hl=this.hl,[4,this.F_.start()];case 2:return t.sent(),[4,this.qd.start()];case 3:return t.sent(),[4,this.Nd.start()];case 4:return t.sent(),[4,this.Nd.Pl(this.hl.Zd)];case 5:return t.sent(),[2]}})})},nl.prototype.IT=function(t){return new Ef(this.hl)},nl.prototype.lT=function(t){return null},nl.prototype.dT=function(t){return new gh(this.persistence,new If,t.wT)},nl.prototype.cT=function(t){return new Qf(Kf.hT)},nl.prototype.fT=function(t){var e=this;return new Wc(this.F_,t.f_,t.wa,function(t){return e.hl.Sd(t,0)},t.platform.RT())},nl.prototype.uT=function(t){return new vf},nl.prototype.TT=function(t){return new wf(this.F_,this.Nd,this.qd,t.wT,t.Ud)},nl.prototype.clearPersistence=function(t){throw new Dr(Sr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},nl),Xf=(n(el,Gf=Yf),el.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Gf.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.so(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.hl.Pl(e)];case 1:return t.sent(),this._T&&(e&&!this._T.io?this._T.start(this.F_):e||this._T.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},el.prototype.dT=function(t){return new Ih(this.persistence,new If,t.wT)},el.prototype.TT=function(t){var e=new bf(this.F_,this.Nd,this.qd,t.wT,t.Ud);return this.qd instanceof yf&&(this.qd.hl=e),e},el.prototype.lT=function(t){var e=this.persistence.nh.No;return new vh(e,t.wa)},el.prototype.cT=function(t){var e=aa.Fo(t.mT),n=t.platform.yc(t.mT.ii);return new aa(t.AT.synchronizeTabs,e,t.clientId,t.platform,ph.ru(t.AT.cacheSizeBytes),t.wa,n,this.qd)},el.prototype.uT=function(t){if(t.AT.PT&&t.AT.synchronizeTabs){if(!yf.jh(t.platform))throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=aa.Fo(t.mT);return new yf(t.wa,t.platform,e,t.clientId,t.wT)}return new vf},el.prototype.clearPersistence=function(t){var e=aa.Fo(t);return aa.clearPersistence(e)},el),$f=(tl.prototype.start=function(e,n){var r=this;this.VT();var i=new Du,o=new Du,s=!1;return this.credentials.l(function(t){if(!s)return s=!0,Ys("FirestoreClient","Initializing. user=",t.uid),r.gT(e,n,t,o).then(i.resolve,i.reject);r.wa.oo(function(){return r.Al(t)})}),this.wa.oo(function(){return i.promise}),o.promise},tl.prototype.enableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue(function(){return t.hl.enableNetwork()})},tl.prototype.gT=function(a,h,c,f){return y(this,void 0,void 0,function(){var r,i,o,s,u=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.pT(this.mT)];case 1:return r=t.sent(),i=this.platform.yc(this.mT.ii),e=r,n=this.credentials,o=new Bc(e,n,i),[4,a.initialize({wa:this.wa,mT:this.mT,platform:this.platform,f_:o,clientId:this.clientId,wT:c,Ud:100,AT:h})];case 2:return t.sent(),this.persistence=a.persistence,this.qd=a.qd,this.F_=a.F_,this.Nd=a.Nd,this.hl=a.hl,this._T=a._T,this.yT=a.ET,this.persistence.no(function(){return y(u,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),f.resolve(),[3,4];case 3:if(s=t.sent(),f.reject(s),!this.bT(s))throw s;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),this.gT(new Yf,{PT:!1},c,f))];case 4:return[2]}var e,n})})},tl.prototype.bT=function(t){return"FirebaseError"===t.name?t.code===Sr.FAILED_PRECONDITION||t.code===Sr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},tl.prototype.VT=function(){if(this.wa.Ma)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},tl.prototype.Al=function(t){return this.wa.Wa(),Ys("FirestoreClient","Credential Changed. Current user: "+t.uid),this.hl.Al(t)},tl.prototype.disableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue(function(){return t.hl.disableNetwork()})},tl.prototype.terminate=function(){var t=this;return this.wa.qa(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._T&&this._T.stop(),[4,this.Nd.Ro()];case 1:return t.sent(),[4,this.qd.Ro()];case 2:return t.sent(),[4,this.persistence.Ro()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},tl.prototype.waitForPendingWrites=function(){var t=this;this.VT();var e=new Du;return this.wa.oo(function(){return t.hl._f(e)}),e.promise},tl.prototype.listen=function(t,e,n){var r=this;this.VT();var i=new Tf(t,e,n);return this.wa.oo(function(){return r.yT.listen(i)}),i},tl.prototype.nl=function(t){var e=this;this.vT||this.wa.oo(function(){return e.yT.nl(t)})},tl.prototype.ST=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.VT(),i=new Du,[4,this.wa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.F_.qu(o)];case 1:return(e=t.sent())instanceof To?i.resolve(e):e instanceof Io?i.resolve(null):i.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=hh(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},tl.prototype.DT=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.VT(),u=new Du,[4,this.wa.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.F_.Wu(a,!0)];case 1:return e=t.sent(),n=new mf(a,e.ju),r=n.Pd(e.documents),i=n.xn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=hh(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},tl.prototype.write=function(t){var e=this;this.VT();var n=new Du;return this.wa.oo(function(){return e.hl.write(t,n)}),n.promise},tl.prototype.ii=function(){return this.mT.ii},tl.prototype.Sf=function(t){var e=this;this.VT(),this.wa.oo(function(){return e.yT.Sf(t),Promise.resolve()})},tl.prototype.Df=function(t){var e=this;this.vT||this.wa.oo(function(){return e.yT.Df(t),Promise.resolve()})},Object.defineProperty(tl.prototype,"vT",{get:function(){return this.wa.Ma},enumerable:!0,configurable:!0}),tl.prototype.transaction=function(t){var e=this;this.VT();var n=new Du;return this.wa.oo(function(){return e.hl.runTransaction(e.wa,t,n),Promise.resolve()}),n.promise},tl),Jf=(Zf.prototype.next=function(t){this.CT(this.observer.next,t)},Zf.prototype.error=function(t){this.CT(this.observer.error,t)},Zf.prototype.FT=function(){this.muted=!0},Zf.prototype.CT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Zf);function Zf(t){this.observer=t,this.muted=!1}function tl(t,e,n,r){this.platform=t,this.mT=e,this.credentials=n,this.wa=r,this.clientId=eu.cn()}function el(){return null!==Gf&&Gf.apply(this,arguments)||this}function nl(){}function rl(t){this.persistence=t,this.nT=new Ah,this.rT=null}function il(t){var e=this;return(e=zf.call(this)||this).Mh=t,e}function ol(t){var e=this;this.Zf={},this.Oh=new mu(0),this.xh=!1,this.xh=!0,this.nh=t(this),this.zh=new Wf(this),this.jn=new Lu,this.Qn=new _f(this.jn,function(t){return e.nh.tT(t)})}function sl(t){this.persistence=t,this.Hf=new au(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Pr.min(),this.highestTargetId=0,this.Yf=0,this.Jf=new Ah,this.targetCount=0,this.Xf=Xu.sh()}function ul(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var al,hl,cl=(Pl.prototype.$T=function(t){switch(hi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vi(t.integerValue||t.doubleValue);case 3:return this.kT(t.timestampValue);case 4:return this.MT(t);case 5:return t.stringValue;case 6:return new Xh(mi(t.bytesValue));case 7:return this.LT(t.referenceValue);case 8:return this.OT(t.geoPointValue);case 9:return this.xT(t.arrayValue);case 10:return this.BT(t.mapValue);default:throw Js()}},Pl.prototype.BT=function(t){var n=this,r={};return Zr(t.fields||{},function(t,e){r[t]=n.$T(e)}),r},Pl.prototype.OT=function(t){return new lc(vi(t.latitude),vi(t.longitude))},Pl.prototype.xT=function(t){var e=this;return(t.values||[]).map(function(t){return e.$T(t)})},Pl.prototype.MT=function(t){switch(this.NT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return si(n)?t(n):n}(t);return null==e?null:this.$T(e);case"estimate":return this.kT(ui(t));default:return null}},Pl.prototype.kT=function(t){var e=yi(t),n=new Vr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Pl.prototype.LT=function(t){var e=Cr.K(t);Zs(Gs(e));var n=new uu(e.get(1),e.get(3)),r=new Xr(e.k(5));return n.isEqual(this.firestore.Nc)||Xs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Nc.projectId+"/"+this.firestore.Nc.database+") instead."),new vl(r,this.firestore,this.converter)},Pl),fl=ph.au,ll=(Vl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Vl),pl=(Rl.prototype.settings=function(t){Oh("Firestore.settings",arguments,1),Ph("Firestore.settings","object",1,t);var e=new ll(t);if(this.WT&&!this.HT.isEqual(e))throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.HT=e).credentials&&(this.GT=function(t){if(!t)return new kr;switch(t.type){case"gapi":var e=t.JT;return Zs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Rr(e,t.V||"0");case"provider":return t.JT;default:throw new Dr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Rl.prototype.enableNetwork=function(){return this.QT(),this.WT.enableNetwork()},Rl.prototype.disableNetwork=function(){return this.QT(),this.WT.disableNetwork()},Rl.prototype.enablePersistence=function(t){var e,n;if(this.WT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Xs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.XT(this.zT,{PT:!0,cacheSizeBytes:this.HT.cacheSizeBytes,synchronizeTabs:r})},Rl.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.WT&&!this.WT.vT)throw new Dr(Sr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new Du,[2,(this.UT.La(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.ZT(),[4,this.zT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Rl.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Rl.prototype,"tE",{get:function(){return this.QT(),this.WT.vT},enumerable:!0,configurable:!0}),Rl.prototype.waitForPendingWrites=function(){return this.QT(),this.WT.waitForPendingWrites()},Rl.prototype.onSnapshotsInSync=function(t){if(this.QT(),ul(t))return this.eE(t);Ph("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.eE(e)},Rl.prototype.eE=function(t){var e=this,n=new Jf({next:function(){t.next&&t.next()},error:function(t){throw Js()}});return this.WT.Sf(n),function(){n.FT(),e.WT.Df(n)}},Rl.prototype.QT=function(){return this.WT||this.XT(new Yf,{PT:!1}),this.WT},Rl.prototype.ZT=function(){return new su(this.Nc,this.KT,this.HT.host,this.HT.ssl,this.HT.forceLongPolling)},Rl.prototype.XT=function(t,e){var n=this.ZT();return this.WT=new $f(zs.nt(),n,this.GT,this.UT),this.WT.start(t,e)},Rl.jT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Dr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Dr(Sr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new uu(n)},Object.defineProperty(Rl.prototype,"app",{get:function(){if(!this.qT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.qT},enumerable:!0,configurable:!0}),Rl.prototype.collection=function(t){return Oh("Firestore.collection",arguments,1),Ph("Firestore.collection","non-empty string",1,t),this.QT(),new Tl(Cr.K(t),this)},Rl.prototype.doc=function(t){return Oh("Firestore.doc",arguments,1),Ph("Firestore.doc","non-empty string",1,t),this.QT(),vl.sE(Cr.K(t),this)},Rl.prototype.collectionGroup=function(t){if(Oh("Firestore.collectionGroup",arguments,1),Ph("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.QT(),new bl(new Ao(Cr.G,t),this)},Rl.prototype.runTransaction=function(e){var n=this;return Oh("Firestore.runTransaction",arguments,1),Ph("Firestore.runTransaction","function",1,e),this.QT().transaction(function(t){return e(new dl(n,t))})},Rl.prototype.batch=function(){return this.QT(),new yl(this)},Object.defineProperty(Rl,"logLevel",{get:function(){switch(Hs()){case l.DEBUG:return"debug";case l.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),Rl.setLogLevel=function(t){switch(Oh("Firestore.setLogLevel",arguments,1),Ph("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ks(l.DEBUG);break;case"error":Ks(l.ERROR);break;case"silent":Ks(l.SILENT);break;default:throw new Dr(Sr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Rl.prototype.iE=function(){return this.HT.timestampsInSnapshots},Rl),dl=(Ol.prototype.get=function(t){var n=this;Oh("Transaction.get",arguments,1);var r=jl("Transaction.get",t,this.nE);return this.rE.R_([r.$c]).then(function(t){if(!t||1!==t.length)return Js();var e=t[0];if(e instanceof Io)return new gl(n.nE,r.$c,null,!1,!1,r.hE);if(e instanceof To)return new gl(n.nE,r.$c,e,!1,!1,r.hE);throw Js()})},Ol.prototype.set=function(t,e,n){Vh("Transaction.set",arguments,2,3);var r=jl("Transaction.set",t,this.nE);n=Ll("Transaction.set",n);var i=Ul(r.hE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.rE.set(r.$c,u),this},Ol.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof $h?(Rh("Transaction.update",arguments,3),r=jl("Transaction.update",t,this.nE),this.nE.YT.Cc("Transaction.update",e,n,o)):(Oh("Transaction.update",arguments,2),r=jl("Transaction.update",t,this.nE),this.nE.YT.Dc("Transaction.update",e)),this.rE.update(r.$c,i),this},Ol.prototype.delete=function(t){Oh("Transaction.delete",arguments,1);var e=jl("Transaction.delete",t,this.nE);return this.rE.delete(e.$c),this},Ol),yl=(xl.prototype.set=function(t,e,n){Vh("WriteBatch.set",arguments,2,3),this.uE();var r=jl("WriteBatch.set",t,this.nE);n=Ll("WriteBatch.set",n);var i=Ul(r.hE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.oE=this.oE.concat(u.Rc(r.$c,Fi.ft())),this},xl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.uE(),i="string"==typeof e||e instanceof $h?(Rh("WriteBatch.update",arguments,3),r=jl("WriteBatch.update",t,this.nE),this.nE.YT.Cc("WriteBatch.update",e,n,o)):(Oh("WriteBatch.update",arguments,2),r=jl("WriteBatch.update",t,this.nE),this.nE.YT.Dc("WriteBatch.update",e)),this.oE=this.oE.concat(i.Rc(r.$c,Fi.exists(!0))),this},xl.prototype.delete=function(t){Oh("WriteBatch.delete",arguments,1),this.uE();var e=jl("WriteBatch.delete",t,this.nE);return this.oE=this.oE.concat(new Qi(e.$c,Fi.ft())),this},xl.prototype.commit=function(){return this.uE(),this.aE=!0,0<this.oE.length?this.nE.QT().write(this.oE):Promise.resolve()},xl.prototype.uE=function(){if(this.aE)throw new Dr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},xl),vl=(kl.sE=function(t,e,n){if(t.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new kl(new Xr(t),e,n)},Object.defineProperty(kl.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"parent",{get:function(){return new Tl(this.$c.path.M(),this.firestore,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(kl.prototype,"path",{get:function(){return this.$c.path.j()},enumerable:!0,configurable:!0}),kl.prototype.collection=function(t){if(Oh("DocumentReference.collection",arguments,1),Ph("DocumentReference.collection","non-empty string",1,t),!t)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Cr.K(t);return new Tl(this.$c.path.child(e),this.firestore)},kl.prototype.isEqual=function(t){if(!(t instanceof kl))throw zh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.$c.isEqual(t.$c)&&this.hE===t.hE},kl.prototype.set=function(t,e){Vh("DocumentReference.set",arguments,1,2),e=Ll("DocumentReference.set",e);var n=Ul(this.hE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.YT.Sc(i,r,e.mergeFields):this.firestore.YT.bc(i,r);return this.WT.write(o.Rc(this.$c,Fi.ft()))},kl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof $h?(Rh("DocumentReference.update",arguments,2),this.firestore.YT.Cc("DocumentReference.update",t,e,r)):(Oh("DocumentReference.update",arguments,1),this.firestore.YT.Dc("DocumentReference.update",t)),this.WT.write(n.Rc(this.$c,Fi.exists(!0)))},kl.prototype.delete=function(){return Oh("DocumentReference.delete",arguments,0),this.WT.write([new Qi(this.$c,Fi.ft())])},kl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Vh("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||ul(t[i])||(Gh("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Mh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=ul(t[i])?t[i]:(Ph("DocumentReference.onSnapshot","function",i,t[i]),Lh("DocumentReference.onSnapshot","function",i+1,t[i+1]),Lh("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.cE(o,n)},kl.prototype.cE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Jf({next:function(t){if(n.next){var e=t.docs.get(r.$c);n.next(new gl(r.firestore,r.$c,e,t.fromCache,t.hasPendingWrites,r.hE))}},error:e}),o=this.WT.listen(Ao.Wt(this.$c.path),i,t);return function(){i.FT(),r.WT.nl(o)}},kl.prototype.get=function(n){var r=this;return Vh("DocumentReference.get",arguments,0,1),Ml("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.QT().ST(r.$c).then(function(t){e(new gl(r.firestore,r.$c,t,!0,t instanceof To&&t.At,r.hE))},t):r._E(e,t,n)})},kl.prototype._E=function(e,n,r){var i=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Dr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Dr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},kl.prototype.withConverter=function(t){return new kl(this.$c,this.firestore,t)},kl),ml=(Dl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Dl),gl=(Sl.prototype.data=function(t){if(Vh("DocumentSnapshot.data",arguments,0,1),t=Cl("DocumentSnapshot.data",t),this.lE){if(this.hE){var e=new wl(this.nE,this.$c,this.lE,this.dE,this.fE);return this.hE.fromFirestore(e,t)}return new cl(this.nE,this.nE.iE(),t.serverTimestamps,void 0).$T(this.lE.Mt())}},Sl.prototype.get=function(t,e){if(Vh("DocumentSnapshot.get",arguments,1,2),e=Cl("DocumentSnapshot.get",e),this.lE){var n=this.lE.data().field(Vc("DocumentSnapshot.get",t));if(null!==n)return new cl(this.nE,this.nE.iE(),e.serverTimestamps,this.hE).$T(n)}},Object.defineProperty(Sl.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"ref",{get:function(){return new vl(this.$c,this.nE,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"exists",{get:function(){return null!==this.lE},enumerable:!0,configurable:!0}),Object.defineProperty(Sl.prototype,"metadata",{get:function(){return new ml(this.fE,this.dE)},enumerable:!0,configurable:!0}),Sl.prototype.isEqual=function(t){if(!(t instanceof Sl))throw zh("isEqual","DocumentSnapshot",1,t);return this.nE===t.nE&&this.dE===t.dE&&this.$c.isEqual(t.$c)&&(null===this.lE?null===t.lE:this.lE.isEqual(t.lE))&&this.hE===t.hE},Sl),wl=(n(Al,hl=gl),Al.prototype.data=function(t){return hl.prototype.data.call(this,t)},Al),bl=(_l.prototype.where=function(t,e,n){Oh("Query.where",arguments,3),Bh("Query.where",3,n);var r,i=function(t,e){if(!t.some(function(t){return t===e}))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+Fh(e)+" provided to function Query.where() for its "+Qh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Vc("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.EE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.IE(h))}r={arrayValue:{values:s}}}else r=this.IE(n)}else"in"!==i&&"array-contains-any"!==i||this.EE(n,i),r=this.firestore.YT.Fc("Query.where",n,"in"===i);var c=So.create(o,i,r);return this.wE(c),new _l(this.TE.Gt(c),this.firestore,this.hE)},_l.prototype.orderBy=function(t,e){var n;if(Vh("Query.orderBy",arguments,1,2),Lh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.TE.startAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.TE.endAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Vc("Query.orderBy",t),i=new Po(r,n);return this.RE(i),new _l(this.TE.zt(i),this.firestore,this.hE)},_l.prototype.limit=function(t){return Oh("Query.limit",arguments,1),Ph("Query.limit","number",1,t),Wh("Query.limit",1,t),new _l(this.TE.Ht(t),this.firestore,this.hE)},_l.prototype.limitToLast=function(t){return Oh("Query.limitToLast",arguments,1),Ph("Query.limitToLast","number",1,t),Wh("Query.limitToLast",1,t),new _l(this.TE.Yt(t),this.firestore,this.hE)},_l.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Rh("Query.startAt",arguments,1);var r=this.mE("Query.startAt",t,e,!0);return new _l(this.TE.Jt(r),this.firestore,this.hE)},_l.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Rh("Query.startAfter",arguments,1);var r=this.mE("Query.startAfter",t,e,!1);return new _l(this.TE.Jt(r),this.firestore,this.hE)},_l.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Rh("Query.endBefore",arguments,1);var r=this.mE("Query.endBefore",t,e,!0);return new _l(this.TE.Xt(r),this.firestore,this.hE)},_l.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Rh("Query.endAt",arguments,1);var r=this.mE("Query.endAt",t,e,!1);return new _l(this.TE.Xt(r),this.firestore,this.hE)},_l.prototype.isEqual=function(t){if(!(t instanceof _l))throw zh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.TE.isEqual(t.TE)},_l.prototype.withConverter=function(t){return new _l(this.TE,this.firestore,t)},_l.prototype.mE=function(t,e,n,r){if(Bh(t,1,e),e instanceof gl){if(0<n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Dr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.AE(i.lE,r)}var o=[e].concat(n);return this.PE(t,o,r)},_l.prototype.AE=function(t,e){for(var n=[],r=0,i=this.TE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(gi(this.firestore.Nc,t.key));else{var s=t.field(o.field);if(si(s))throw new Dr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new Vo(n,e)},_l.prototype.PE=function(t,e,n){var r=this.TE.xt;if(e.length>r.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.TE._e()&&-1!==s.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.TE.path.child(Cr.K(s));if(!Xr.et(u))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Xr(u);i.push(gi(this.firestore.Nc,a))}else{var h=this.firestore.YT.Fc(t,s);i.push(h)}}return new Vo(i,n)},_l.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Vh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||ul(t[i])||(Gh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Mh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=ul(t[i])?t[i]:(Ph("Query.onSnapshot","function",i,t[i]),Lh("Query.onSnapshot","function",i+1,t[i+1]),Lh("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.VE(this.TE),this.cE(r,n)},_l.prototype.cE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Jf({next:function(t){e.next&&e.next(new El(n.firestore,n.TE,t,n.hE))},error:r}),o=this.firestore.QT(),s=o.listen(this.TE,i,t);return function(){i.FT(),o.nl(s)}},_l.prototype.VE=function(t){if(t.ae()&&0===t.xt.length)throw new Dr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},_l.prototype.get=function(n){var r=this;return Vh("Query.get",arguments,0,1),Ml("Query.get",n),this.VE(this.TE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.QT().DT(r.TE).then(function(t){e(new El(r.firestore,r.TE,t,r.hE))},t):r._E(e,t,n)})},_l.prototype._E=function(e,n,r){var i=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Dr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},_l.prototype.IE=function(t){if("string"==typeof t){if(""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.TE._e()&&-1!==t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.TE.path.child(Cr.K(t));if(!Xr.et(e))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return gi(this.firestore.Nc,new Xr(e))}if(t instanceof vl){var n=t;return gi(this.firestore.Nc,n.$c)}throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Fh(t)+".")},_l.prototype.EE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},_l.prototype.wE=function(t){if(t instanceof So){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.TE.jt();if(null!==o&&!o.isEqual(t.field))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.TE.Kt();null!==s&&this.gE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.TE.ce(n)),null===u&&r&&(u=this.TE.ce(e)),null!=u)throw u===t.op?new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},_l.prototype.RE=function(t){if(null===this.TE.Kt()){var e=this.TE.jt();null!==e&&this.gE(e,t.field)}},_l.prototype.gE=function(t,e){if(!e.isEqual(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},_l),El=(Object.defineProperty(Nl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(Nl.prototype,"empty",{get:function(){return this.yE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Nl.prototype,"size",{get:function(){return this.yE.docs.size},enumerable:!0,configurable:!0}),Nl.prototype.forEach=function(e,n){var r=this;Vh("QuerySnapshot.forEach",arguments,1,2),Ph("QuerySnapshot.forEach","function",1,e),this.yE.docs.forEach(function(t){e.call(n,r.SE(t))})},Object.defineProperty(Nl.prototype,"query",{get:function(){return new bl(this.pE,this.nE,this.hE)},enumerable:!0,configurable:!0}),Nl.prototype.docChanges=function(t){t&&(Gh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Mh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.yE.hs)throw new Dr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bE&&this.vE===e||(this.bE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new wl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new wl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Js()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.nE,e,this.yE,this.hE),this.vE=e),this.bE},Nl.prototype.isEqual=function(t){if(!(t instanceof Nl))throw zh("isEqual","QuerySnapshot",1,t);return this.nE===t.nE&&this.pE.isEqual(t.pE)&&this.yE.isEqual(t.yE)&&this.hE===t.hE},Nl.prototype.SE=function(t){return new wl(this.nE,t.key,t,this.metadata.fromCache,this.yE.ns.has(t.key),this.hE)},Nl),Tl=(n(Il,al=bl),Object.defineProperty(Il.prototype,"id",{get:function(){return this.TE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"parent",{get:function(){var t=this.TE.path.M();return t.B()?null:new vl(new Xr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"path",{get:function(){return this.TE.path.j()},enumerable:!0,configurable:!0}),Il.prototype.doc=function(t){if(Vh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=eu.cn()),Ph("CollectionReference.doc","non-empty string",1,t),""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Cr.K(t);return vl.sE(this.TE.path.child(e),this.firestore,this.hE)},Il.prototype.add=function(t){Oh("CollectionReference.add",arguments,1),Ph("CollectionReference.add","object",1,this.hE?this.hE.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Il.prototype.withConverter=function(t){return new Il(this.DE,this.firestore,t)},Il);function Il(t,e,n){var r=this;if(((r=al.call(this,Ao.Wt(t),e,n)||this).DE=t).length%2!=1)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function Nl(t,e,n,r){this.nE=t,this.pE=e,this.yE=n,this.hE=r,this.bE=null,this.vE=null,this.metadata=new ml(n.hasPendingWrites,n.fromCache)}function _l(t,e,n){this.TE=t,this.firestore=e,this.hE=n}function Al(){return null!==hl&&hl.apply(this,arguments)||this}function Sl(t,e,n,r,i,o){this.nE=t,this.$c=e,this.lE=n,this.dE=r,this.fE=i,this.hE=o}function Dl(t,e){this.hasPendingWrites=t,this.fromCache=e}function kl(t,e,n){this.$c=t,this.firestore=e,this.hE=n,this.WT=this.firestore.QT()}function xl(t){this.nE=t,this.oE=[],this.aE=!1}function Ol(t,e){this.nE=t,this.rE=e}function Rl(t,e,n){var r=this;if(void 0===n&&(n=new Yf),this.qT=null,this.UT=new sh,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.QT(),[4,this.WT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.qT=i,this.Nc=Rl.jT(i),this.KT=i.name,this.GT=new xr(e)}else{var o=t;if(!o.projectId)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide projectId");this.Nc=new uu(o.projectId,o.database),this.KT="[DEFAULT]",this.GT=new kr}this.zT=n,this.HT=new ll({}),this.YT=new Ac(this.Nc)}function Vl(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ch("settings","non-empty string","host",t.host),this.host=t.host,Mh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Gh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Mh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Mh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Xs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Xs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Mh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ph.cu;else{if(t.cacheSizeBytes!==fl&&t.cacheSizeBytes<ph.uu)throw new Dr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ph.uu);this.cacheSizeBytes=t.cacheSizeBytes}Mh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Pl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.NT=n,this.converter=r}function Ll(t,e){if(void 0===e)return{merge:!1};if(Gh(t,e,["merge","mergeFields"]),Mh(t,"boolean","merge",e.merge),n=t,void 0!==(r=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Fh(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Fh(n[i]))}(n,"mergeFields",r,function(t){return"string"==typeof t||t instanceof $h}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n,r;return e}function Cl(t,e){return void 0===e?{}:(Gh(t,e,["serverTimestamps"]),jh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Ml(t,e){Lh(t,"object",1,e),e&&(Gh(t,e,["source"]),jh(t,0,"source",e.source,["default","server","cache"]))}function jl(t,e,n){if(e instanceof vl){if(e.firestore!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw zh(t,"DocumentReference",1,e)}function Ul(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function ql(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Dr(Sr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Fl,Bl=ql(pl,"Use firebase.firestore() instead."),Gl=ql(dl,"Use firebase.firestore().runTransaction() instead."),zl=ql(yl,"Use firebase.firestore().batch() instead."),Wl=ql(vl,"Use firebase.firestore().doc() instead."),Ql=ql(gl),Hl=ql(wl),Kl=ql(bl),Yl=ql(El),Xl=ql(Tl,"Use firebase.firestore().collection() instead."),$l=ql((cp.delete=function(){return xh("FieldValue.delete",arguments),new uc},cp.serverTimestamp=function(){return xh("FieldValue.serverTimestamp",arguments),new ac},cp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Rh("FieldValue.arrayUnion",arguments,1),new hc(t)},cp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Rh("FieldValue.arrayRemove",arguments,1),new cc(t)},cp.increment=function(t){return Ph("FieldValue.increment","number",1,t),Oh("FieldValue.increment",arguments,1),new fc(t)},cp.prototype.isEqual=function(t){return this===t},cp),"Use FieldValue.<field>() instead."),Jl=ql(Xh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Zl={Firestore:Bl,GeoPoint:lc,Timestamp:Vr,Blob:Jl,Transaction:Gl,WriteBatch:zl,DocumentReference:Wl,DocumentSnapshot:Ql,Query:Kl,QueryDocumentSnapshot:Hl,QuerySnapshot:Yl,CollectionReference:Xl,FieldPath:$h,FieldValue:$l,setLogLevel:pl.setLogLevel,CACHE_SIZE_UNLIMITED:fl},tp=(hp.prototype.x_=function(t){},hp.prototype.Ro=function(){},hp),ep=(ap.prototype.x_=function(t){this.kE.push(t)},ap.prototype.Ro=function(){window.removeEventListener("online",this.CE),window.removeEventListener("offline",this.NE)},ap.prototype.ME=function(){window.addEventListener("online",this.CE),window.addEventListener("offline",this.NE)},ap.prototype.FE=function(){Ys("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(0)},ap.prototype.$E=function(){Ys("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(1)},ap.jh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},ap),np=(up.prototype.t_=function(t){this.xE=t},up.prototype.Hc=function(t){this.BE=t},up.prototype.onMessage=function(t){this.qE=t},up.prototype.close=function(){this.OE()},up.prototype.send=function(t){this.LE(t)},up.prototype.UE=function(){this.xE()},up.prototype.QE=function(t){this.BE(t)},up.prototype.WE=function(t){this.qE(t)},up),rp={BatchGetDocuments:"batchGet",Commit:"commit"},ip="gl-js/ fire/"+Er,op=(sp.prototype.KE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=ip},sp.prototype.l_=function(a,r,i){var h=this,c=this.GE(a);return new Promise(function(o,s){var u=new br;u.listenOnce(gr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case mr.NO_ERROR:var t=u.getResponseJson();Ys("Connection","XHR received:",JSON.stringify(t)),o(t);break;case mr.TIMEOUT:Ys("Connection",'RPC "'+a+'" timed out'),s(new Dr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var e=u.getStatus();if(Ys("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Sr).indexOf(i)?i:Sr.UNKNOWN);s(new Dr(r,n.message))}else s(new Dr(Sr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Ys("Connection",'RPC "'+a+'" failed'),s(new Dr(Sr.UNAVAILABLE,"Connection failed."));break;default:Js()}}finally{Ys("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Ys("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.KE(n,i),u.send(c,"POST",e,n,15)})},sp.prototype.d_=function(t,e,n){return this.l_(t,e,n)},sp.prototype.e_=function(t,e){var n,r,i=[this.jE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=vr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.KE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=p().indexOf("Electron/")||0<=(r=p()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=p().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ys("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new np({LE:function(t){f?Ys("Connection","Not sending because WebChannel is closed:",t):(c||(Ys("Connection","Opening WebChannel transport."),h.open(),c=!0),Ys("Connection","WebChannel sending:",t),h.send(t))},OE:function(){return h.close()}});return a(wr.EventType.OPEN,function(){f||Ys("Connection","WebChannel transport opened.")}),a(wr.EventType.CLOSE,function(){f||(f=!0,Ys("Connection","WebChannel transport closed"),l.QE())}),a(wr.EventType.ERROR,function(t){f||(f=!0,Ys("Connection","WebChannel transport errored:",t),l.QE(new Dr(Sr.UNAVAILABLE,"The operation could not be completed")))}),a(wr.EventType.MESSAGE,function(t){var e;if(!f){var n=t.data[0];Zs(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ys("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=co[i];if(void 0!==t)return $o(t)}(),s=r.message;void 0===o&&(o=Sr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.QE(new Dr(o,s)),h.close()}else Ys("Connection","WebChannel received:",n),l.WE(n)}}),setTimeout(function(){l.UE()},0),l},sp.prototype.GE=function(t){var e=rp[t];return this.jE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},sp);function sp(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.jE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function up(t){this.LE=t.LE,this.OE=t.OE}function ap(){var t=this;this.CE=function(){return t.FE()},this.NE=function(){return t.$E()},this.kE=[],this.ME()}function hp(){}function cp(){}function fp(){this.oc="undefined"!=typeof atob}zs.an((Object.defineProperty(fp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(fp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),fp.prototype.pT=function(t){return Promise.resolve(new op(t))},fp.prototype.RT=function(){return new(ep.jh()?ep:tp)},fp.prototype.yc=function(t){return new Fs(t,{hi:!0})},fp.prototype.un=function(t){return JSON.stringify(t)},fp.prototype.atob=function(t){return atob(t)},fp.prototype.btoa=function(t){return btoa(t)},fp.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new fp)),(Fl=lp).INTERNAL.registerComponent(new E("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new pl(e,n,new Xf);var e,n},"PUBLIC").setServiceProps(Object.assign({},Zl))),Fl.registerVersion("@firebase/firestore","1.14.5")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});